<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msapplication-config" content="/images/browserconfig.xml">
  <meta name="google-site-verification" content="XgZjCjedxF82a4b0z1Nr0FiopL5MQKta4RZweqPZaBY">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"note.siwei.info","root":"/","scheme":"Gemini","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="今天，把我之前在公司内部给同事们培训Openstack 介绍的note放到这里，是一年多之前基于当时的O版本的Ubuntu的部署，对于初学的同学也许有一些帮助，不过其实整个过程无非就是参照官方安装的guide而已。  Installation GuideLatest version: installation-openstack-ubuntu-note.md hosted on Github.c">
<meta property="og:type" content="article">
<meta property="og:title" content="deploy Openstack O on self privisoned virtualbox Ubuntu VMs manually">
<meta property="og:url" content="https://note.siwei.info/deploy-openstack-o-on-self-privisoned-virtualbox-ubuntu-vms-manually/index.html">
<meta property="og:site_name" content="Siwei notes">
<meta property="og:description" content="今天，把我之前在公司内部给同事们培训Openstack 介绍的note放到这里，是一年多之前基于当时的O版本的Ubuntu的部署，对于初学的同学也许有一些帮助，不过其实整个过程无非就是参照官方安装的guide而已。  Installation GuideLatest version: installation-openstack-ubuntu-note.md hosted on Github.c">
<meta property="article:published_time" content="2019-01-01T06:04:47.000Z">
<meta property="article:modified_time" content="2019-03-08T06:46:25.272Z">
<meta property="article:author" content="Wey Gu | 古思为">
<meta property="article:tag" content="openstack">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://note.siwei.info/deploy-openstack-o-on-self-privisoned-virtualbox-ubuntu-vms-manually/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>deploy Openstack O on self privisoned virtualbox Ubuntu VMs manually | Siwei notes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Siwei notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">思为笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-résumé">

    <a href="/about/resume.pdf" rel="section"><i class="fa fa-fw fa-book"></i>Résumé</a>

  </li>
        <li class="menu-item menu-item-简历">

    <a href="/about/resume_chs.pdf" rel="section"><i class="fa fa-fw fa-book"></i>简历</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">23</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">3</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">13</span></a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>Commonweal 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="default">
    <link itemprop="mainEntityOfPage" href="https://note.siwei.info/deploy-openstack-o-on-self-privisoned-virtualbox-ubuntu-vms-manually/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wey Gu | 古思为">
      <meta itemprop="description" content="Build things.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Siwei notes">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          deploy Openstack O on self privisoned virtualbox Ubuntu VMs manually
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-01 14:04:47" itemprop="dateCreated datePublished" datetime="2019-01-01T14:04:47+08:00">2019-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-03-08 14:46:25" itemprop="dateModified" datetime="2019-03-08T14:46:25+08:00">2019-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openstack-stuff/" itemprop="url" rel="index"><span itemprop="name">openstack stuff</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>今天，把我之前在公司内部给同事们培训Openstack 介绍的note放到这里，是一年多之前基于当时的O版本的Ubuntu的部署，对于初学的同学也许有一些帮助，不过其实整个过程无非就是参照官方安装的guide而已。</p>
</blockquote>
<h1 id="Installation-Guide"><a href="#Installation-Guide" class="headerlink" title="Installation Guide"></a>Installation Guide</h1><p>Latest version: <a href="https://github.com/littlewey/workshops/blob/master/00-Openstack-Basic/installation-openstack-ubuntu-note.md" target="_blank" rel="noopener">installation-openstack-ubuntu-note.md</a> hosted on <em>Github.com/littlewey</em></p>
<blockquote>
<p>ref: <a href="https://docs.openstack.org/install-guide" target="_blank" rel="noopener">https://docs.openstack.org/install-guide</a></p>
</blockquote>
<p>Ubuntu was chosen as host OS.</p>
<blockquote>
<p>“It’s a good way to learn by installing it manually for as many services as you could :-) .”</p>
<p>​                                                                                                           Wey Gu </p>
</blockquote>
<h2 id="Host-networking"><a href="#Host-networking" class="headerlink" title="Host networking"></a>Host networking</h2><blockquote>
<p>ref: <a href="https://docs.openstack.org/install-guide/environment-networking.html" target="_blank" rel="noopener">https://docs.openstack.org/install-guide/environment-networking.html</a></p>
</blockquote>
<blockquote>
<p>ref: <a href="https://help.ubuntu.com/lts/serverguide/network-configuration.html" target="_blank" rel="noopener">https://help.ubuntu.com/lts/serverguide/network-configuration.html</a></p>
</blockquote>
<p>The example architectures assume use of the following networks:</p>
<ul>
<li><p>Management on 10.0.0.0/24 with gateway 10.0.0.1</p>
<p>This network requires a gateway to provide Internet access to all nodes for administrative purposes such as package installation, security updates, DNS, and NTP.</p>
</li>
<li><p>Provider on 203.0.113.0/24 with gateway 203.0.113.1</p>
<p>This network requires a gateway to provide Internet access to instances in your OpenStack environment.</p>
</li>
</ul>
<h3 id="My-network-solution"><a href="#My-network-solution" class="headerlink" title="My network solution"></a>My network solution</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Net0:</span><br><span class="line">	Network name: VirtualBox  host-only Ethernet Adapter</span><br><span class="line">	Purpose: administrator / management network</span><br><span class="line">	IP block: 10.20.0.0/24</span><br><span class="line">	DHCP: <span class="built_in">disable</span></span><br><span class="line">	Linux device: eth0</span><br><span class="line"></span><br><span class="line">Net1:</span><br><span class="line">	Network name: VirtualBox  host-only Ethernet Adapter<span class="comment">#2</span></span><br><span class="line">	Purpose: Provider network</span><br><span class="line">	DHCP: <span class="built_in">disable</span></span><br><span class="line">	IP block: 172.16.0.0/24</span><br><span class="line">	Linux device: eth1</span><br><span class="line"></span><br><span class="line">Net2：</span><br><span class="line">	Network name: VirtualBox  host-only Ethernet Adapter<span class="comment">#3</span></span><br><span class="line">	Purpose: Storage network</span><br><span class="line">	DHCP: <span class="built_in">disable</span></span><br><span class="line">	IP block: 192.168.99.0/24</span><br><span class="line">	Linux device: eth2</span><br><span class="line"></span><br><span class="line">Net3：</span><br><span class="line">	Network name: VirtualBox  Bridged or NAT // <span class="keyword">for</span> accessing network or remote access purpose</span><br><span class="line">	Purpose: Internet</span><br><span class="line">	DHCP: <span class="built_in">enable</span></span><br><span class="line">	IP block: &lt;depend on your network&gt;</span><br><span class="line">	Linux device: eth3</span><br></pre></td></tr></table></figure>





<p>Edit the <code>/etc/network/interfaces</code> file to contain the following:</p>
<p>Replace <code>INTERFACE_NAME</code> with the actual interface name. For example, <em>eth1</em> or <em>ens224</em>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The provider network interface</span></span><br><span class="line">auto INTERFACE_NAME</span><br><span class="line">iface INTERFACE_NAME inet manual</span><br><span class="line">up ip link <span class="built_in">set</span> dev <span class="variable">$IFACE</span> up</span><br><span class="line">down ip link <span class="built_in">set</span> dev <span class="variable">$IFACE</span> down</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="Base-Machine"><a href="#Base-Machine" class="headerlink" title="Base Machine"></a>Base Machine</h2><ul>
<li>download image from <a href="https://launchpad.net/ubuntu/+mirror/mirrors.neusoft.edu.cn-release" target="_blank" rel="noopener">https://launchpad.net/ubuntu/+mirror/mirrors.neusoft.edu.cn-release</a></li>
</ul>
<ul>
<li><p>Change root password</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo su</span><br><span class="line"><span class="comment"># passwd</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>Allow root ssh with password</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/ssh/sshd_config </span></span><br><span class="line"></span><br><span class="line">PermitRootLogin yes</span><br></pre></td></tr></table></figure>
</li>
<li><p>Check nic names</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># dmesg | grep rename</span></span><br><span class="line">[    2.799294] e1000 0000:00:09.0 enp0s9: renamed from eth2</span><br><span class="line">[    2.800192] e1000 0000:00:0a.0 enp0s10: renamed from eth3</span><br><span class="line">[    2.801072] e1000 0000:00:08.0 enp0s8: renamed from eth1</span><br><span class="line">[    2.804067] e1000 0000:00:03.0 enp0s3: renamed from eth0</span><br></pre></td></tr></table></figure>
</li>
<li><p>configure management network as a dummy one</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/network/interfaces</span></span><br><span class="line">auto enp0s3</span><br><span class="line">iface enp0s3 inet static</span><br><span class="line">address 10.20.0.11</span><br><span class="line">netmask 255.255.255.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>NTP</p>
<ul>
<li><p>install chrony</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install chrony</span><br></pre></td></tr></table></figure>
</li>
<li><p>Edit the <code>/etc/chrony/chrony.conf</code> file and add, change, or remove these keys as necessary for your environment:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow 10.20.0.0/24</span><br></pre></td></tr></table></figure>
</li>
<li><p>restart service</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service chrony restart</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Install OpenStack packages</p>
<blockquote>
<p>ref : <a href="https://docs.openstack.org/install-guide/environment-packages.html" target="_blank" rel="noopener">https://docs.openstack.org/install-guide/environment-packages.html</a></p>
</blockquote>
<p>Enable the OpenStack repository</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install software-properties-common</span></span><br><span class="line"><span class="comment"># add-apt-repository cloud-archive:ocata</span></span><br></pre></td></tr></table></figure>

<p>Upgrade the packages on all nodes:</p>
<blockquote>
<p>Set apt proxy before doing that will help save your life</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/apt/apt.conf.d/90proxy</span></span><br><span class="line">Acquire::http::Proxy <span class="string">"http://www-proxy.exu.ericsson.se:8080"</span>;</span><br><span class="line">Acquire::https::Proxy <span class="string">"http://www-proxy.exu.ericsson.se:8080"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># sed -i -e 's/cn/us/g' /etc/apt/sources.list</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt update &amp;&amp; apt dist-upgrade -y</span></span><br></pre></td></tr></table></figure>

<p>Install the OpenStack client:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install python-openstackclient -y</span></span><br></pre></td></tr></table></figure>




</li>
</ul>
<h2 id="Controller-node-actions"><a href="#Controller-node-actions" class="headerlink" title="Controller node actions"></a>Controller node actions</h2><h3 id="management-network-eth0-enp0s3"><a href="#management-network-eth0-enp0s3" class="headerlink" title="management network eth0 (enp0s3)"></a>management network eth0 (enp0s3)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/network/interfaces</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">auto enp0s3</span><br><span class="line">iface enp0s3 inet static</span><br><span class="line">address 10.20.0.10</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line"><span class="comment"># gateway 10.20.0.1  &lt;--- comment out this line</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ifup enp0s3</span></span><br></pre></td></tr></table></figure>

<h3 id="hostname-and-hosts"><a href="#hostname-and-hosts" class="headerlink" title="hostname and hosts"></a>hostname and hosts</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo controller &gt; /etc/hostname</span></span><br><span class="line"><span class="comment"># echo 10.20.0.10    controller &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="comment"># echo 10.20.0.20    compute &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="comment"># hostname controller</span></span><br></pre></td></tr></table></figure>



<h3 id="SQL-database"><a href="#SQL-database" class="headerlink" title="SQL database"></a>SQL database</h3><p>Install package</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install mariadb-server python-pymysql -y</span></span><br></pre></td></tr></table></figure>

<p>Create and edit the <code>/etc/mysql/mariadb.conf.d/99-openstack.cnf</code> file and complete the following actions:</p>
<blockquote>
<p>Create a <code>[mysqld]</code> section, and set the <code>bind-address</code> key to the management IP address of the controller node to enable access by other nodes via the management network. Set additional keys to enable useful options and the UTF-8 character set:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="built_in">bind</span>-address = 10.20.0.10</span><br><span class="line"></span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table = on</span><br><span class="line">max_connections = 4096</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">character-set-server = utf8</span><br></pre></td></tr></table></figure>

<p>restart database service</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service mysql restart</span></span><br></pre></td></tr></table></figure>

<p>Secure the database service by running the <code>mysql_secure_installation</code> script. In particular, choose a suitable password for the database <code>root</code> account:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql_secure_installation</span></span><br></pre></td></tr></table></figure>

<h3 id="Message-queue"><a href="#Message-queue" class="headerlink" title="Message queue"></a>Message queue</h3><p>Install the package:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install rabbitmq-server</span></span><br></pre></td></tr></table></figure>

<p>Add the <code>openstack</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmqctl add_user openstack RABBIT_PASS</span></span><br><span class="line"></span><br><span class="line">Creating user <span class="string">"openstack"</span> ...</span><br></pre></td></tr></table></figure>

<p>Replace <code>RABBIT_PASS</code> with a suitable password.</p>
<p>Permit configuration, write, and read access for the <code>openstack</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmqctl set_permissions openstack ".*" ".*" ".*"</span></span><br><span class="line"></span><br><span class="line">Setting permissions <span class="keyword">for</span> user <span class="string">"openstack"</span> <span class="keyword">in</span> vhost <span class="string">"/"</span> ...</span><br></pre></td></tr></table></figure>

<h3 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h3><p>Install the packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install memcached python-memcache</span></span><br></pre></td></tr></table></figure>

<p>Edit the <code>/etc/memcached.conf</code> file and configure the service to use the management IP address of the controller node. This is to enable access by other nodes via the management network:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-l 10.20.0.10</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Change the existing line that had <code>-l 127.0.0.1</code>.</p>
</blockquote>
<p>Restart the Memcached service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service memcached restart</span></span><br></pre></td></tr></table></figure>

<h2 id="Compute-node-actions"><a href="#Compute-node-actions" class="headerlink" title="Compute node actions"></a>Compute node actions</h2><h3 id="management-network-eth0-enp0s3-1"><a href="#management-network-eth0-enp0s3-1" class="headerlink" title="management network eth0 (enp0s3)"></a>management network eth0 (enp0s3)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/network/interfaces</span></span><br><span class="line"></span><br><span class="line">auto enp0s3</span><br><span class="line">iface enp0s3 inet static</span><br><span class="line">address 10.20.0.20</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line"><span class="comment"># comment out gateway</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ifup enp0s3</span></span><br></pre></td></tr></table></figure>

<h3 id="configure-NTP-by-editing-etc-chrony-chrony-conf"><a href="#configure-NTP-by-editing-etc-chrony-chrony-conf" class="headerlink" title="configure NTP by editing /etc/chrony/chrony.conf"></a>configure NTP by editing <code>/etc/chrony/chrony.conf</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server 10.20.0.10 iburst</span><br></pre></td></tr></table></figure>

<p>change hostname and hosts</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo compute &gt; /etc/hostname</span></span><br><span class="line"><span class="comment"># echo 10.20.0.10    controller &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="comment"># echo 10.20.0.20    compute &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="comment"># hostname compute</span></span><br></pre></td></tr></table></figure>



<h2 id="Keystone-installation"><a href="#Keystone-installation" class="headerlink" title="Keystone installation"></a>Keystone installation</h2><blockquote>
<p>ref: <a href="https://docs.openstack.org/newton/install-guide-ubuntu/keystone.html" target="_blank" rel="noopener">https://docs.openstack.org/newton/install-guide-ubuntu/keystone.html</a></p>
</blockquote>
<blockquote>
<p>Keystone will be installed in <code>controller node</code></p>
</blockquote>
<p>Before you configure the OpenStack Identity service, you must create a database and an administration token.</p>
<p>To create the database, complete the following actions:</p>
<ul>
<li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root -p</span><br></pre></td></tr></table></figure>

<p>In 16.04 LTS local access need no user/psw</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>Create the <code>keystone</code> database:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE keystone;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Grant proper access to the <code>keystone</code> database:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;localhost&#39; \</span><br><span class="line">  IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;%&#39; \</span><br><span class="line">  IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;</span><br></pre></td></tr></table></figure>

<p>Replace <code>KEYSTONE_DBPASS</code> with a suitable password.</p>
</li>
<li><p>Exit the database access client.</p>
</li>
</ul>
<p>Run the following command to install the packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install keystone -y</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>Edit the <code>/etc/keystone/keystone.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[database]</code> section, configure database access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">...</span><br><span class="line">connection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone</span><br></pre></td></tr></table></figure>

<p>Replace <code>KEYSTONE_DBPASS</code> with the password you chose for the database.</p>
<p>Comment out or remove any other <code>connection</code> options in the <code>[database]</code> section.</p>
</li>
<li><p>In the <code>[token]</code> section, configure the Fernet token provider:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[token]</span><br><span class="line">...</span><br><span class="line">provider = fernet</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Populate the Identity service database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "keystone-manage db_sync" keystone</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Initialize Fernet key repositories:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span></span><br><span class="line"><span class="comment"># keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Bootstrap the Identity service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># keystone-manage bootstrap --bootstrap-password ADMIN_PASS \</span></span><br><span class="line">  --bootstrap-admin-url http://controller:35357/v3/ \</span><br><span class="line">  --bootstrap-internal-url http://controller:35357/v3/ \</span><br><span class="line">  --bootstrap-public-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-region-id RegionOne</span><br></pre></td></tr></table></figure>

<p>Replace <code>ADMIN_PASS</code> with a suitable password for an administrative user.</p>
</li>
</ol>
<h3 id="Configure-the-Apache-HTTP-server"><a href="#Configure-the-Apache-HTTP-server" class="headerlink" title="Configure the Apache HTTP server"></a>Configure the Apache HTTP server</h3><ol>
<li><p>Edit the <code>/etc/apache2/apache2.conf</code> file and configure the <code>ServerName</code> option to reference the controller node:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerName controller</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Finalize-the-installation"><a href="#Finalize-the-installation" class="headerlink" title="Finalize the installation"></a>Finalize the installation</h3><ol>
<li><p>Restart the Apache service and remove the default SQLite database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service apache2 restart</span></span><br><span class="line"><span class="comment"># rm -f /var/lib/keystone/keystone.db</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol>
<li><p>Configure the administrative account</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> OS_USERNAME=admin</span><br><span class="line">$ <span class="built_in">export</span> OS_PASSWORD=ADMIN_PASS</span><br><span class="line">$ <span class="built_in">export</span> OS_PROJECT_NAME=admin</span><br><span class="line">$ <span class="built_in">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line">$ <span class="built_in">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">$ <span class="built_in">export</span> OS_AUTH_URL=http://controller:35357/v3</span><br><span class="line">$ <span class="built_in">export</span> OS_IDENTITY_API_VERSION=3</span><br></pre></td></tr></table></figure>

<p>Replace <code>ADMIN_PASS</code> with the password used in the <code>keystone-manage bootstrap</code> command from the section called <a href="https://docs.openstack.org/newton/install-guide-ubuntu/keystone-install.html#keystone-install" target="_blank" rel="noopener">Install and configure</a>.</p>
</li>
</ol>
<h3 id="Create-a-domain-projects-users-and-roles"><a href="#Create-a-domain-projects-users-and-roles" class="headerlink" title="Create a domain, projects, users, and roles"></a>Create a domain, projects, users, and roles</h3><p>The Identity service provides authentication services for each OpenStack service. The authentication service uses a combination of <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-domain" target="_blank" rel="noopener">domains</a>, <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-project" target="_blank" rel="noopener">projects</a>, <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-user" target="_blank" rel="noopener">users</a>, and <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-role" target="_blank" rel="noopener">roles</a>.</p>
<ol>
<li><p>This guide uses a service project that contains a unique user for each service that you add to your environment. Create the <code>service</code> project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack project create --domain default \</span><br><span class="line">  --description <span class="string">"Service Project"</span> service</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Service Project                  |</span><br><span class="line">| domain_id   | default                          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 24ac7f19cd944f4cba1d77469b2a73ed |</span><br><span class="line">| is_domain   | False                            |</span><br><span class="line">| name        | service                          |</span><br><span class="line">| parent_id   | default                          |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Regular (non-admin) tasks should use an unprivileged project and user. As an example, this guide creates the <code>demo</code> project and user.</p>
<ul>
<li><p>Create the <code>demo</code> project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack project create --domain default \</span><br><span class="line">  --description <span class="string">"Demo Project"</span> demo</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Demo Project                     |</span><br><span class="line">| domain_id   | default                          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 231ad6e7ebba47d6a1e57e1cc07ae446 |</span><br><span class="line">| is_domain   | False                            |</span><br><span class="line">| name        | demo                             |</span><br><span class="line">| parent_id   | default                          |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>Do not repeat this step when creating additional users for this project.</p>
</li>
<li><p>Create the <code>demo</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain default \</span><br><span class="line">  --password-prompt demo</span><br><span class="line"></span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | aeda23aa78f44e859900e22c24817832 |</span><br><span class="line">| name                | demo                             |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the <code>user</code> role:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role create user</span><br><span class="line"></span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| Field     | Value                            |</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| domain_id | None                             |</span><br><span class="line">| id        | 997ce8d05fc143ac97d83fdfb5998552 |</span><br><span class="line">| name      | user                             |</span><br><span class="line">+-----------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the <code>user</code> role to the <code>demo</code> project and user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project demo --user demo user</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h3 id="Verify-operation"><a href="#Verify-operation" class="headerlink" title="Verify operation"></a>Verify operation</h3><p>For security reasons, disable the temporary authentication token mechanism:</p>
<p>Edit the <code>/etc/keystone/keystone-paste.ini</code> file and remove <code>admin_token_auth</code> from the <code>[pipeline:public_api]</code>, <code>[pipeline:admin_api]</code>, and <code>[pipeline:api_v3]</code> sections.</p>
<p>Unset the temporary <code>OS_AUTH_URL</code> and <code>OS_PASSWORD</code> environment variable:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">unset</span> OS_AUTH_URL OS_PASSWORD</span><br></pre></td></tr></table></figure>

<p>As the <code>admin</code> user, request an authentication token:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ openstack --os-auth-url http://controller:35357/v3 \</span><br><span class="line">  --os-project-domain-name Default --os-user-domain-name Default \</span><br><span class="line">  --os-project-name admin --os-username admin token issue</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                           |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| expires    | 2017-08-12T20:14:07.056119Z                                     |</span><br><span class="line">| id         | gAAAAABWvi7_B8kKQD9wdXac8MoZiQldmjEO643d-e_j-XXq9AmIegIbA7UHGPv |</span><br><span class="line">|            | atnN21qtOMjCFWX7BReJEQnVOAj3nclRQgAYRsfSU_MrsuWb4EDtnjU7HEpoBb4 |</span><br><span class="line">|            | o6ozsA_NmFWEpLeKy0uNn_WeKbAhYygrsmQGA49dclHVnz-OMVLiyM9ws       |</span><br><span class="line">| project_id | 343d245e850143a096806dfaefa9afdc                                |</span><br><span class="line">| user_id    | ac3377633149401296f6c0d92d79dc16                                |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br></pre></td></tr></table></figure>



<p>This command uses the password for the <code>admin</code> user. As we gave above it’s <code>ADMIN_PASS</code>.</p>
<p>As the <code>demo</code> user, request an authentication token:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ openstack --os-auth-url http://controller:5000/v3 \</span><br><span class="line">  --os-project-domain-name Default --os-user-domain-name Default \</span><br><span class="line">  --os-project-name demo --os-username demo token issue</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                           |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| expires    | 2017-08-12T20:15:39.014479Z                                     |</span><br><span class="line">| id         | gAAAAABWvi9bsh7vkiby5BpCCnc-JkbGhm9wH3fabS_cY7uabOubesi-Me6IGWW |</span><br><span class="line">|            | yQqNegDDZ5jw7grI26vvgy1J5nCVwZ_zFRqPiz_qhbq29mgbQLglbkq6FQvzBRQ |</span><br><span class="line">|            | JcOzq3uwhzNxszJWmzGC7rJE_H0A_a3UFhqv8M4zMRYSbS2YF0MyFmp_U       |</span><br><span class="line">| project_id | ed0b60bf607743088218b0a533d5943f                                |</span><br><span class="line">| user_id    | 58126687cbcc4888bfa9ab73a2256f27                                |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br></pre></td></tr></table></figure>



<blockquote>
<p>This command uses the password for the <code>demo</code> user and API port 5000 which only allows regular (non-admin) access to the Identity service API.</p>
</blockquote>
<h3 id="Create-OpenStack-client-environment-scripts"><a href="#Create-OpenStack-client-environment-scripts" class="headerlink" title="Create OpenStack client environment scripts"></a>Create OpenStack client environment scripts</h3><p>The previous section used a combination of environment variables and command options to interact with the Identity service via the<code>openstack</code> client. To increase efficiency of client operations, OpenStack supports simple client environment scripts also known as OpenRC files. These scripts typically contain common options for all clients, but also support unique options. For more information, see the <a href="http://docs.openstack.org/user-guide/common/cli_set_environment_variables_using_openstack_rc.html" target="_blank" rel="noopener">OpenStack End User Guide</a>.</p>
<h4 id="Creating-the-scripts"><a href="#Creating-the-scripts" class="headerlink" title="Creating the scripts"></a>Creating the scripts</h4><p>Create client environment scripts for the <code>admin</code> and <code>demo</code> projects and users. Future portions of this guide reference these scripts to load appropriate credentials for client operations.</p>
<ol>
<li><p>Edit the <code>admin-openrc</code> file and add the following content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_NAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_USERNAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_PASSWORD=ADMIN_PASS</span><br><span class="line"><span class="built_in">export</span> OS_AUTH_URL=http://controller:35357/v3</span><br><span class="line"><span class="built_in">export</span> OS_IDENTITY_API_VERSION=3</span><br><span class="line"><span class="built_in">export</span> OS_IMAGE_API_VERSION=2</span><br></pre></td></tr></table></figure>

<p>Replace <code>ADMIN_PASS</code> with the password you chose for the <code>admin</code> user in the Identity service.</p>
</li>
<li><p>Edit the <code>demo-openrc</code> file and add the following content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_NAME=demo</span><br><span class="line"><span class="built_in">export</span> OS_USERNAME=demo</span><br><span class="line"><span class="built_in">export</span> OS_PASSWORD=demo</span><br><span class="line"><span class="built_in">export</span> OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line"><span class="built_in">export</span> OS_IDENTITY_API_VERSION=3</span><br><span class="line"><span class="built_in">export</span> OS_IMAGE_API_VERSION=2</span><br></pre></td></tr></table></figure>

<p>Replace <code>OS_PASSWORD=demo</code> with the password you chose for the <code>demo</code> user in the Identity service.</p>
</li>
</ol>
<h4 id="Using-the-scripts"><a href="#Using-the-scripts" class="headerlink" title="Using the scripts"></a>Using the scripts</h4><p>To run clients as a specific project and user, you can simply load the associated client environment script prior to running them. For example:</p>
<ol>
<li><p>Load the <code>admin-openrc</code> file to populate environment variables with the location of the Identity service and the <code>admin</code> project and user credentials:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>Request an authentication token:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># openstack token issue --max-width 70</span></span><br><span class="line">+------------+-------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                 |</span><br><span class="line">+------------+-------------------------------------------------------+</span><br><span class="line">| expires    | 2017-08-23T14:00:10+0000                              |</span><br><span class="line">| id         | gAAAAABZnXxaKuuwh9Kw-dbY1mSn8LeNNQMKmIj2EW8jyjO0NSy5H |</span><br><span class="line">|            | QPno4Tj6NqqSkumKhRZW8lPS1nZC2pm5fCuH5XMtVfJTu89RX6Sba |</span><br><span class="line">|            | -vSv-OZl5uHvRY4KOK03WH15Dnp1XbWN97xY8tR_kAhc-69       |</span><br><span class="line">|            | -WvDe1DLS6vKr-bKbYDVXLqlLshE8E                        |</span><br><span class="line">| project_id | 78c9c849237649a3a8c4526167427589                      |</span><br><span class="line">| user_id    | d8efd16c30904a7992010abe4bdb9a2b                      |</span><br><span class="line">+------------+-------------------------------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Glance-installation"><a href="#Glance-installation" class="headerlink" title="Glance installation"></a>Glance installation</h2><p>ref: <a href="https://docs.openstack.org/newton/install-guide-ubuntu/glance.html" target="_blank" rel="noopener">https://docs.openstack.org/newton/install-guide-ubuntu/glance.html</a></p>
<p>For simplicity, this guide describes configuring the Image service to use the <code>file</code> back end, which uploads and stores in a directory on the controller node hosting the Image service. By default, this directory is <code>/var/lib/glance/images/</code>.</p>
<p>Before you proceed, ensure that the controller node has at least several gigabytes of space available in this directory. Keep in mind that since the <code>file</code> back end is often local to a controller node, it is not typically suitable for a multi-node glance deployment.</p>
<p>For information on requirements for other back ends, see <a href="http://docs.openstack.org/newton/config-reference/image.html" target="_blank" rel="noopener">Configuration Reference</a>.</p>
<h3 id="Install-and-configure"><a href="#Install-and-configure" class="headerlink" title="Install and configure"></a>Install and configure</h3><p>This section describes how to install and configure the Image service, code-named glance, on the controller node. For simplicity, this configuration stores images on the local file system.</p>
<h3 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><p>Before you install and configure the Image service, you must create a database, service credentials, and API endpoints.</p>
<ol>
<li><p>To create the database, complete these steps:</p>
<ul>
<li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the <code>glance</code> database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE glance;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Grant proper access to the <code>glance</code> database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="string">'glance'</span>@<span class="string">'localhost'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'GLANCE_DBPASS'</span>;</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="string">'glance'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'GLANCE_DBPASS'</span>;</span><br></pre></td></tr></table></figure>

<p>Replace <code>GLANCE_DBPASS</code> with a suitable password.</p>
</li>
<li><p>Exit the database access client.</p>
</li>
</ul>
</li>
<li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>To create the service credentials, complete these steps:</p>
<ul>
<li><p>Create the <code>glance</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain default --password-prompt glance</span><br><span class="line"></span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 3f4e777c4062483ab8d9edd7dff829df |</span><br><span class="line">| name                | glance                           |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the <code>admin</code> role to the <code>glance</code> user and <code>service</code> project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user glance admin</span><br></pre></td></tr></table></figure>

<p>This command provides no output.</p>
</li>
<li><p>Create the <code>glance</code> service entity:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name glance \</span><br><span class="line">  --description <span class="string">"OpenStack Image"</span> image</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Image                  |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 8c2c7f1b9b5049ea9e63757b5533e6d2 |</span><br><span class="line">| name        | glance                           |</span><br><span class="line">| <span class="built_in">type</span>        | image                            |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Create the Image service API endpoints:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  image public http://controller:9292</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 340be3625e9b4239a6415d034e98aace |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |</span><br><span class="line">| service_name | glance                           |</span><br><span class="line">| service_type | image                            |</span><br><span class="line">| url          | http://controller:9292           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  image internal http://controller:9292</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | a6e4b153c2ae4c919eccfdbb7dceb5d2 |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |</span><br><span class="line">| service_name | glance                           |</span><br><span class="line">| service_type | image                            |</span><br><span class="line">| url          | http://controller:9292           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  image admin http://controller:9292</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 0c37ed58103f4300a84ff125a539032d |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |</span><br><span class="line">| service_name | glance                           |</span><br><span class="line">| service_type | image                            |</span><br><span class="line">| url          | http://controller:9292           |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Install-and-configure-components"><a href="#Install-and-configure-components" class="headerlink" title="Install and configure components"></a>Install and configure components</h3><p>Install the packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install glance -y</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>Edit the <code>/etc/glance/glance-api.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[database]</code> section, configure database access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">...</span><br><span class="line">connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</span><br></pre></td></tr></table></figure>

<p>Replace <code>GLANCE_DBPASS</code> with the password you chose for the Image service database.</p>
</li>
<li><p>In the <code>[keystone_authtoken]</code> and <code>[paste_deploy]</code> sections, configure Identity service access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[keystone_authtoken]</span><br><span class="line">...</span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = glance</span><br><span class="line">password = glance</span><br><span class="line"></span><br><span class="line">[paste_deploy]</span><br><span class="line">...</span><br><span class="line">flavor = keystone</span><br></pre></td></tr></table></figure>

<p>Replace <code>password = glance</code> with the password you chose for the <code>glance</code> user in the Identity service.</p>
</li>
</ul>
</li>
</ol>
<pre><code>Comment out or remove any other options in the `[keystone_authtoken]` section.</code></pre><ul>
<li><p>In the <code>[glance_store]</code> section, configure the local file system store and location of image files:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[glance_store]</span><br><span class="line">...</span><br><span class="line">stores = file,http</span><br><span class="line">default_store = file</span><br><span class="line">filesystem_store_datadir = /var/lib/glance/images/</span><br></pre></td></tr></table></figure>

</li>
</ul>
<ol start="2">
<li><p>Edit the <code>/etc/glance/glance-registry.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[database]</code> section, configure database access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">...</span><br><span class="line">connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</span><br></pre></td></tr></table></figure>

<p>Replace <code>GLANCE_DBPASS</code> with the password you chose for the Image service database.</p>
</li>
<li><p>In the <code>[keystone_authtoken]</code> and <code>[paste_deploy]</code> sections, configure Identity service access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[keystone_authtoken]</span><br><span class="line">...</span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = glance</span><br><span class="line">password = glance</span><br><span class="line"></span><br><span class="line">[paste_deploy]</span><br><span class="line">...</span><br><span class="line">flavor = keystone</span><br></pre></td></tr></table></figure>

<p>Replace <code>password = glance</code> with the password you chose for the <code>glance</code> user in the Identity service.</p>
<p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p>
</li>
</ul>
</li>
</ol>
<p>Populate the Image service database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "glance-manage db_sync" glance</span></span><br></pre></td></tr></table></figure>

<p>Ignore any deprecation messages in this output.</p>
<h3 id="Finalize-installation"><a href="#Finalize-installation" class="headerlink" title="Finalize installation"></a>Finalize installation</h3><p>Restart the Image services:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service glance-registry restart</span></span><br><span class="line"><span class="comment"># service glance-api restart</span></span><br></pre></td></tr></table></figure>

<h3 id="Verify-operation-1"><a href="#Verify-operation-1" class="headerlink" title="Verify operation"></a>Verify operation</h3><p>Verify operation of the Image service using <a href="http://launchpad.net/cirros" target="_blank" rel="noopener">CirrOS</a>, a small Linux image that helps you test your OpenStack deployment.</p>
<p>For more information about how to download and build images, see <a href="http://docs.openstack.org/image-guide/" target="_blank" rel="noopener">OpenStack Virtual Machine Image Guide</a>. For information about how to manage images, see the <a href="http://docs.openstack.org/user-guide/common/cli-manage-images.html" target="_blank" rel="noopener">OpenStack End User Guide</a>.</p>
<ol>
<li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>Download the source image:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tip: add proxy to improve speed in office network</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ export http_proxy&#x3D;http:&#x2F;&#x2F;www-proxy.exu.ericsson.se:8080</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; after wget</span><br><span class="line"></span><br><span class="line">$ unset http_proxy</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Install <code>wget</code> if your distribution does not include it.</p>
</li>
<li><p>Upload the image to the Image service using the <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-qemu-copy-on-write-2-qcow2" target="_blank" rel="noopener">QCOW2</a> disk format, <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-bare" target="_blank" rel="noopener">bare</a> container format, and public visibility so all projects can access it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ openstack image create <span class="string">"cirros"</span> \</span><br><span class="line">  --file cirros-0.3.5-x86_64-disk.img \</span><br><span class="line">  --disk-format qcow2 --container-format bare \</span><br><span class="line">  --public</span><br><span class="line"></span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| checksum         | 133eae9fb1c98f45894a4e60d8736619                     |</span><br><span class="line">| container_format | bare                                                 |</span><br><span class="line">| created_at       | 2015-03-26T16:52:10Z                                 |</span><br><span class="line">| disk_format      | qcow2                                                |</span><br><span class="line">| file             | /v2/images/cc5c6982-4910-471e-b864-1098015901b5/file |</span><br><span class="line">| id               | cc5c6982-4910-471e-b864-1098015901b5                 |</span><br><span class="line">| min_disk         | 0                                                    |</span><br><span class="line">| min_ram          | 0                                                    |</span><br><span class="line">| name             | cirros                                               |</span><br><span class="line">| owner            | ae7a98326b9c455588edd2656d723b9d                     |</span><br><span class="line">| protected        | False                                                |</span><br><span class="line">| schema           | /v2/schemas/image                                    |</span><br><span class="line">| size             | 13200896                                             |</span><br><span class="line">| status           | active                                               |</span><br><span class="line">| tags             |                                                      |</span><br><span class="line">| updated_at       | 2015-03-26T16:52:10Z                                 |</span><br><span class="line">| virtual_size     | None                                                 |</span><br><span class="line">| visibility       | public                                               |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>For information about the <strong>openstack image create</strong> parameters, see <a href="http://docs.openstack.org/user-guide/common/cli-manage-images.html#create-or-update-an-image-glance" target="_blank" rel="noopener">Create or update an image (glance)</a> in the <code>OpenStack UserGuide</code>.</p>
<p>For information about disk and container formats for images, see <a href="http://docs.openstack.org/image-guide/image-formats.html" target="_blank" rel="noopener">Disk and container formats for images</a> in the <code>OpenStack VirtualMachine Image Guide</code>.</p>
</li>
</ol>
<p>   OpenStack generates IDs dynamically, so you will see different values in the example command output.</p>
<ol start="4">
<li><p>Confirm upload of the image and validate attributes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack image list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| 38047887-61a7-41ea-9b49-27987d5e8bb9 | cirros | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Nova-installation"><a href="#Nova-installation" class="headerlink" title="Nova installation"></a>Nova installation</h2><blockquote>
<p> ref: <a href="https://docs.openstack.org/newton/install-guide-ubuntu/nova.html" target="_blank" rel="noopener">https://docs.openstack.org/newton/install-guide-ubuntu/nova.html</a></p>
</blockquote>
<h2 id="Nova-install-and-configure-controller-node"><a href="#Nova-install-and-configure-controller-node" class="headerlink" title="Nova install and configure controller node"></a>Nova install and configure controller node</h2><h3 id="Prerequisites-1"><a href="#Prerequisites-1" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><p>Before you install and configure the Compute service, you must create databases, service credentials, and API endpoints.</p>
<ol>
<li><p>To create the databases, complete these steps:</p>
<ul>
<li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql</span></span><br><span class="line"></span><br><span class="line">​```bash</span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ol>
<ul>
<li><p>Create the <code>nova_api</code>, <code>nova</code>, and <code>nova_cell0</code> databases:</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_api;</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova;</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_cell0;</span><br><span class="line"></span><br><span class="line">​```bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>Grant proper access to the databases:</p>
<pre><code>​```
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO &apos;nova&apos;@&apos;localhost&apos; \
  IDENTIFIED BY &apos;NOVA_DBPASS&apos;;
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO &apos;nova&apos;@&apos;%&apos; \
  IDENTIFIED BY &apos;NOVA_DBPASS&apos;;

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO &apos;nova&apos;@&apos;localhost&apos; \
  IDENTIFIED BY &apos;NOVA_DBPASS&apos;;
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO &apos;nova&apos;@&apos;%&apos; \
  IDENTIFIED BY &apos;NOVA_DBPASS&apos;;

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO &apos;nova&apos;@&apos;localhost&apos; \
  IDENTIFIED BY &apos;NOVA_DBPASS&apos;;
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO &apos;nova&apos;@&apos;%&apos; \
  IDENTIFIED BY &apos;NOVA_DBPASS&apos;;

​```

Replace `NOVA_DBPASS` with a suitable password.</code></pre><ul>
<li>Exit the database access client.</li>
</ul>
</li>
</ul>
<ol>
<li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br><span class="line"></span><br><span class="line">​```bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the Compute service credentials:</p>
<ul>
<li><p>Create the <code>nova</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain default --password-prompt nova</span><br><span class="line"></span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 8a7dbf5279404537b1c7b86c033620fe |</span><br><span class="line">| name                | nova                             |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the <code>admin</code> role to the <code>nova</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user nova admin</span><br></pre></td></tr></table></figure>

<p>This command provides no output.</p>
</li>
<li><p>Create the <code>nova</code> service entity:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name nova \</span><br><span class="line">  --description <span class="string">"OpenStack Compute"</span> compute</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Compute                |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 060d59eac51b4594815603d75a00aba2 |</span><br><span class="line">| name        | nova                             |</span><br><span class="line">| <span class="built_in">type</span>        | compute                          |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Create the Compute API service endpoints:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  compute public http://controller:8774/v2.1</span><br><span class="line"></span><br><span class="line">+--------------+-------------------------------------------+</span><br><span class="line">| Field        | Value                                     |</span><br><span class="line">+--------------+-------------------------------------------+</span><br><span class="line">| enabled      | True                                      |</span><br><span class="line">| id           | 3c1caa473bfe4390a11e7177894bcc7b          |</span><br><span class="line">| interface    | public                                    |</span><br><span class="line">| region       | RegionOne                                 |</span><br><span class="line">| region_id    | RegionOne                                 |</span><br><span class="line">| service_id   | 060d59eac51b4594815603d75a00aba2          |</span><br><span class="line">| service_name | nova                                      |</span><br><span class="line">| service_type | compute                                   |</span><br><span class="line">| url          | http://controller:8774/v2.1               |</span><br><span class="line">+--------------+-------------------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  compute internal http://controller:8774/v2.1</span><br><span class="line"></span><br><span class="line">+--------------+-------------------------------------------+</span><br><span class="line">| Field        | Value                                     |</span><br><span class="line">+--------------+-------------------------------------------+</span><br><span class="line">| enabled      | True                                      |</span><br><span class="line">| id           | e3c918de680746a586eac1f2d9bc10ab          |</span><br><span class="line">| interface    | internal                                  |</span><br><span class="line">| region       | RegionOne                                 |</span><br><span class="line">| region_id    | RegionOne                                 |</span><br><span class="line">| service_id   | 060d59eac51b4594815603d75a00aba2          |</span><br><span class="line">| service_name | nova                                      |</span><br><span class="line">| service_type | compute                                   |</span><br><span class="line">| url          | http://controller:8774/v2.1               |</span><br><span class="line">+--------------+-------------------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  compute admin http://controller:8774/v2.1</span><br><span class="line"></span><br><span class="line">+--------------+-------------------------------------------+</span><br><span class="line">| Field        | Value                                     |</span><br><span class="line">+--------------+-------------------------------------------+</span><br><span class="line">| enabled      | True                                      |</span><br><span class="line">| id           | 38f7af91666a47cfb97b4dc790b94424          |</span><br><span class="line">| interface    | admin                                     |</span><br><span class="line">| region       | RegionOne                                 |</span><br><span class="line">| region_id    | RegionOne                                 |</span><br><span class="line">| service_id   | 060d59eac51b4594815603d75a00aba2          |</span><br><span class="line">| service_name | nova                                      |</span><br><span class="line">| service_type | compute                                   |</span><br><span class="line">| url          | http://controller:8774/v2.1               |</span><br><span class="line">+--------------+-------------------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a Placement service user using your chosen <code>PLACEMENT_PASS</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain default --password-prompt placement</span><br><span class="line"></span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | fa742015a6494a949f67629884fc7ec8 |</span><br><span class="line">| name                | placement                        |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the Placement user to the service project with the admin role:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user placement admin</span><br></pre></td></tr></table></figure>

<p>This command provides no output.</p>
</li>
<li><p>Create the Placement API entry in the service catalog:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name placement --description <span class="string">"Placement API"</span> placement</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Placement API                    |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 2d1a27022e6e4185b86adac4444c495f |</span><br><span class="line">| name        | placement                        |</span><br><span class="line">| <span class="built_in">type</span>        | placement                        |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the Placement API service endpoints:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne placement public http://controller:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 2b1b2637908b4137a9c2e0470487cbc0 |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 2d1a27022e6e4185b86adac4444c495f |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http://controller:8778           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne placement internal http://controller:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 02bcda9a150a4bd7993ff4879df971ab |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 2d1a27022e6e4185b86adac4444c495f |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http://controller:8778           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne placement admin http://controller:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 3d71177b9e0f406f98cbff198d74b182 |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 2d1a27022e6e4185b86adac4444c495f |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http://controller:8778           |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Install-and-configure-components-1"><a href="#Install-and-configure-components-1" class="headerlink" title="Install and configure components"></a>Install and configure components</h3><p>Default configuration files vary by distribution. You might need to add these sections and options rather than modifying existing sections and options. Also, an ellipsis (<code>...</code>) in the configuration snippets indicates potential default configuration options that you should retain.</p>
<ol>
<li><p>Install the packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install nova-api nova-conductor nova-consoleauth \</span></span><br><span class="line">  nova-novncproxy nova-scheduler nova-placement-api</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol>
<li><p>Edit the <code>/etc/nova/nova.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[api_database]</code> and <code>[database]</code> sections, configure database access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[api_database]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api</span><br><span class="line"></span><br><span class="line">[database]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova</span><br></pre></td></tr></table></figure>

<p>Replace <code>NOVA_DBPASS</code> with the password you chose for the Compute databases.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br></pre></td></tr></table></figure>

<p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p>
</li>
<li><p>In the <code>[api]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[api]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = nova</span><br></pre></td></tr></table></figure>

<p>Replace <code>nova</code> with the password you chose for the <code>nova</code> user in the Identity service.</p>
<p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure the <code>my_ip</code> option to use the management interface IP address of the controller node:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">my_ip = 10.20.0.10</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>In the <code>[DEFAULT]</code> section, enable support for the Networking service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">use_neutron = True</span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br></pre></td></tr></table></figure>

<p>By default, Compute uses an internal firewall driver. Since the Networking service includes a firewall driver, you must disable the Compute firewall driver by using the <code>nova.virt.firewall.NoopFirewallDriver</code> firewall driver.</p>
</li>
</ul>
<ul>
<li><p>In the <code>[vnc]</code> section, configure the VNC proxy to use the management interface IP address of the controller node:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[vnc]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">vncserver_listen = <span class="variable">$my_ip</span></span><br><span class="line">vncserver_proxyclient_address = <span class="variable">$my_ip</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>In the <code>[glance]</code> section, configure the location of the Image service API:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[glance]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">api_servers = http://controller:9292</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>In the <code>[oslo_concurrency]</code> section, configure the lock path:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oslo_concurrency]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li>Due to a packaging bug, remove the <code>log_dir</code> option from the <code>[DEFAULT]</code> section.</li>
</ul>
<ul>
<li><p>In the <code>[placement]</code> section, configure the Placement API:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[placement]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">os_region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:35357/v3</span><br><span class="line">username = placement</span><br><span class="line">password = PLACEMENT_PASS</span><br></pre></td></tr></table></figure>

<p>Replace <code>PLACEMENT_PASS</code> with the password you choose for the <code>placement</code> user in the Identity service. Comment out any other options in the <code>[placement]</code> section.</p>
</li>
</ul>
<ol>
<li><p>Populate the nova-api database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "nova-manage api_db sync" nova</span></span><br></pre></td></tr></table></figure>

<p>Ignore any deprecation messages in this output.</p>
</li>
<li><p>Register the <code>cell0</code> database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the <code>cell1</code> cell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova</span></span><br><span class="line">109e1d4b-536a-40d0-83c6-5f121b82b650</span><br></pre></td></tr></table></figure>
</li>
<li><p>Populate the nova database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "nova-manage db sync" nova</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Verify nova cell0 and cell1 are registered correctly:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nova-manage cell_v2 list_cells</span></span><br><span class="line">+-------+--------------------------------------+</span><br><span class="line">| Name  | UUID                                 |</span><br><span class="line">+-------+--------------------------------------+</span><br><span class="line">| cell1 | 109e1d4b-536a-40d0-83c6-5f121b82b650 |</span><br><span class="line">| cell0 | 00000000-0000-0000-0000-000000000000 |</span><br><span class="line">+-------+--------------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Finalize-installation-1"><a href="#Finalize-installation-1" class="headerlink" title="Finalize installation"></a>Finalize installation</h3><ul>
<li><p>Restart the Compute services:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service nova-api restart</span></span><br><span class="line"><span class="comment"># service nova-consoleauth restart</span></span><br><span class="line"><span class="comment"># service nova-scheduler restart</span></span><br><span class="line"><span class="comment"># service nova-conductor restart</span></span><br><span class="line"><span class="comment"># service nova-novncproxy restart</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Nova-Install-and-configure-a-compute-node"><a href="#Nova-Install-and-configure-a-compute-node" class="headerlink" title="Nova Install and configure a compute node"></a>Nova Install and configure a compute node</h2><p>This section describes how to install and configure the Compute service on a compute node. The service supports several <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-hypervisor" target="_blank" rel="noopener">hypervisors</a> to deploy <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-instance" target="_blank" rel="noopener">instances</a> or <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-virtual-machine-vm" target="_blank" rel="noopener">VMs</a>. For simplicity, this configuration uses the <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-quick-emulator-qemu" target="_blank" rel="noopener">QEMU</a> hyper visor with the <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-kernel-based-vm-kvm" target="_blank" rel="noopener">KVM</a> extension on compute nodes that support hardware acceleration for virtual machines. </p>
<h3 id="Install-and-configure-components-2"><a href="#Install-and-configure-components-2" class="headerlink" title="Install and configure components"></a>Install and configure components</h3><ol>
<li><p>Install the packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install nova-compute</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol>
<li><p>Edit the <code>/etc/nova/nova.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br></pre></td></tr></table></figure>

<p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">...</span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = nova</span><br></pre></td></tr></table></figure>

<p>Replace <code>password = nova</code> with the password you chose for the <code>nova</code> user in the Identity service.</p>
<p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>In the <code>[DEFAULT]</code> section, configure the <code>my_ip</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">my_ip = MANAGEMENT_INTERFACE_IP_ADDRESS</span><br></pre></td></tr></table></figure>

<p>Replace <code>MANAGEMENT_INTERFACE_IP_ADDRESS</code> with the IP address of the management network interface on your compute node, typically 10.0.0.31 for the first node in the <a href="https://docs.openstack.org/newton/install-guide-ubuntu/overview.html#overview-example-architectures" target="_blank" rel="noopener">example architecture</a>.</p>
<blockquote>
<p> here our compute is 10.20.0.20</p>
</blockquote>
</li>
<li><p>In the <code>[DEFAULT]</code> section, enable support for the Networking service:</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">use_neutron &#x3D; True</span><br><span class="line">firewall_driver &#x3D; nova.virt.firewall.NoopFirewallDriver</span><br></pre></td></tr></table></figure>

By default, Compute uses an internal firewall service. Since Networking includes a firewall service, you must disable the Compute firewall service by using the `nova.virt.firewall.NoopFirewallDriver` firewall driver.</code></pre></li>
</ul>
<ul>
<li><p>In the <code>[vnc]</code> section, enable and configure remote console access:</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[vnc]</span><br><span class="line">...</span><br><span class="line">enabled = True</span><br><span class="line">vncserver_listen = 0.0.0.0</span><br><span class="line">vncserver_proxyclient_address = <span class="variable">$my_ip</span></span><br><span class="line">novncproxy_base_url = http://controller:6080/vnc_auto.html</span><br></pre></td></tr></table></figure>

<p>   The server component listens on all IP addresses and the proxy component only listens on the management interface IP address of the compute node. </p>
<p>   The base URL indicates the location where you can use a web browser to access remote consoles of instances on this compute node.</p>
<p>   If the web browser to access remote consoles resides on a host that cannot resolve the <code>controller</code> hostname, you must replace <code>controller</code> with the management interface IP address of the controller node.</p>
</li>
<li><p>In the <code>[glance]</code> section, configure the location of the Image service API:</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[glance]</span><br><span class="line">...</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line">​</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the <code>[oslo_concurrency]</code> section, configure the lock path:</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oslo_concurrency]</span><br><span class="line">...</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>Due to a packaging bug, remove the <code>log-dir</code> option from the <code>[DEFAULT]</code> section.</p>
</li>
<li><p>In the <code>[placement]</code> section, configure the Placement API:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[placement]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">os_region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:35357/v3</span><br><span class="line">username = placement</span><br><span class="line">password = placement</span><br><span class="line">​</span><br></pre></td></tr></table></figure>

<p>Replace <code>placement</code> with the password you choose for the <code>placement</code> user in the Identity service. Comment out any other options in the <code>[placement]</code> section.</p>
</li>
</ul>
<h3 id="Finalize-installation-2"><a href="#Finalize-installation-2" class="headerlink" title="Finalize installation"></a>Finalize installation</h3><p>Determine whether your compute node supports hardware acceleration for virtual machines:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ egrep -c <span class="string">'(vmx|svm)'</span> /proc/cpuinfo</span><br></pre></td></tr></table></figure>

<p>If this command returns a value of <code>one or greater</code>, your compute node supports hardware acceleration which typically requires no additional configuration.</p>
<p>If this command returns a value of <code>zero</code>, your compute node does not support hardware acceleration and you must configure <code>libvirt</code> to use QEMU instead of KVM.</p>
<ul>
<li><p>Edit the <code>[libvirt]</code> section in the <code>/etc/nova/nova-compute.conf</code> file as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[libvirt]</span><br><span class="line">...</span><br><span class="line">virt_type = qemu</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>Restart the Compute service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service nova-compute restart</span></span><br></pre></td></tr></table></figure>

<h3 id="Add-the-compute-node-to-the-cell-database"><a href="#Add-the-compute-node-to-the-cell-database" class="headerlink" title="Add the compute node to the cell database"></a>Add the compute node to the cell database</h3><p>Run the following commands on the <strong>controller</strong> node.</p>
<ol>
<li><p>Source the admin credentials to enable admin-only CLI commands, then confirm there are compute hosts in the database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br><span class="line"></span><br><span class="line">$ openstack hypervisor list</span><br><span class="line">+----+---------------------+-----------------+-----------+-------+</span><br><span class="line">| ID | Hypervisor Hostname | Hypervisor Type | Host IP   | State |</span><br><span class="line">+----+---------------------+-----------------+-----------+-------+</span><br><span class="line">|  1 | compute1            | QEMU            | 10.0.0.31 | up    |</span><br><span class="line">+----+---------------------+-----------------+-----------+-------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Discover compute hosts:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose" nova</span></span><br><span class="line"></span><br><span class="line">Found 2 cell mappings.</span><br><span class="line">Skipping cell0 since it does not contain hosts.</span><br><span class="line">Getting compute nodes from cell <span class="string">'cell1'</span>: ad5a5985-a719-4567-98d8-8d148aaae4bc</span><br><span class="line">Found 1 computes <span class="keyword">in</span> cell: ad5a5985-a719-4567-98d8-8d148aaae4bc</span><br><span class="line">Checking host mapping <span class="keyword">for</span> compute host <span class="string">'compute'</span>: fe58ddc1-1d65-4f87-9456-bc040dc106b3</span><br><span class="line">Creating host mapping <span class="keyword">for</span> compute host <span class="string">'compute'</span>: fe58ddc1-1d65-4f87-9456-bc040dc106b3</span><br></pre></td></tr></table></figure>



</li>
</ol>
<p>   When you add new compute nodes, you must run <code>nova-manage cell_v2 discover_hosts</code> on the controller node to register those new compute nodes. Alternatively, you can set an appropriate interval in <code>/etc/nova/nova.conf</code>:</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[scheduler]</span><br><span class="line">discover_hosts_in_cells_interval = 300</span><br></pre></td></tr></table></figure>

<h2 id="Neutron-installation"><a href="#Neutron-installation" class="headerlink" title="Neutron installation"></a>Neutron installation</h2><blockquote>
<p>ref: <a href="https://docs.openstack.org/newton/install-guide-ubuntu/neutron.html" target="_blank" rel="noopener">https://docs.openstack.org/newton/install-guide-ubuntu/neutron.html</a></p>
</blockquote>
<p>This chapter explains how to install and configure the Networking service (neutron) using the <a href="https://docs.openstack.org/newton/install-guide-ubuntu/overview.html#network1" target="_blank" rel="noopener">provider networks</a>. </p>
<p>For more information about the Networking service including virtual networking components, layout, and traffic flows, see the <a href="http://docs.openstack.org/newton/networking-guide/" target="_blank" rel="noopener">OpenStack Networking Guide</a>.</p>
<h2 id="Tenant-Project-network-configuration"><a href="#Tenant-Project-network-configuration" class="headerlink" title="Tenant/Project network configuration"></a>Tenant/Project network configuration</h2><p>On both Controller and Compute node, Tenant/Project network (eth1 in our design) need to be configured:</p>
<p><code># vi /etc/network/interfaces</code></p>
<p>Add below lines accordingly:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## provider network</span></span><br><span class="line">auto enp0s8</span><br><span class="line">iface enp0s8 inet static</span><br><span class="line">address 172.16.0.x (10 <span class="keyword">for</span> controller 20 <span class="keyword">for</span> compute)</span><br><span class="line">netmask 255.255.255.0</span><br></pre></td></tr></table></figure>

<h2 id="Neutron-Install-and-configure-controller-node"><a href="#Neutron-Install-and-configure-controller-node" class="headerlink" title="Neutron Install and configure controller node"></a>Neutron Install and configure controller node</h2><h3 id="Prerequisites-2"><a href="#Prerequisites-2" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><p>Before you configure the OpenStack Networking (neutron) service, you must create a database, service credentials, and API endpoints.</p>
<ol>
<li><p>To create the database, complete these steps:</p>
<ul>
<li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root -p</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the <code>neutron</code> database:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE neutron;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Grant proper access to the <code>neutron</code> database, replacing <code>NEUTRON_DBPASS</code> with a suitable password:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON neutron.* TO &#39;neutron&#39;@&#39;localhost&#39; \</span><br><span class="line">  IDENTIFIED BY &#39;NEUTRON_DBPASS&#39;;</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON neutron.* TO &#39;neutron&#39;@&#39;%&#39; \</span><br><span class="line">  IDENTIFIED BY &#39;NEUTRON_DBPASS&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Exit the database access client.</p>
</li>
</ul>
</li>
<li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>To create the service credentials, complete these steps:</p>
<ul>
<li><p>Create the <code>neutron</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain default --password-prompt neutron</span><br><span class="line"></span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 319f34694728440eb8ffcb27b6dd8b8a |</span><br><span class="line">| name                | neutron                          |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the <code>admin</code> role to the <code>neutron</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user neutron admin</span><br></pre></td></tr></table></figure>

<p>This command provides no output.</p>
</li>
<li><p>Create the <code>neutron</code> service entity:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name neutron \</span><br><span class="line">  --description <span class="string">"OpenStack Networking"</span> network</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Networking             |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | f71529314dab4a4d8eca427e701d209e |</span><br><span class="line">| name        | neutron                          |</span><br><span class="line">| <span class="built_in">type</span>        | network                          |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Create the Networking service API endpoints:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  network public http://controller:9696</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 85d80a6d02fc4b7683f611d7fc1493a3 |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | f71529314dab4a4d8eca427e701d209e |</span><br><span class="line">| service_name | neutron                          |</span><br><span class="line">| service_type | network                          |</span><br><span class="line">| url          | http://controller:9696           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  network internal http://controller:9696</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 09753b537ac74422a68d2d791cf3714f |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | f71529314dab4a4d8eca427e701d209e |</span><br><span class="line">| service_name | neutron                          |</span><br><span class="line">| service_type | network                          |</span><br><span class="line">| url          | http://controller:9696           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  network admin http://controller:9696</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 1ee14289c9374dffb5db92a5c112fc4e |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | f71529314dab4a4d8eca427e701d209e |</span><br><span class="line">| service_name | neutron                          |</span><br><span class="line">| service_type | network                          |</span><br><span class="line">| url          | http://controller:9696           |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Configure-networking-options"><a href="#Configure-networking-options" class="headerlink" title="Configure networking options"></a>Configure networking options</h3><p>You can deploy the Networking service using one of two architectures represented by options 1 and 2.</p>
<p>Option 1 deploys the simplest possible architecture that only supports attaching instances to provider (external) networks. No self-service (private) networks, routers, or floating IP addresses. Only the <code>admin</code> or other privileged user can manage provider networks.</p>
<ul>
<li><a href="https://docs.openstack.org/newton/install-guide-ubuntu/neutron-controller-install-option1.html" target="_blank" rel="noopener">Networking Option 1: Provider networks</a></li>
</ul>
<p>Here we choose Option 1.</p>
<h3 id="Networking-Option-1-Provider-networks"><a href="#Networking-Option-1-Provider-networks" class="headerlink" title="Networking Option 1: Provider networks"></a>Networking Option 1: Provider networks</h3><p>Install and configure the Networking components on the <em>controller</em> node.</p>
<h3 id="Install-the-components"><a href="#Install-the-components" class="headerlink" title="Install the components"></a>Install the components</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install neutron-server neutron-plugin-ml2 \</span></span><br><span class="line">  neutron-linuxbridge-agent neutron-dhcp-agent \</span><br><span class="line">  neutron-metadata-agent -y</span><br></pre></td></tr></table></figure>

<h3 id="Configure-the-server-component"><a href="#Configure-the-server-component" class="headerlink" title="Configure the server component"></a>Configure the server component</h3><p>The Networking server component configuration includes the database, authentication mechanism, message queue, topology change notifications, and plug-in.</p>
<ul>
<li><p>Edit the <code>/etc/neutron/neutron.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[database]</code> section, configure database access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">...</span><br><span class="line">connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron</span><br></pre></td></tr></table></figure>

<p>Replace <code>NEUTRON_DBPASS</code> with the password you chose for the database.</p>
<p>Comment out or remove any other <code>connection</code> options in the <code>[database]</code> section.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, enable the Modular Layer 2 (ML2) plug-in and disable additional plug-ins:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins =</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br></pre></td></tr></table></figure>

<p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in RabbitMQ.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">...</span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = neutron</span><br></pre></td></tr></table></figure>

<p>Replace <code>password = neutron</code> with the password you chose for the <code>neutron</code> user in the Identity service.</p>
<p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> and <code>[nova]</code> sections, configure Networking to notify Compute of network topology changes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">notify_nova_on_port_status_changes = True</span><br><span class="line">notify_nova_on_port_data_changes = True</span><br><span class="line"></span><br><span class="line">[nova]</span><br><span class="line">...</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = nova</span><br></pre></td></tr></table></figure>

<p>Replace <code>password = nova</code> with the password you chose for the <code>nova</code> user in the Identity service.</p>
</li>
</ul>
</li>
</ul>
<h3 id="Configure-the-Modular-Layer-2-ML2-plug-in"><a href="#Configure-the-Modular-Layer-2-ML2-plug-in" class="headerlink" title="Configure the Modular Layer 2 (ML2) plug-in"></a>Configure the Modular Layer 2 (ML2) plug-in</h3><p>The ML2 plug-in uses the Linux bridge mechanism to build layer-2 (bridging and switching) virtual networking infrastructure for instances.</p>
<ul>
<li><p>Edit the <code>/etc/neutron/plugins/ml2/ml2_conf.ini</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[ml2]</code> section, enable flat and VLAN networks:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ml2]</span><br><span class="line">...</span><br><span class="line">type_drivers = flat,vlan</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the <code>[ml2]</code> section, disable self-service networks:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ml2]</span><br><span class="line">...</span><br><span class="line">tenant_network_types =</span><br><span class="line"></span><br><span class="line">​```bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the <code>[ml2]</code> section, enable the Linux bridge mechanism:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ml2]</span><br><span class="line">...</span><br><span class="line">mechanism_drivers = linuxbridge</span><br></pre></td></tr></table></figure>

<p>After you configure the ML2 plug-in, removing values in the <code>type_drivers</code> option can lead to database inconsistency.</p>
</li>
<li><p>In the <code>[ml2]</code> section, enable the port security extension driver:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ml2]</span><br><span class="line">...</span><br><span class="line">extension_drivers = port_security</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the <code>[ml2_type_flat]</code> section, configure the provider virtual network as a flat network:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ml2_type_flat]</span><br><span class="line">...</span><br><span class="line">flat_networks = provider</span><br><span class="line"></span><br><span class="line">​```bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the <code>[securitygroup]</code> section, enable <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-ipset" target="_blank" rel="noopener">ipset</a> to increase efficiency of security group rules:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[securitygroup]</span><br><span class="line">...</span><br><span class="line">enable_ipset = True</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="Configure-the-Linux-bridge-agent"><a href="#Configure-the-Linux-bridge-agent" class="headerlink" title="Configure the Linux bridge agent"></a>Configure the Linux bridge agent</h3><p>The Linux bridge agent builds layer-2 (bridging and switching) virtual networking infrastructure for instances and handles security groups.</p>
<ul>
<li><p>Edit the <code>/etc/neutron/plugins/ml2/linuxbridge_</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[linux_bridge]</code> section, map the provider virtual network to the provider physical network interface:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME</span><br></pre></td></tr></table></figure>

<p>Replace <code>PROVIDER_INTERFACE_NAME</code> with the name of the underlying provider physical network interface. See <a href="https://docs.openstack.org/newton/install-guide-ubuntu/environment-networking.html#environment-networking" target="_blank" rel="noopener">Host networking</a> for more information.</p>
<p>in our case it is: enp0s10, the bridged nic of controller network.</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>In the <code>[vxlan]</code> section, disable VXLAN overlay networks:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = False</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the <code>[securitygroup]</code> section, enable security groups and configure the Linux bridge <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-iptables" target="_blank" rel="noopener">iptables</a> firewall driver:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[securitygroup]</span><br><span class="line">...</span><br><span class="line">enable_security_group = True</span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Configure-the-DHCP-agent"><a href="#Configure-the-DHCP-agent" class="headerlink" title="Configure the DHCP agent"></a>Configure the DHCP agent</h3><p>The <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-dhcp-agent" target="_blank" rel="noopener">DHCP agent</a> provides DHCP services for virtual networks.</p>
<ul>
<li><p>Edit the <code>/etc/neutron/dhcp_agent.ini</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[DEFAULT]</code> section, configure the Linux bridge interface driver, Dnsmasq DHCP driver, and enable isolated metadata so instances on provider networks can access metadata over the network:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">interface_driver = neutron.agent.linux.interface.BridgeInterfaceDriver</span><br><span class="line">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">enable_isolated_metadata = True</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>Return to <a href="https://docs.openstack.org/newton/install-guide-ubuntu/neutron-controller-install.html#neutron-controller-metadata-agent" target="_blank" rel="noopener">Networking controller node configuration</a>.</p>
<h3 id="Configure-the-metadata-agent"><a href="#Configure-the-metadata-agent" class="headerlink" title="Configure the metadata agent"></a>Configure the metadata agent</h3><p>The <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-metadata-agent" target="_blank" rel="noopener">metadata agent</a> provides configuration information such as credentials to instances.</p>
<ul>
<li><p>Edit the <code>/etc/neutron/metadata_agent.ini</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[DEFAULT]</code> section, configure the metadata host and shared secret:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">nova_metadata_ip = controller</span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br></pre></td></tr></table></figure>

<p>Replace <code>METADATA_SECRET</code> with a suitable secret for the metadata proxy.</p>
</li>
</ul>
</li>
</ul>
<h3 id="Configure-the-Compute-service-to-use-the-Networking-service"><a href="#Configure-the-Compute-service-to-use-the-Networking-service" class="headerlink" title="Configure the Compute service to use the Networking service"></a>Configure the Compute service to use the Networking service</h3><ul>
<li><p>Edit the <code>/etc/nova/nova.conf</code> file and perform the following actions:</p>
<ul>
<li><p>In the <code>[neutron]</code> section, configure access parameters, enable the metadata proxy, and configure the secret:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[neutron]</span><br><span class="line">...</span><br><span class="line">url = http://controller:9696</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = neutron</span><br><span class="line">service_metadata_proxy = True</span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br></pre></td></tr></table></figure>

<p>Replace <code>password = neutron</code> with the password you chose for the <code>neutron</code> user in the Identity service.</p>
<p>Replace <code>METADATA_SECRET</code> with the secret you chose for the metadata proxy.</p>
</li>
</ul>
</li>
</ul>
<h3 id="Finalize-installation-3"><a href="#Finalize-installation-3" class="headerlink" title="Finalize installation"></a>Finalize installation</h3><ol>
<li><p>Populate the database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf \</span></span><br><span class="line">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head<span class="string">" neutron</span></span><br></pre></td></tr></table></figure>

<p>Database population occurs later for Networking because the script requires complete server and plug-in configuration files.</p>
</li>
<li><p>Restart the Compute API service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service nova-api restart</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Restart the Networking services.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service neutron-server restart</span></span><br><span class="line"><span class="comment"># service neutron-linuxbridge-agent restart</span></span><br><span class="line"><span class="comment"># service neutron-dhcp-agent restart</span></span><br><span class="line"><span class="comment"># service neutron-metadata-agent restart</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="Verify-operation-2"><a href="#Verify-operation-2" class="headerlink" title="Verify operation"></a>Verify operation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack network agent list --max-width 50</span></span><br><span class="line">+----------+------------+----------+-------------------+-------+-------+----------+</span><br><span class="line">| ID       | Agent Type | Host     | Availability Zone | Alive | State | Binary   |</span><br><span class="line">+----------+------------+----------+-------------------+-------+-------+----------+</span><br><span class="line">| 1d661145 | Linux      | controll | None              | True  | UP    | neutron- |</span><br><span class="line">| -0941    | bridge     | er       |                   |       |       | linuxbri |</span><br><span class="line">| -411d-9b | agent      |          |                   |       |       | dge-     |</span><br><span class="line">| 18-b3371 |            |          |                   |       |       | agent    |</span><br><span class="line">| fe57c4b  |            |          |                   |       |       |          |</span><br><span class="line">| 7502e1a3 | DHCP agent | controll | nova              | True  | UP    | neutron- |</span><br><span class="line">| -998d-   |            | er       |                   |       |       | dhcp-    |</span><br><span class="line">| 4aca-91e |            |          |                   |       |       | agent    |</span><br><span class="line">| 4-ca17e1 |            |          |                   |       |       |          |</span><br><span class="line">| b10c82   |            |          |                   |       |       |          |</span><br><span class="line">| 7c47ac70 | Metadata   | controll | None              | True  | UP    | neutron- |</span><br><span class="line">| -5de2-44 | agent      | er       |                   |       |       | metadata |</span><br><span class="line">| 42-8fc1- |            |          |                   |       |       | -agent   |</span><br><span class="line">| 91fe97ae |            |          |                   |       |       |          |</span><br><span class="line">| 120f     |            |          |                   |       |       |          |</span><br><span class="line">+----------+------------+----------+-------------------+-------+-------+----------+</span><br></pre></td></tr></table></figure>



<h2 id="Neutron-Install-and-configure-compute-node"><a href="#Neutron-Install-and-configure-compute-node" class="headerlink" title="Neutron Install and configure compute node"></a>Neutron Install and configure compute node</h2><p>The compute node handles connectivity and <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-security-group" target="_blank" rel="noopener">security groups</a> for instances.</p>
<h3 id="Install-the-components-1"><a href="#Install-the-components-1" class="headerlink" title="Install the components"></a>Install the components</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install neutron-linuxbridge-agent -y</span></span><br></pre></td></tr></table></figure>

<h3 id="Configure-the-common-component"><a href="#Configure-the-common-component" class="headerlink" title="Configure the common component"></a>Configure the common component</h3><p>The Networking common component configuration includes the authentication mechanism, message queue, and plug-in.</p>
<ul>
<li><p>Edit the <code>/etc/neutron/neutron.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[database]</code> section, comment out any <code>connection</code> options because compute nodes do not directly access the database.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br></pre></td></tr></table></figure>

<p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in RabbitMQ.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">...</span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = neutron</span><br></pre></td></tr></table></figure>

<p>Replace <code>password = neutron</code> with the password you chose for the <code>neutron</code> user in the Identity service.</p>
<p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p>
</li>
</ul>
</li>
</ul>
<h3 id="Configure-networking-options-1"><a href="#Configure-networking-options-1" class="headerlink" title="Configure networking options"></a>Configure networking options</h3><p>Choose the same networking option that you chose for the controller node to configure services specific to it. Afterwards, return here and proceed to <a href="https://docs.openstack.org/newton/install-guide-ubuntu/neutron-compute-install.html#neutron-compute-compute" target="_blank" rel="noopener">Configure the Compute service to use the Networking service</a>.</p>
<ul>
<li><a href="https://docs.openstack.org/newton/install-guide-ubuntu/neutron-compute-install-option1.html" target="_blank" rel="noopener">Networking Option 1: Provider networks</a></li>
</ul>
<h3 id="Configure-the-Linux-bridge-agent-1"><a href="#Configure-the-Linux-bridge-agent-1" class="headerlink" title="Configure the Linux bridge agent"></a>Configure the Linux bridge agent</h3><p>The Linux bridge agent builds layer-2 (bridging and switching) virtual networking infrastructure for instances and handles security groups.</p>
<ul>
<li><p>Edit the <code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[linux_bridge]</code> section, map the provider virtual network to the provider physical network interface:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME</span><br></pre></td></tr></table></figure>

<p>Replace <code>PROVIDER_INTERFACE_NAME</code> with the name of the underlying provider physical network interface. See <a href="https://docs.openstack.org/newton/install-guide-ubuntu/environment-networking.html#environment-networking" target="_blank" rel="noopener">Host networking</a> for more information.</p>
</li>
<li><p>In the <code>[vxlan]</code> section, disable VXLAN overlay networks:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = False</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the <code>[securitygroup]</code> section, enable security groups and configure the Linux bridge <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-iptables" target="_blank" rel="noopener">iptables</a> firewall driver:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[securitygroup]</span><br><span class="line">...</span><br><span class="line">enable_security_group = True</span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>Return to <a href="https://docs.openstack.org/newton/install-guide-ubuntu/neutron-compute-install.html#neutron-compute-compute" target="_blank" rel="noopener">Networking compute node configuration</a>.</p>
<h3 id="Configure-the-Compute-service-to-use-the-Networking-service-1"><a href="#Configure-the-Compute-service-to-use-the-Networking-service-1" class="headerlink" title="Configure the Compute service to use the Networking service"></a>Configure the Compute service to use the Networking service</h3><ul>
<li><p>Edit the <code>/etc/nova/nova.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[neutron]</code> section, configure access parameters:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[neutron]</span><br><span class="line">...</span><br><span class="line">url = http://controller:9696</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = neutron</span><br></pre></td></tr></table></figure>

<p>Replace <code>password = neutron</code> with the password you chose for the <code>neutron</code> user in the Identity service.</p>
</li>
</ul>
</li>
</ul>
<h3 id="Finalize-installation-4"><a href="#Finalize-installation-4" class="headerlink" title="Finalize installation"></a>Finalize installation</h3><ol>
<li><p>Restart the Compute service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service nova-compute restart</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Restart the Linux bridge agent:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service neutron-linuxbridge-agent restart</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Verify-operation-3"><a href="#Verify-operation-3" class="headerlink" title="Verify operation"></a>Verify operation</h3><p>Perform these commands on the controller node.</p>
<ol>
<li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>List loaded extensions to verify successful launch of the <code>neutron-server</code> process:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ neutron ext-list</span><br><span class="line"></span><br><span class="line">+---------------------------+-----------------------------------------------+</span><br><span class="line">| <span class="built_in">alias</span>                     | name                                          |</span><br><span class="line">+---------------------------+-----------------------------------------------+</span><br><span class="line">| default-subnetpools       | Default Subnetpools                           |</span><br><span class="line">| network-ip-availability   | Network IP Availability                       |</span><br><span class="line">| network_availability_zone | Network Availability Zone                     |</span><br><span class="line">| auto-allocated-topology   | Auto Allocated Topology Services              |</span><br><span class="line">| ext-gw-mode               | Neutron L3 Configurable external gateway mode |</span><br><span class="line">| binding                   | Port Binding                                  |</span><br><span class="line">| agent                     | agent                                         |</span><br><span class="line">| subnet_allocation         | Subnet Allocation                             |</span><br><span class="line">| l3_agent_scheduler        | L3 Agent Scheduler                            |</span><br><span class="line">| tag                       | Tag support                                   |</span><br><span class="line">| external-net              | Neutron external network                      |</span><br><span class="line">| net-mtu                   | Network MTU                                   |</span><br><span class="line">| availability_zone         | Availability Zone                             |</span><br><span class="line">| quotas                    | Quota management support                      |</span><br><span class="line">| l3-ha                     | HA Router extension                           |</span><br><span class="line">| flavors                   | Neutron Service Flavors                       |</span><br><span class="line">| provider                  | Provider Network                              |</span><br><span class="line">| multi-provider            | Multi Provider Network                        |</span><br><span class="line">| address-scope             | Address scope                                 |</span><br><span class="line">| extraroute                | Neutron Extra Route                           |</span><br><span class="line">| timestamp_core            | Time Stamp Fields addition <span class="keyword">for</span> core resources |</span><br><span class="line">| router                    | Neutron L3 Router                             |</span><br><span class="line">| extra_dhcp_opt            | Neutron Extra DHCP opts                       |</span><br><span class="line">| dns-integration           | DNS Integration                               |</span><br><span class="line">| security-group            | security-group                                |</span><br><span class="line">| dhcp_agent_scheduler      | DHCP Agent Scheduler                          |</span><br><span class="line">| router_availability_zone  | Router Availability Zone                      |</span><br><span class="line">| rbac-policies             | RBAC Policies                                 |</span><br><span class="line">| standard-attr-description | standard-attr-description                     |</span><br><span class="line">| port-security             | Port Security                                 |</span><br><span class="line">| allowed-address-pairs     | Allowed Address Pairs                         |</span><br><span class="line">| dvr                       | Distributed Virtual Router                    |</span><br><span class="line">+---------------------------+-----------------------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>List agents to verify successful launch of the neutron agents:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ openstack network agent list</span><br><span class="line"></span><br><span class="line">root@controller:~<span class="comment"># openstack network agent list --max-width 70</span></span><br><span class="line">+----------+------------+----------+-------------------+-------+-------+------------+</span><br><span class="line">| ID       | Agent Type | Host     | Availability Zone | Alive | State | Binary     |</span><br><span class="line">+----------+------------+----------+-------------------+-------+-------+------------+</span><br><span class="line">| 143d7731 | Linux      | compute  | None              | True  | UP    | neutron-li |</span><br><span class="line">| -9227-4b | bridge     |          |                   |       |       | nuxbridge- |</span><br><span class="line">| af-9052- | agent      |          |                   |       |       | agent      |</span><br><span class="line">| 292d7aea |            |          |                   |       |       |            |</span><br><span class="line">| 6992     |            |          |                   |       |       |            |</span><br><span class="line">| 1d661145 | Linux      | controll | None              | True  | UP    | neutron-li |</span><br><span class="line">| -0941    | bridge     | er       |                   |       |       | nuxbridge- |</span><br><span class="line">| -411d-9b | agent      |          |                   |       |       | agent      |</span><br><span class="line">| 18-b3371 |            |          |                   |       |       |            |</span><br><span class="line">| fe57c4b  |            |          |                   |       |       |            |</span><br><span class="line">| 7502e1a3 | DHCP agent | controll | nova              | True  | UP    | neutron-   |</span><br><span class="line">| -998d-   |            | er       |                   |       |       | dhcp-agent |</span><br><span class="line">| 4aca-91e |            |          |                   |       |       |            |</span><br><span class="line">| 4-ca17e1 |            |          |                   |       |       |            |</span><br><span class="line">| b10c82   |            |          |                   |       |       |            |</span><br><span class="line">| 7c47ac70 | Metadata   | controll | None              | True  | UP    | neutron-   |</span><br><span class="line">| -5de2-44 | agent      | er       |                   |       |       | metadata-  |</span><br><span class="line">| 42-8fc1- |            |          |                   |       |       | agent      |</span><br><span class="line">| 91fe97ae |            |          |                   |       |       |            |</span><br><span class="line">| 120f     |            |          |                   |       |       |            |</span><br><span class="line">+----------+------------+----------+-------------------+-------+-------+------------+</span><br></pre></td></tr></table></figure>

<p>The output should indicate three agents on the controller node and one agent on each compute node.</p>
</li>
</ol>
<h2 id="Congratulations-Let’s-try-booting-an-instance"><a href="#Congratulations-Let’s-try-booting-an-instance" class="headerlink" title="Congratulations! Let’s try booting an instance"></a>Congratulations! Let’s try booting an instance</h2><h3 id="Create-provider-network-subnetwork"><a href="#Create-provider-network-subnetwork" class="headerlink" title="Create provider network/subnetwork"></a>Create provider network/subnetwork</h3><blockquote>
<p> ref: <a href="https://docs.openstack.org/newton/install-guide-ubuntu/launch-instance-networks-provider.html" target="_blank" rel="noopener">https://docs.openstack.org/newton/install-guide-ubuntu/launch-instance-networks-provider.html</a></p>
</blockquote>
<blockquote>
<p>The –provider:physical_network provider and –provider:network_type flat options connect the flat virtual network to the flat (native/untagged) physical network on the eth1 interface on the host</p>
</blockquote>
<p>标注: 下边的创建网络里 ，参数:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--provider-network-type flat \</span><br><span class="line">--provider-physical-network provider</span><br></pre></td></tr></table></figure>

<p>对应的是:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/etc/neutron/plugins/ml2/ml2_conf.ini</span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/etc/neutron/plugins/ml2/linuxbridge_agent.ini</span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:enp0s8</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># . admin-openrc</span></span><br><span class="line">root@controller:~<span class="comment"># openstack network create  --share --external \</span></span><br><span class="line">&gt;   --provider-physical-network provider \</span><br><span class="line">&gt;   --provider-network-type flat provider</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | UP                                   |</span><br><span class="line">| availability_zone_hints   |                                      |</span><br><span class="line">| availability_zones        |                                      |</span><br><span class="line">| created_at                | 2017-08-23T17:14:21Z                 |</span><br><span class="line">| description               |                                      |</span><br><span class="line">| dns_domain                | None                                 |</span><br><span class="line">| id                        | 2a33434f-ba29-4645-9b5d-24f1509066f1 |</span><br><span class="line">| ipv4_address_scope        | None                                 |</span><br><span class="line">| ipv6_address_scope        | None                                 |</span><br><span class="line">| is_default                | None                                 |</span><br><span class="line">| mtu                       | 1500                                 |</span><br><span class="line">| name                      | provider                             |</span><br><span class="line">| port_security_enabled     | True                                 |</span><br><span class="line">| project_id                | 78c9c849237649a3a8c4526167427589     |</span><br><span class="line">| provider:network_type     | flat                                 |</span><br><span class="line">| provider:physical_network | provider                             |</span><br><span class="line">| provider:segmentation_id  | None                                 |</span><br><span class="line">| qos_policy_id             | None                                 |</span><br><span class="line">| revision_number           | 4                                    |</span><br><span class="line">| router:external           | External                             |</span><br><span class="line">| segments                  | None                                 |</span><br><span class="line">| shared                    | True                                 |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| updated_at                | 2017-08-23T17:14:21Z                 |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">root@controller:~<span class="comment"># neutron net-list</span></span><br><span class="line">neutron CLI is deprecated and will be removed <span class="keyword">in</span> the future. Use openstack CLI instead.</span><br><span class="line">+--------------------------------------+----------+----------------------------------+---------+</span><br><span class="line">| id                                   | name     | tenant_id                        | subnets |</span><br><span class="line">+--------------------------------------+----------+----------------------------------+---------+</span><br><span class="line">| 2a33434f-ba29-4645-9b5d-24f1509066f1 | provider | 78c9c849237649a3a8c4526167427589 |         |</span><br><span class="line">+--------------------------------------+----------+----------------------------------+---------+</span><br><span class="line">root@controller:~<span class="comment"># openstack network list</span></span><br><span class="line">+--------------------------------------+----------+---------+</span><br><span class="line">| ID                                   | Name     | Subnets |</span><br><span class="line">+--------------------------------------+----------+---------+</span><br><span class="line">| 2a33434f-ba29-4645-9b5d-24f1509066f1 | provider |         |</span><br><span class="line">+--------------------------------------+----------+---------+</span><br><span class="line"></span><br><span class="line">root@controller:~<span class="comment"># openstack subnet create --network provider \</span></span><br><span class="line">&gt;   --allocation-pool start=172.16.0.100,end=172.16.0.200 \</span><br><span class="line">&gt;   --gateway 172.16.0.1 \</span><br><span class="line">&gt;   --subnet-range 172.16.0.1/24 provider</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field             | Value                                |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| allocation_pools  | 172.16.0.100-172.16.0.200            |</span><br><span class="line">| cidr              | 172.16.0.1/24                        |</span><br><span class="line">| created_at        | 2017-08-23T17:17:54Z                 |</span><br><span class="line">| description       |                                      |</span><br><span class="line">| enable_dhcp       | True                                 |</span><br><span class="line">| gateway_ip        | 172.16.0.1                           |</span><br><span class="line">| host_routes       |                                      |</span><br><span class="line">| id                | 9b118521-59b5-40ee-a439-9d59c3b392ea |</span><br><span class="line">| ip_version        | 4                                    |</span><br><span class="line">| ipv6_address_mode | None                                 |</span><br><span class="line">| ipv6_ra_mode      | None                                 |</span><br><span class="line">| name              | provider                             |</span><br><span class="line">| network_id        | 2a33434f-ba29-4645-9b5d-24f1509066f1 |</span><br><span class="line">| project_id        | 78c9c849237649a3a8c4526167427589     |</span><br><span class="line">| revision_number   | 2                                    |</span><br><span class="line">| segment_id        | None                                 |</span><br><span class="line">| service_types     |                                      |</span><br><span class="line">| subnetpool_id     | None                                 |</span><br><span class="line">| updated_at        | 2017-08-23T17:17:54Z                 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>



<h3 id="Create-flavor"><a href="#Create-flavor" class="headerlink" title="Create flavor"></a>Create flavor</h3><p>The smallest default flavor consumes 512 MB memory per instance. For environments with compute nodes containing less than 4 GB memory, we recommend creating the <code>m1.nano</code> flavor that only requires 64 MB per instance. Only use this flavor with the CirrOS image for testing purposes.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ openstack flavor create --id 0 --vcpus 1 --ram 64 --disk 1 m1.nano</span><br><span class="line"></span><br><span class="line">+----------------------------+---------+</span><br><span class="line">| Field                      | Value   |</span><br><span class="line">+----------------------------+---------+</span><br><span class="line">| OS-FLV-DISABLED:disabled   | False   |</span><br><span class="line">| OS-FLV-EXT-DATA:ephemeral  | 0       |</span><br><span class="line">| disk                       | 1       |</span><br><span class="line">| id                         | 0       |</span><br><span class="line">| name                       | m1.nano |</span><br><span class="line">| os-flavor-access:is_public | True    |</span><br><span class="line">| ram                        | 64      |</span><br><span class="line">| rxtx_factor                | 1.0     |</span><br><span class="line">| swap                       |         |</span><br><span class="line">| vcpus                      | 1       |</span><br><span class="line">+----------------------------+---------+</span><br></pre></td></tr></table></figure>

<h3 id="Add-security-group-rules"><a href="#Add-security-group-rules" class="headerlink" title="Add security group rules"></a>Add security group rules</h3><p>By default, the <code>default</code> security group applies to all instances and includes firewall rules that deny remote access to instances. For Linux images such as CirrOS, we recommend allowing at least ICMP (ping) and secure shell (SSH).</p>
<ul>
<li><p>Add rules to the <code>default</code> security group:</p>
<ul>
<li><p>Permit <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-internet-control-message-protocol-icmp" target="_blank" rel="noopener">ICMP</a> (ping):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ openstack security group rule create --proto icmp default</span><br><span class="line"></span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field             | Value                                |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| created_at        | 2016-10-05T09:52:31Z                 |</span><br><span class="line">| description       |                                      |</span><br><span class="line">| direction         | ingress                              |</span><br><span class="line">| ethertype         | IPv4                                 |</span><br><span class="line">| headers           |                                      |</span><br><span class="line">| id                | 6ee8d630-9803-4d3d-9aea-8c795abbedc2 |</span><br><span class="line">| port_range_max    | None                                 |</span><br><span class="line">| port_range_min    | None                                 |</span><br><span class="line">| project_id        | 77ae8d7104024123af342ffb0a6f1d88     |</span><br><span class="line">| project_id        | 77ae8d7104024123af342ffb0a6f1d88     |</span><br><span class="line">| protocol          | icmp                                 |</span><br><span class="line">| remote_group_id   | None                                 |</span><br><span class="line">| remote_ip_prefix  | 0.0.0.0/0                            |</span><br><span class="line">| revision_number   | 1                                    |</span><br><span class="line">| security_group_id | 4ceee3d4-d2fe-46c1-895c-382033e87b0d |</span><br><span class="line">| updated_at        | 2016-10-05T09:52:31Z                 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Permit secure shell (SSH) access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ openstack security group rule create --proto tcp --dst-port 22 default</span><br><span class="line"></span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field             | Value                                |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| created_at        | 2016-10-05T09:54:50Z                 |</span><br><span class="line">| description       |                                      |</span><br><span class="line">| direction         | ingress                              |</span><br><span class="line">| ethertype         | IPv4                                 |</span><br><span class="line">| headers           |                                      |</span><br><span class="line">| id                | 3cd0a406-43df-4741-ab29-b5e7dcb7469d |</span><br><span class="line">| port_range_max    | 22                                   |</span><br><span class="line">| port_range_min    | 22                                   |</span><br><span class="line">| project_id        | 77ae8d7104024123af342ffb0a6f1d88     |</span><br><span class="line">| project_id        | 77ae8d7104024123af342ffb0a6f1d88     |</span><br><span class="line">| protocol          | tcp                                  |</span><br><span class="line">| remote_group_id   | None                                 |</span><br><span class="line">| remote_ip_prefix  | 0.0.0.0/0                            |</span><br><span class="line">| revision_number   | 1                                    |</span><br><span class="line">| security_group_id | 4ceee3d4-d2fe-46c1-895c-382033e87b0d |</span><br><span class="line">| updated_at        | 2016-10-05T09:54:50Z                 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="Launch-an-instance"><a href="#Launch-an-instance" class="headerlink" title="Launch an instance"></a>Launch an instance</h3><p>ref: <a href="https://docs.openstack.org/newton/install-guide-ubuntu/launch-instance-provider.html" target="_blank" rel="noopener">Launch an instance on the provider network</a></p>
<h3 id="Determine-instance-options"><a href="#Determine-instance-options" class="headerlink" title="Determine instance options"></a>Determine instance options</h3><p>To launch an instance, you must at least specify the flavor, image name, network, security group, key, and instance name.</p>
<ol>
<li><p>On the controller node, source the <code>demo</code> credentials to gain access to user-only CLI commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . demo-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>A flavor specifies a virtual resource allocation profile which includes processor, memory, and storage.</p>
<p>List available flavors:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack flavor list</span><br><span class="line"></span><br><span class="line">+----+---------+-----+------+-----------+-------+-----------+</span><br><span class="line">| ID | Name    | RAM | Disk | Ephemeral | VCPUs | Is Public |</span><br><span class="line">+----+---------+-----+------+-----------+-------+-----------+</span><br><span class="line">| 0  | m1.nano |  64 |    1 |         0 |     1 | True      |</span><br><span class="line">+----+---------+-----+------+-----------+-------+-----------+</span><br></pre></td></tr></table></figure>

<p>You can also reference a flavor by ID.</p>
</li>
<li><p>List available images:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack image list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| 390eb5f7-8d49-41ec-95b7-68c0d5d54b34 | cirros | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br></pre></td></tr></table></figure>

<p>This instance uses the <code>cirros</code> image.</p>
</li>
<li><p>List available networks:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ openstack network list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+--------------+--------------------------------------+</span><br><span class="line">| ID                                   | Name         | Subnets                              |</span><br><span class="line">+--------------------------------------+--------------+--------------------------------------+</span><br><span class="line">| 4716ddfe-6e60-40e7-b2a8-42e57bf3c31c | selfservice  | 2112d5eb-f9d6-45fd-906e-7cabd38b7c7c |</span><br><span class="line">| b5b6993c-ddf9-40e7-91d0-86806a42edb8 | provider     | 310911f6-acf0-4a47-824e-3032916582ff |</span><br><span class="line">+--------------------------------------+--------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<p>This instance uses the <code>provider</code> provider network. However, you must reference this network using the ID instead of the name.</p>
</li>
</ol>
<ol start="5">
<li><p>List available security groups:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack security group list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+---------+------------------------+----------------------------------+</span><br><span class="line">| ID                                   | Name    | Description            | Project                          |</span><br><span class="line">+--------------------------------------+---------+------------------------+----------------------------------+</span><br><span class="line">| dd2b614c-3dad-48ed-958b-b155a3b38515 | default | Default security group | a516b957032844328896baa01e0f906c |</span><br><span class="line">+--------------------------------------+---------+------------------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>This instance uses the <code>default</code> security group.</p>
</li>
</ol>
<h3 id="Launch-the-instance"><a href="#Launch-the-instance" class="headerlink" title="Launch the instance"></a>Launch the instance</h3><ol>
<li><p>Launch the instance:</p>
<p>Replace <code>PROVIDER_NET_ID</code> with the ID of the <code>provider</code> provider network.</p>
<p>If you chose option 1 and your environment contains only one network, you can omit the <code>--nic</code> option because OpenStack automatically chooses the only network available.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack server create --flavor m1.nano --image cirros \</span></span><br><span class="line">&gt;   --nic net-id=2a33434f-ba29-4645-9b5d-24f1509066f1 --security-group default provider-instance</span><br><span class="line">+-----------------------------+-----------------------------------------------+</span><br><span class="line">| Field                       | Value                                         |</span><br><span class="line">+-----------------------------+-----------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig           | MANUAL                                        |</span><br><span class="line">| OS-EXT-AZ:availability_zone |                                               |</span><br><span class="line">| OS-EXT-STS:power_state      | NOSTATE                                       |</span><br><span class="line">| OS-EXT-STS:task_state       | scheduling                                    |</span><br><span class="line">| OS-EXT-STS:vm_state         | building                                      |</span><br><span class="line">| OS-SRV-USG:launched_at      | None                                          |</span><br><span class="line">| OS-SRV-USG:terminated_at    | None                                          |</span><br><span class="line">| accessIPv4                  |                                               |</span><br><span class="line">| accessIPv6                  |                                               |</span><br><span class="line">| addresses                   |                                               |</span><br><span class="line">| adminPass                   | MnjXdXf3qHia                                  |</span><br><span class="line">| config_drive                |                                               |</span><br><span class="line">| created                     | 2017-08-23T17:29:04Z                          |</span><br><span class="line">| flavor                      | m1.nano (0)                                   |</span><br><span class="line">| hostId                      |                                               |</span><br><span class="line">| id                          | 02f54ef9-e867-4c1a-88f9-8eddd144da6f          |</span><br><span class="line">| image                       | cirros (c17e391e-93e1-4480-9cf3-bf8623063e61) |</span><br><span class="line">| key_name                    | None                                          |</span><br><span class="line">| name                        | provider-instance                             |</span><br><span class="line">| progress                    | 0                                             |</span><br><span class="line">| project_id                  | cb015df53fb34d90b077e4c36ce35826              |</span><br><span class="line">| properties                  |                                               |</span><br><span class="line">| security_groups             | name=<span class="string">'default'</span>                                |</span><br><span class="line">| status                      | BUILD                                         |</span><br><span class="line">| updated                     | 2017-08-23T17:29:05Z                          |</span><br><span class="line">| user_id                     | cb98fad69e84459bb48f42130d5c0ce5              |</span><br><span class="line">| volumes_attached            |                                               |</span><br><span class="line">+-----------------------------+-----------------------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Check the status of your instance:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># nova list</span></span><br><span class="line">+--------------------------------------+-------------------+--------+------------+-------------+----------+</span><br><span class="line">| ID                                   | Name              | Status | Task State | Power State | Networks |</span><br><span class="line">+--------------------------------------+-------------------+--------+------------+-------------+----------+</span><br><span class="line">| 02f54ef9-e867-4c1a-88f9-8eddd144da6f | provider-instance | BUILD  | scheduling | NOSTATE     |          |</span><br><span class="line">+--------------------------------------+-------------------+--------+------------+-------------+----------+</span><br><span class="line"></span><br><span class="line">root@controller:~<span class="comment"># openstack server list</span></span><br><span class="line">+--------------------------------------+-------------------+--------+----------+------------+</span><br><span class="line">| ID                                   | Name              | Status | Networks | Image Name |</span><br><span class="line">+--------------------------------------+-------------------+--------+----------+------------+</span><br><span class="line">| 02f54ef9-e867-4c1a-88f9-8eddd144da6f | provider-instance | BUILD  |          | cirros     |</span><br><span class="line">+--------------------------------------+-------------------+--------+----------+------------+</span><br></pre></td></tr></table></figure>

<p>The status changes from <code>BUILD</code> to <code>ACTIVE</code> when the build process successfully completes.</p>
</li>
</ol>
<h3 id="Access-the-instance-using-the-virtual-console"><a href="#Access-the-instance-using-the-virtual-console" class="headerlink" title="Access the instance using the virtual console"></a>Access the instance using the virtual console</h3><ol>
<li><p>Obtain a <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-virtual-network-computing-vnc" target="_blank" rel="noopener">Virtual Network Computing (VNC)</a> session URL for your instance and access it from a web browser:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ openstack console url show provider-instance</span><br><span class="line"></span><br><span class="line">+-------+---------------------------------------------------------------------------------+</span><br><span class="line">| Field | Value                                                                           |</span><br><span class="line">+-------+---------------------------------------------------------------------------------+</span><br><span class="line">| <span class="built_in">type</span>  | novnc                                                                           |</span><br><span class="line">| url   | http://controller:6080/vnc_auto.html?token=5eeccb47-525c-4918-ac2a-3ad1e9f1f493 |</span><br><span class="line">+-------+---------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>If your web browser runs on a host that cannot resolve the <code>controller</code> host name, you can replace <code>controller</code> with the IP address of the management interface on your controller node.</p>
<p>The CirrOS image includes conventional user name/password authentication and provides these credentials at the login prompt. After logging into CirrOS, we recommend that you verify network connectivity using <code>ping</code>.</p>
</li>
<li><p>Verify access to the provider physical network gateway:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ping -c 4 172.16.0.1</span><br><span class="line"></span><br><span class="line">PING 203.0.113.1 (172.16.0.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.16.0.1: icmp_req=1 ttl=64 time=0.357 ms</span><br><span class="line">64 bytes from 172.16.0.1: icmp_req=2 ttl=64 time=0.473 ms</span><br><span class="line">64 bytes from 172.16.0.1: icmp_req=3 ttl=64 time=0.504 ms</span><br><span class="line">64 bytes from 172.16.0.1: icmp_req=4 ttl=64 time=0.470 ms</span><br><span class="line"></span><br><span class="line">--- 172.16.0.1 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 2998ms</span><br><span class="line">rtt min/avg/max/mdev = 0.357/0.451/0.504/0.055 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>Verify access to the internet:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ping -c 4 openstack.org</span><br><span class="line"></span><br><span class="line">PING openstack.org (174.143.194.225) 56(84) bytes of data.</span><br><span class="line">64 bytes from 174.143.194.225: icmp_req=1 ttl=53 time=17.4 ms</span><br><span class="line">64 bytes from 174.143.194.225: icmp_req=2 ttl=53 time=17.5 ms</span><br><span class="line">64 bytes from 174.143.194.225: icmp_req=3 ttl=53 time=17.7 ms</span><br><span class="line">64 bytes from 174.143.194.225: icmp_req=4 ttl=53 time=17.5 ms</span><br><span class="line"></span><br><span class="line">--- openstack.org ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3003ms</span><br><span class="line">rtt min/avg/max/mdev = 17.431/17.575/17.734/0.143 ms</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Access-the-instance-remotely"><a href="#Access-the-instance-remotely" class="headerlink" title="Access the instance remotely"></a>Access the instance remotely</h3><ol>
<li><p>Verify connectivity to the instance from the controller node or any host on the provider physical network:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ping -c 4 172.16.0.103</span><br><span class="line"></span><br><span class="line">PING 203.0.113.103 (203.0.113.103) 56(84) bytes of data.</span><br><span class="line">64 bytes from 203.0.113.103: icmp_req=1 ttl=63 time=3.18 ms</span><br><span class="line">64 bytes from 203.0.113.103: icmp_req=2 ttl=63 time=0.981 ms</span><br><span class="line">64 bytes from 203.0.113.103: icmp_req=3 ttl=63 time=1.06 ms</span><br><span class="line">64 bytes from 203.0.113.103: icmp_req=4 ttl=63 time=0.929 ms</span><br><span class="line"></span><br><span class="line">--- 203.0.113.103 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3002ms</span><br><span class="line">rtt min/avg/max/mdev = 0.929/1.539/3.183/0.951 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>Access your instance using SSH from the controller node or any host on the provider physical network:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ssh cirros@203.0.113.103</span><br><span class="line"></span><br><span class="line">The authenticity of host <span class="string">'203.0.113.102 (203.0.113.102)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">RSA key fingerprint is ed:05:e9:e7:52:a0:ff:83:68:94:c7:d1:f2:f8:e2:e9.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>203.0.113.102<span class="string">' (RSA) to the list of known hosts.</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>If your instance does not launch or seem to work as you expect, see the <a href="http://docs.openstack.org/ops-guide/ops-maintenance-compute.html#instances" target="_blank" rel="noopener">Instance Boot Failures</a> section in OpenStack Operations Guide for more information or use one of the <a href="https://docs.openstack.org/newton/install-guide-ubuntu/common/app-support.html" target="_blank" rel="noopener"><em>many other options</em></a> to seek assistance. We want your first installation to work!</p>
<p>Return to <a href="https://docs.openstack.org/newton/install-guide-ubuntu/launch-instance.html#launch-instance-complete" target="_blank" rel="noopener">Launch an instance</a>.</p>
<h2 id="ISSUE-DHCP-failure-in-VM-troubleshooting"><a href="#ISSUE-DHCP-failure-in-VM-troubleshooting" class="headerlink" title="[ISSUE] DHCP failure in VM troubleshooting"></a>[ISSUE] DHCP failure in VM troubleshooting</h2><blockquote>
<p> ref: <a href="https://docs.openstack.org/neutron/pike/admin/intro-basic-networking.html" target="_blank" rel="noopener">https://docs.openstack.org/neutron/pike/admin/intro-basic-networking.html</a></p>
</blockquote>
<h3 id="what-it-is-like"><a href="#what-it-is-like" class="headerlink" title="what it is like"></a>what it is like</h3><p>in VM console ( initial dhcp discover)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ifup eth0</span><br><span class="line">udhcpc (v1.20.1) started</span><br><span class="line">Sending discover...</span><br><span class="line">Sending discover...</span><br><span class="line">Sending discover...</span><br><span class="line">Usage: /sbin/cirros-dhcpc &lt;up|down&gt;</span><br><span class="line">No lease, failing</span><br></pre></td></tr></table></figure>

<p>in controller console (monitor log)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># tail -f /var/log/syslog</span></span><br><span class="line">Aug 24 03:06:30 controller dhclient[1166]: DHCPREQUEST of 146.11.41.129 on enp0s10 to 147.128.5.12 port 67 (xid=0x5d38ef7e)</span><br><span class="line">Aug 24 03:06:30 controller dhclient[1166]: DHCPACK of 146.11.41.129 from 147.128.5.12</span><br><span class="line">Aug 24 03:06:30 controller dhclient[1166]: Invalid domain list.</span><br><span class="line">Aug 24 03:06:30 controller dhclient[1166]: suspect value <span class="keyword">in</span> domain_search option - discarded</span><br><span class="line">Aug 24 03:06:30 controller dhclient[1166]: Invalid domain list.</span><br><span class="line">Aug 24 03:06:30 controller dhclient[1166]: suspect value <span class="keyword">in</span> domain_search option - discarded</span><br><span class="line">Aug 24 03:06:30 controller dhclient[1166]: Invalid domain list.</span><br><span class="line">Aug 24 03:06:30 controller dhclient[1166]: bound to 146.11.41.129 -- renewal <span class="keyword">in</span> 12824 seconds.</span><br><span class="line">Aug 24 03:12:18 controller dnsmasq-dhcp[18894]: DHCPDISCOVER(ns-a6e0220e-ec) fa:16:3e:bb:c6:13</span><br><span class="line">Aug 24 03:12:18 controller dnsmasq-dhcp[18894]: DHCPOFFER(ns-a6e0220e-ec) 146.11.41.232 fa:16:3e:bb:c6:13</span><br><span class="line">Aug 24 03:13:19 controller dnsmasq-dhcp[18894]: DHCPDISCOVER(ns-a6e0220e-ec) fa:16:3e:bb:c6:13</span><br><span class="line">Aug 24 03:13:19 controller dnsmasq-dhcp[18894]: DHCPOFFER(ns-a6e0220e-ec) 146.11.41.232 fa:16:3e:bb:c6:13</span><br><span class="line">Aug 24 03:14:19 controller dnsmasq-dhcp[18894]: DHCPDISCOVER(ns-a6e0220e-ec) fa:16:3e:bb:c6:13</span><br><span class="line">Aug 24 03:14:19 controller dnsmasq-dhcp[18894]: DHCPOFFER(ns-a6e0220e-ec) 146.11.41.232 fa:16:3e:bb:c6:13</span><br></pre></td></tr></table></figure>

<p>By tcpdump from controllor bridge, it’s found the DHCPOFFER was sent to VM:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># tcpdump -i  brq2a33434f-ba -vv port 67 or port 68 -e -n</span></span><br><span class="line">tcpdump: listening on brq2a33434f-ba, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">04:04:22.830138 fa:16:3e:bb:c6:13 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)</span><br><span class="line">    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:bb:c6:13, length 290, xid 0x1fac2751, Flags [none] (0x0000)</span><br><span class="line">          Client-Ethernet-Address fa:16:3e:bb:c6:13</span><br><span class="line">          Vendor-rfc1048 Extensions</span><br><span class="line">            Magic Cookie 0x63825363</span><br><span class="line">            DHCP-Message Option 53, length 1: Discover</span><br><span class="line">            Client-ID Option 61, length 7: ether fa:16:3e:bb:c6:13</span><br><span class="line">            MSZ Option 57, length 2: 576</span><br><span class="line">            Parameter-Request Option 55, length 9:</span><br><span class="line">              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname</span><br><span class="line">              Domain-Name, MTU, BR, NTP</span><br><span class="line">              Classless-Static-Route</span><br><span class="line">            Vendor-Class Option 60, length 12: <span class="string">"udhcp 1.20.1"</span></span><br><span class="line">            Hostname Option 12, length 6: <span class="string">"cirros"</span></span><br><span class="line">04:04:22.831801 fa:16:3e:8b:53:5e &gt; fa:16:3e:bb:c6:13, ethertype IPv4 (0x0800), length 370: (tos 0xc0, ttl 64, id 3044, offset 0, flags [none], proto UDP (17), length 356)</span><br><span class="line">    146.11.41.230.67 &gt; 146.11.41.232.68: [udp sum ok] BOOTP/DHCP, Reply, length 328, xid 0x1fac2751, Flags [none] (0x0000)</span><br><span class="line">          Your-IP 146.11.41.232</span><br><span class="line">          Server-IP 146.11.41.230</span><br><span class="line">          Client-Ethernet-Address fa:16:3e:bb:c6:13</span><br><span class="line">          Vendor-rfc1048 Extensions</span><br><span class="line">            Magic Cookie 0x63825363</span><br><span class="line">            DHCP-Message Option 53, length 1: Offer</span><br><span class="line">            Server-ID Option 54, length 4: 146.11.41.230</span><br><span class="line">            Lease-Time Option 51, length 4: 86400</span><br><span class="line">            RN Option 58, length 4: 43200</span><br><span class="line">            RB Option 59, length 4: 75600</span><br><span class="line">            Subnet-Mask Option 1, length 4: 255.255.254.0</span><br><span class="line">            BR Option 28, length 4: 146.11.41.255</span><br><span class="line">            Domain-Name Option 15, length 14: <span class="string">"openstacklocal"</span></span><br><span class="line">            Default-Gateway Option 3, length 4: 146.11.40.1</span><br><span class="line">            Classless-Static-Route Option 121, length 14: (169.254.169.254/32:146.11.41.230),(default:146.11.40.1)</span><br><span class="line">            Domain-Name-Server Option 6, length 4: 147.128.5.12</span><br><span class="line">            MTU Option 26, length 2: 1500</span><br><span class="line">04:04:52.504181 08:2e:5f:5d:63:00 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 358: (tos 0x0, ttl 120, id 5320, offset 0, flags [DF], proto UDP (17), length 344)</span><br></pre></td></tr></table></figure>

<p>While from compute , tcpdump the br-int bridge shows it’s not received </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@compute:~<span class="comment"># tcpdump -i brq2a33434f-ba -vv port 67 or port 68 -e -n</span></span><br><span class="line">tcpdump: listening on brq2a33434f-ba, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:51:04.456668 fa:16:3e:bb:c6:13 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)</span><br><span class="line">    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:bb:c6:13, length 290, xid 0xe5e8f024, Flags [none] (0x0000)</span><br><span class="line">          Client-Ethernet-Address fa:16:3e:bb:c6:13</span><br><span class="line">          Vendor-rfc1048 Extensions</span><br><span class="line">            Magic Cookie 0x63825363</span><br><span class="line">            DHCP-Message Option 53, length 1: Discover</span><br><span class="line">            Client-ID Option 61, length 7: ether fa:16:3e:bb:c6:13</span><br><span class="line">            MSZ Option 57, length 2: 576</span><br><span class="line">            Parameter-Request Option 55, length 9:</span><br><span class="line">              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname</span><br><span class="line">              Domain-Name, MTU, BR, NTP</span><br><span class="line">              Classless-Static-Route</span><br><span class="line">            Vendor-Class Option 60, length 12: <span class="string">"udhcp 1.20.1"</span></span><br><span class="line">            Hostname Option 12, length 6: <span class="string">"cirros"</span></span><br><span class="line">03:51:30.022360 08:2e:5f:5d:63:00 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 358: (tos 0x0, ttl 120, id 29901, offset 0, flags [DF], proto UDP (17), length 344)</span><br><span class="line">    147.128.5.12.67 &gt; 255.255.255.255.68: [udp sum ok] BOOTP/DHCP, Reply, length 316, xid 0x4a42e788, Flags [Broadcast] (0x8000)</span><br><span class="line">          Client-IP 146.11.40.250</span><br><span class="line">          Gateway-IP 146.11.40.1</span><br><span class="line">          Client-Ethernet-Address d0:bf:9c:df:7a:a5</span><br><span class="line">          Vendor-rfc1048 Extensions</span><br><span class="line">            Magic Cookie 0x63825363</span><br><span class="line">            DHCP-Message Option 53, length 1: ACK</span><br><span class="line">            Server-ID Option 54, length 4: 147.128.5.12</span><br><span class="line">            Subnet-Mask Option 1, length 4: 255.255.254.0</span><br><span class="line">            Vendor-Option Option 43, length 5: 220.3.78.65.80</span><br><span class="line">            Domain-Name Option 15, length 18: <span class="string">"cn.ao.ericsson.se^@"</span></span><br><span class="line">            Default-Gateway Option 3, length 4: 146.11.40.1</span><br><span class="line">            Domain-Name-Server Option 6, length 12: 147.128.5.12,193.181.14.11,193.181.14.10</span><br><span class="line">            Netbios-Name-Server Option 44, length 8: 146.11.115.50,146.11.116.30</span><br><span class="line">            Netbios-Node Option 46, length 1: h-node</span><br><span class="line">03:51:30.023490 2c:76:8a:1f:47:00 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 358: (tos 0x0, ttl 119, id 2187, offset 0, flags [DF], proto UDP (17), length 344)</span><br></pre></td></tr></table></figure>

<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion:"></a>Conclusion:</h3><p>the DHCP offer was sent out from DHCP agent dnsmasq, but the package cannot be captured from host bridge connecting to vm eth0. the issue is located in the provider network router, the ECN router 146.11.40.1 in our office.</p>
<p>By searching online, there is a tech called DHCP snooping to prevent multiple dhcp server in one LAN from router, which makes sense. </p>
<h2 id="Cinder"><a href="#Cinder" class="headerlink" title="Cinder"></a>Cinder</h2><h2 id="Cinder-on-controller"><a href="#Cinder-on-controller" class="headerlink" title="Cinder on controller"></a>Cinder on controller</h2><p>Here we provide a iSCSI driver backend cinder practice </p>
<blockquote>
<p> ref: <a href="https://docs.openstack.org/ocata/install-guide-ubuntu/cinder.html" target="_blank" rel="noopener">https://docs.openstack.org/ocata/install-guide-ubuntu/cinder.html</a></p>
</blockquote>
<p>The OpenStack Block Storage service (cinder) adds persistent storage to a virtual machine. Block Storage provides an infrastructure for managing volumes, and interacts with OpenStack Compute to provide volumes for instances. The service also enables management of volume snapshots, and volume types.</p>
<p>The Block Storage service consists of the following components:</p>
<ul>
<li><p>cinder-api</p>
<p>Accepts API requests, and routes them to the <code>cinder-volume</code> for action.</p>
</li>
<li><p>cinder-volume</p>
<p>Interacts directly with the Block Storage service, and processes such as the <code>cinder-scheduler</code>. It also interacts with these processes through a message queue. The <code>cinder-volume</code> service responds to read and write requests sent to the Block Storage service to maintain state. It can interact with a variety of storage providers through a driver architecture.</p>
</li>
<li><p>cinder-scheduler daemon</p>
<p>Selects the optimal storage provider node on which to create the volume. A similar component to the <code>nova-scheduler</code>.</p>
</li>
<li><p>cinder-backup daemon</p>
<p>The <code>cinder-backup</code> service provides backing up volumes of any type to a backup storage provider. Like the <code>cinder-volume</code> service, it can interact with a variety of storage providers through a driver architecture.</p>
</li>
<li><p>Messaging queue</p>
<p>Routes information between the Block Storage processes.</p>
</li>
</ul>
<h3 id="Install-and-configure-controller-node"><a href="#Install-and-configure-controller-node" class="headerlink" title="Install and configure controller node"></a>Install and configure controller node</h3><p>This section describes how to install and configure the Block Storage service, code-named cinder, on the controller node. This service requires at least one additional storage node that provides volumes to instances.</p>
<h3 id="Prerequisites-3"><a href="#Prerequisites-3" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><p>Before you install and configure the Block Storage service, you must create a database, service credentials, and API endpoints.</p>
<ol>
<li><p>To create the database, complete these steps:</p>
<ul>
<li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ol>
<ul>
<li><p>Create the <code>cinder</code> database:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; CREATE DATABASE cinder;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Grant proper access to the <code>cinder</code> database:</p>
<pre><code>​```
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO &apos;cinder&apos;@&apos;localhost&apos; \
  IDENTIFIED BY &apos;CINDER_DBPASS&apos;;
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO &apos;cinder&apos;@&apos;%&apos; \
  IDENTIFIED BY &apos;CINDER_DBPASS&apos;;
​```

Replace `CINDER_DBPASS` with a suitable password.</code></pre><ul>
<li>Exit the database access client.</li>
</ul>
</li>
</ul>
<ol>
<li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>To create the service credentials, complete these steps:</p>
<ul>
<li><p>Create a <code>cinder</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain default --password-prompt cinder</span><br><span class="line"></span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 9d7e33de3e1a498390353819bc7d245d |</span><br><span class="line">| name                | cinder                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the <code>admin</code> role to the <code>cinder</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user cinder admin</span><br></pre></td></tr></table></figure>

<p>This command provides no output.</p>
</li>
<li><p>Create the <code>cinderv2</code> and <code>cinderv3</code> service entities:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name cinderv2 \</span><br><span class="line">  --description <span class="string">"OpenStack Block Storage"</span> volumev2</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Block Storage          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | eb9fd245bdbc414695952e93f29fe3ac |</span><br><span class="line">| name        | cinderv2                         |</span><br><span class="line">| <span class="built_in">type</span>        | volumev2                         |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name cinderv3 \</span><br><span class="line">  --description <span class="string">"OpenStack Block Storage"</span> volumev3</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Block Storage          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | ab3bbbef780845a1a283490d281e7fda |</span><br><span class="line">| name        | cinderv3                         |</span><br><span class="line">| <span class="built_in">type</span>        | volumev3                         |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>The Block Storage services require two service entities.</p>
</li>
<li><p>Create the Block Storage service API endpoints:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 public http://controller:8776/v2/%\(project_id\)s</span><br><span class="line"></span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| Field        | Value                                    |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| enabled      | True                                     |</span><br><span class="line">| id           | 513e73819e14460fb904163f41ef3759         |</span><br><span class="line">| interface    | public                                   |</span><br><span class="line">| region       | RegionOne                                |</span><br><span class="line">| region_id    | RegionOne                                |</span><br><span class="line">| service_id   | eb9fd245bdbc414695952e93f29fe3ac         |</span><br><span class="line">| service_name | cinderv2                                 |</span><br><span class="line">| service_type | volumev2                                 |</span><br><span class="line">| url          | http://controller:8776/v2/%(project_id)s |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 internal http://controller:8776/v2/%\(project_id\)s</span><br><span class="line"></span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| Field        | Value                                    |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| enabled      | True                                     |</span><br><span class="line">| id           | 6436a8a23d014cfdb69c586eff146a32         |</span><br><span class="line">| interface    | internal                                 |</span><br><span class="line">| region       | RegionOne                                |</span><br><span class="line">| region_id    | RegionOne                                |</span><br><span class="line">| service_id   | eb9fd245bdbc414695952e93f29fe3ac         |</span><br><span class="line">| service_name | cinderv2                                 |</span><br><span class="line">| service_type | volumev2                                 |</span><br><span class="line">| url          | http://controller:8776/v2/%(project_id)s |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 admin http://controller:8776/v2/%\(project_id\)s</span><br><span class="line"></span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| Field        | Value                                    |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| enabled      | True                                     |</span><br><span class="line">| id           | e652cf84dd334f359ae9b045a2c91d96         |</span><br><span class="line">| interface    | admin                                    |</span><br><span class="line">| region       | RegionOne                                |</span><br><span class="line">| region_id    | RegionOne                                |</span><br><span class="line">| service_id   | eb9fd245bdbc414695952e93f29fe3ac         |</span><br><span class="line">| service_name | cinderv2                                 |</span><br><span class="line">| service_type | volumev2                                 |</span><br><span class="line">| url          | http://controller:8776/v2/%(project_id)s |</span><br><span class="line">+--------------+------------------------------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 public http://controller:8776/v3/%\(project_id\)s</span><br><span class="line"></span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| Field        | Value                                    |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| enabled      | True                                     |</span><br><span class="line">| id           | 03fa2c90153546c295bf30ca86b1344b         |</span><br><span class="line">| interface    | public                                   |</span><br><span class="line">| region       | RegionOne                                |</span><br><span class="line">| region_id    | RegionOne                                |</span><br><span class="line">| service_id   | ab3bbbef780845a1a283490d281e7fda         |</span><br><span class="line">| service_name | cinderv3                                 |</span><br><span class="line">| service_type | volumev3                                 |</span><br><span class="line">| url          | http://controller:8776/v3/%(project_id)s |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 internal http://controller:8776/v3/%\(project_id\)s</span><br><span class="line"></span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| Field        | Value                                    |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| enabled      | True                                     |</span><br><span class="line">| id           | 94f684395d1b41068c70e4ecb11364b2         |</span><br><span class="line">| interface    | internal                                 |</span><br><span class="line">| region       | RegionOne                                |</span><br><span class="line">| region_id    | RegionOne                                |</span><br><span class="line">| service_id   | ab3bbbef780845a1a283490d281e7fda         |</span><br><span class="line">| service_name | cinderv3                                 |</span><br><span class="line">| service_type | volumev3                                 |</span><br><span class="line">| url          | http://controller:8776/v3/%(project_id)s |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 admin http://controller:8776/v3/%\(project_id\)s</span><br><span class="line"></span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| Field        | Value                                    |</span><br><span class="line">+--------------+------------------------------------------+</span><br><span class="line">| enabled      | True                                     |</span><br><span class="line">| id           | 4511c28a0f9840c78bacb25f10f62c98         |</span><br><span class="line">| interface    | admin                                    |</span><br><span class="line">| region       | RegionOne                                |</span><br><span class="line">| region_id    | RegionOne                                |</span><br><span class="line">| service_id   | ab3bbbef780845a1a283490d281e7fda         |</span><br><span class="line">| service_name | cinderv3                                 |</span><br><span class="line">| service_type | volumev3                                 |</span><br><span class="line">| url          | http://controller:8776/v3/%(project_id)s |</span><br><span class="line">+--------------+------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>The Block Storage services require endpoints for each service entity.</p>
</li>
</ol>
<h3 id="Install-and-configure-components-3"><a href="#Install-and-configure-components-3" class="headerlink" title="Install and configure components"></a>Install and configure components</h3><p>Install the packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install cinder-api cinder-scheduler</span></span><br></pre></td></tr></table></figure>

<p>Edit the <code>/etc/cinder/cinder.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[database]</code> section, configure database access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder</span><br></pre></td></tr></table></figure>

<p>Replace <code>CINDER_DBPASS</code> with the password you chose for the Block Storage database.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br></pre></td></tr></table></figure>

<p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = cinder</span><br><span class="line">password = cinder</span><br></pre></td></tr></table></figure>

<p>Replace <code>password</code> with the password you chose for the <code>cinder</code> user in the Identity service.</p>
<p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure the <code>my_ip</code> option to use the management interface IP address of the controller node:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">my_ip = 10.20.0.10</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>In the <code>[oslo_concurrency]</code> section, configure the lock path:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oslo_concurrency]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">lock_path = /var/lib/cinder/tmp</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>Populate the Block Storage database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "cinder-manage db sync" cinder</span></span><br></pre></td></tr></table></figure>

<p>Ignore any deprecation messages in this output.</p>
<h3 id="Configure-Compute-to-use-Block-Storage"><a href="#Configure-Compute-to-use-Block-Storage" class="headerlink" title="Configure Compute to use Block Storage"></a>Configure Compute to use Block Storage</h3><ul>
<li><p>Edit the <code>/etc/nova/nova.conf</code> file and add the following to it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[cinder]</span><br><span class="line">os_region_name = RegionOne</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Finalize-installation-5"><a href="#Finalize-installation-5" class="headerlink" title="Finalize installation"></a>Finalize installation</h3><ol>
<li><p>Restart the Compute API service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service nova-api restart</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Restart the Block Storage services:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service cinder-scheduler restart</span></span><br><span class="line"><span class="comment"># service apache2 restart</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Cinder-on-block-storage-node"><a href="#Cinder-on-block-storage-node" class="headerlink" title="Cinder on block storage node"></a>Cinder on block storage node</h2><h3 id="configure-storage-network-for-compute"><a href="#configure-storage-network-for-compute" class="headerlink" title="configure storage network for compute"></a>configure storage network for compute</h3><p>Check nic name</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@compute:~<span class="comment"># dmesg | grep renamed</span></span><br><span class="line">[    2.730898] e1000 0000:00:09.0 enp0s9: renamed from eth2</span><br><span class="line">[    2.731826] e1000 0000:00:08.0 enp0s8: renamed from eth1</span><br><span class="line">[    2.732819] e1000 0000:00:0a.0 enp0s10: renamed from eth3</span><br><span class="line">[    2.735645] e1000 0000:00:03.0 enp0s3: renamed from eth0</span><br></pre></td></tr></table></figure>

<p><code>eth2</code> was named as <code>enp0s9</code></p>
<p>Edit <code>/etc/network/interfaces</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># storage network eth2</span></span><br><span class="line">auto enp0s9</span><br><span class="line">iface enp0s9 inet static</span><br><span class="line">address 192.168.99.20</span><br><span class="line">netmask 255.255.255.0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ifup enp0s9</span></span><br></pre></td></tr></table></figure>

<h3 id="Create-cinder-machine-storage"><a href="#Create-cinder-machine-storage" class="headerlink" title="Create cinder machine: storage"></a>Create cinder machine: storage</h3><h2 id="Storage-node-actions"><a href="#Storage-node-actions" class="headerlink" title="Storage node actions"></a>Storage node actions</h2><blockquote>
<p> Clone it from base VM and add a virtual disk for storage vm</p>
</blockquote>
<h3 id="Management-net-eth0-enp0s3-and-storage-net-eth2-enp0s9"><a href="#Management-net-eth0-enp0s3-and-storage-net-eth2-enp0s9" class="headerlink" title="Management net eth0 (enp0s3) and storage net eth2 (enp0s9)"></a>Management net eth0 (enp0s3) and storage net eth2 (enp0s9)</h3><p>Edit <code>/etc/network/interfaces</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># management network eth0</span></span><br><span class="line"></span><br><span class="line">auto enp0s3</span><br><span class="line">iface enp0s3 inet static</span><br><span class="line">address 10.20.0.30</span><br><span class="line">netmask 255.255.255.0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># storage network eth2</span></span><br><span class="line">auto enp0s9</span><br><span class="line">iface enp0s9 inet static</span><br><span class="line">address 192.168.99.30</span><br><span class="line">netmask 255.255.255.0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//start the two nics</span><br><span class="line"><span class="comment"># ifup enp0s3</span></span><br><span class="line"><span class="comment"># ifup enp0s9</span></span><br></pre></td></tr></table></figure>

<h3 id="configure-NTP-by-editing-etc-chrony-chrony-conf-1"><a href="#configure-NTP-by-editing-etc-chrony-chrony-conf-1" class="headerlink" title="configure NTP by editing /etc/chrony/chrony.conf"></a>configure NTP by editing <code>/etc/chrony/chrony.conf</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server 10.20.0.10 iburst</span><br></pre></td></tr></table></figure>

<p>change hostname and hosts</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo storage &gt; /etc/hostname</span></span><br><span class="line"><span class="comment"># echo 10.20.0.10    controller &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="comment"># echo 10.20.0.20    compute &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="comment"># hostname storage</span></span><br></pre></td></tr></table></figure>

<h3 id="Check-new-disk-was-there-already"><a href="#Check-new-disk-was-there-already" class="headerlink" title="Check new disk was there already"></a>Check new disk was there already</h3><p>check by <code>fdisk -l</code> , /dev/sdb is there :-) .</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@storage:~<span class="comment"># fdisk -l</span></span><br><span class="line">Disk /dev/sda: 50 GiB, 53687091200 bytes, 104857600 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x3ce50a75</span><br><span class="line"></span><br><span class="line">Device     Boot   Start       End   Sectors  Size Id Type</span><br><span class="line">/dev/sda1  *       2048    999423    997376  487M 83 Linux</span><br><span class="line">/dev/sda2       1001470 104855551 103854082 49.5G  5 Extended</span><br><span class="line">/dev/sda5       1001472 104855551 103854080 49.5G 8e Linux LVM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 50 GiB, 53687091200 bytes, 104857600 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/ubuntu--vg-root: 45.5 GiB, 48876224512 bytes, 95461376 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/ubuntu--vg-swap_1: 4 GiB, 4294967296 bytes, 8388608 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></pre></td></tr></table></figure>



<h2 id="Cinder-on-storage-node"><a href="#Cinder-on-storage-node" class="headerlink" title="Cinder on storage node"></a>Cinder on storage node</h2><h3 id="Install-and-configure-a-storage-node"><a href="#Install-and-configure-a-storage-node" class="headerlink" title="Install and configure a storage node"></a>Install and configure a storage node</h3><p>This section describes how to install and configure storage nodes for the Block Storage service. For simplicity, this configuration references one storage node with an empty local block storage device. The instructions use <code>/dev/sdb</code>, but you can substitute a different value for your particular node.</p>
<p>The service provisions logical volumes on this device using the <a href="https://docs.openstack.org/ocata/install-guide-ubuntu/common/glossary.html#term-logical-volume-manager-lvm" target="_blank" rel="noopener">LVM</a> driver and provides them to instances via <a href="https://docs.openstack.org/ocata/install-guide-ubuntu/common/glossary.html#term-iscsi-qualified-name-iqn" target="_blank" rel="noopener">iSCSI</a> transport. You can follow these instructions with minor modifications to horizontally scale your environment with additional storage nodes.</p>
<h3 id="Prerequisites-4"><a href="#Prerequisites-4" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><p>Before you install and configure the Block Storage service on the storage node, you must prepare the storage device.</p>
<p>Perform these steps on the storage node.</p>
<ol>
<li><p>Install the supporting utility packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install lvm2</span></span><br></pre></td></tr></table></figure>

<p> Some distributions include LVM by default.</p>
</li>
<li><p>Create the LVM physical volume <code>/dev/sdb</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pvcreate /dev/sdb</span></span><br><span class="line"></span><br><span class="line">Physical volume <span class="string">"/dev/sdb"</span> successfully created</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the LVM volume group <code>cinder-volumes</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vgcreate cinder-volumes /dev/sdb</span></span><br><span class="line"></span><br><span class="line">Volume group <span class="string">"cinder-volumes"</span> successfully created</span><br></pre></td></tr></table></figure>

<p>The Block Storage service creates logical volumes in this volume group.</p>
</li>
<li><p>Only instances can access Block Storage volumes. However, the underlying operating system manages the devices associated with the volumes. By default, the LVM volume scanning tool scans the <code>/dev</code> directory for block storage devices that contain volumes. If projects use LVM on their volumes, the scanning tool detects these volumes and attempts to cache them which can cause a variety of problems with both the underlying operating system and project volumes. You must reconfigure LVM to scan only the devices that contain the <code>cinder-volumes</code> volume group. Edit the <code>/etc/lvm/lvm.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>devices</code> section, add a filter that accepts the <code>/dev/sdb</code> device and rejects all other devices:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devices &#123;</span><br><span class="line">...</span><br><span class="line">filter = [ <span class="string">"a/sdb/"</span>, <span class="string">"r/.*/"</span>]</span><br></pre></td></tr></table></figure>

<p>Each item in the filter array begins with <code>a</code> for <strong>accept</strong> or <code>r</code> for <strong>reject</strong> and includes a regular expression for the device name. The array must end with <code>r/.*/</code> to reject any remaining devices. You can use the <strong>vgs -vvvv</strong> command to test filters.</p>
<p>If your storage nodes use LVM on the operating system disk, you must also add the associated device to the filter. For example, if the <code>/dev/sda</code> device contains the operating system:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">filter = [ <span class="string">"a/sda/"</span>, <span class="string">"a/sdb/"</span>, <span class="string">"r/.*/"</span>]</span><br><span class="line"></span><br><span class="line">​```bash</span><br><span class="line"></span><br><span class="line">Similarly, <span class="keyword">if</span> your compute nodes use LVM on the operating system disk, you must also modify the filter <span class="keyword">in</span> the`/etc/lvm/lvm.conf` file on those nodes to include only the operating system disk. For example, <span class="keyword">if</span> the `/dev/sda`device contains the operating system:</span><br><span class="line"></span><br><span class="line">​```bash</span><br><span class="line">filter = [ <span class="string">"a/sda/"</span>, <span class="string">"r/.*/"</span>]</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h3 id="Install-and-configure-components-4"><a href="#Install-and-configure-components-4" class="headerlink" title="Install and configure components"></a>Install and configure components</h3><p>Install the packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install cinder-volume -y</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>Edit the <code>/etc/cinder/cinder.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[database]</code> section, configure database access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder</span><br></pre></td></tr></table></figure>

<p>Replace <code>CINDER_DBPASS</code> with the password you chose for the Block Storage database.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br></pre></td></tr></table></figure>

<p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = cinder</span><br><span class="line">password = cinder</span><br></pre></td></tr></table></figure>

<p>Replace <code>password</code> with the password you chose for the <code>cinder</code> user in the Identity service.</p>
<p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure the <code>my_ip</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">my_ip = STORAGE_INTERFACE_IP_ADDRESS</span><br></pre></td></tr></table></figure>

<p>Replace <code>STORAGE_INTERFACE_IP_ADDRESS</code> with the IP address of the storage network (eth2).</p>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>In the <code>[lvm]</code> section, configure the LVM back end with the LVM driver, <code>cinder-volumes</code> volume group, iSCSI protocol, and appropriate iSCSI service:</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[lvm]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver</span><br><span class="line">volume_group = cinder-volumes</span><br><span class="line">iscsi_protocol = iscsi</span><br><span class="line">iscsi_helper = tgtadm</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>In the <code>[DEFAULT]</code> section, enable the LVM back end:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">enabled_backends = lvm</span><br></pre></td></tr></table></figure>

<p> Back-end names are arbitrary. As an example, this guide uses the name of the driver as the name of the back end.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure the location of the Image service API:</p>
<pre><code>​```
[DEFAULT]
# ...
glance_api_servers = http://controller:9292
​```</code></pre><ul>
<li><p>In the <code>[oslo_concurrency]</code> section, configure the lock path:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oslo_concurrency]</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">lock_path = /var/lib/cinder/tmp</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="Finalize-installation-6"><a href="#Finalize-installation-6" class="headerlink" title="Finalize installation"></a>Finalize installation</h3><ol>
<li><p>Restart the Block Storage volume service including its dependencies:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service tgt restart</span></span><br><span class="line"><span class="comment"># service cinder-volume restart</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<h3 id="Verify-operation-4"><a href="#Verify-operation-4" class="headerlink" title="Verify operation"></a>Verify operation</h3><p>Verify operation of the Block Storage service. </p>
<p>Perform these commands on the controller node.</p>
<ol>
<li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>List service components to verify successful launch of each process:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack volume service list</span></span><br><span class="line">+------------------+-------------+------+---------+-------+----------------------------+</span><br><span class="line">| Binary           | Host        | Zone | Status  | State | Updated At                 |</span><br><span class="line">+------------------+-------------+------+---------+-------+----------------------------+</span><br><span class="line">| cinder-scheduler | controller  | nova | enabled | up    | 2017-08-24T14:35:44.000000 |</span><br><span class="line">| cinder-volume    | storage@lvm | nova | enabled | up    | 2017-08-24T14:35:39.000000 |</span><br><span class="line">+------------------+-------------+------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="Let’s-try-something-on-block-storage"><a href="#Let’s-try-something-on-block-storage" class="headerlink" title="Let’s try something on block storage!"></a>Let’s try something on block storage!</h2><h3 id="Create-a-volume"><a href="#Create-a-volume" class="headerlink" title="Create a volume"></a>Create a volume</h3><ol>
<li><p>Source the <code>demo</code> credentials to perform the following steps as a non-administrative project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . demo-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a 1 GB volume:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ openstack volume create --size 1 volume1</span><br><span class="line"></span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| Field               | Value                                |</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| attachments         | []                                   |</span><br><span class="line">| availability_zone   | nova                                 |</span><br><span class="line">| bootable            | <span class="literal">false</span>                                |</span><br><span class="line">| consistencygroup_id | None                                 |</span><br><span class="line">| created_at          | 2016-03-08T14:30:48.391027           |</span><br><span class="line">| description         | None                                 |</span><br><span class="line">| encrypted           | False                                |</span><br><span class="line">| id                  | a1e8be72-a395-4a6f-8e07-856a57c39524 |</span><br><span class="line">| multiattach         | False                                |</span><br><span class="line">| name                | volume1                              |</span><br><span class="line">| properties          |                                      |</span><br><span class="line">| replication_status  | disabled                             |</span><br><span class="line">| size                | 1                                    |</span><br><span class="line">| snapshot_id         | None                                 |</span><br><span class="line">| source_volid        | None                                 |</span><br><span class="line">| status              | creating                             |</span><br><span class="line">| <span class="built_in">type</span>                | None                                 |</span><br><span class="line">| updated_at          | None                                 |</span><br><span class="line">| user_id             | 684286a9079845359882afc3aa5011fb     |</span><br><span class="line">+---------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>After a short time, the volume status should change from <code>creating</code> to <code>available</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack volume list</span></span><br><span class="line">+--------------------------------------+--------------+-----------+------+-------------+</span><br><span class="line">| ID                                   | Display Name | Status    | Size | Attached to |</span><br><span class="line">+--------------------------------------+--------------+-----------+------+-------------+</span><br><span class="line">| 81ffed40-ed71-495d-bfa9-8fb8c72cf222 | volume1      | available |    1 |             |</span><br><span class="line">+--------------------------------------+--------------+-----------+------+-------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>check where it is?</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">root@storage:~<span class="comment"># lvdisplay</span></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/ubuntu-vg/root</span><br><span class="line">  LV Name                root</span><br><span class="line">  VG Name                ubuntu-vg</span><br><span class="line">  LV UUID                NA7DgH-V0Sv-cH8E-wvej-aJmP-6EBO-joXO0C</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time ubuntu, 2017-08-23 16:30:36 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 1</span></span><br><span class="line">  LV Size                45.52 GiB</span><br><span class="line">  Current LE             11653</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     256</span><br><span class="line">  Block device           252:0</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/ubuntu-vg/swap_1</span><br><span class="line">  LV Name                swap_1</span><br><span class="line">  VG Name                ubuntu-vg</span><br><span class="line">  LV UUID                Vtixi8-qKcP-f1LH-bHqM-E73h-NN7z-eSD2zk</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time ubuntu, 2017-08-23 16:30:36 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 2</span></span><br><span class="line">  LV Size                4.00 GiB</span><br><span class="line">  Current LE             1024</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     256</span><br><span class="line">  Block device           252:1</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/cinder-volumes/volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222</span><br><span class="line">  LV Name                volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222</span><br><span class="line">  VG Name                cinder-volumes</span><br><span class="line">  LV UUID                6jbPGA-i3Eo-O4ng-8Mf3-IoeF-9WF7-g1DGEA</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time storage, 2017-08-24 22:38:28 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 0</span></span><br><span class="line">  LV Size                1.00 GiB</span><br><span class="line">  Current LE             256</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     256</span><br><span class="line">  Block device           252:2</span><br><span class="line"></span><br><span class="line">​```bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### Attach the volume to an instance</span></span><br><span class="line"></span><br><span class="line">1.   Attach a volume to an instance:</span><br><span class="line"></span><br><span class="line">  ```bash</span><br><span class="line">  $ openstack server add volume INSTANCE_NAME VOLUME_NAME</span><br></pre></td></tr></table></figure>

<p>  Replace <code>INSTANCE_NAME</code> with the name of the instance and <code>VOLUME_NAME</code> with the name of the volume you want to attach to it.</p>
<p>  <strong>Example</strong></p>
<p>  Attach the <code>volume1</code> volume to the <code>provider-instance</code> instance:</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack server add volume provider-instance volume1</span><br></pre></td></tr></table></figure>
<p>  This command provides no output.</p>
<ol start="2">
<li>List volumes:</li>
</ol>
<pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack volume list</span></span><br><span class="line">+--------------------------------------+--------------+--------+------+--------------------------------------------+</span><br><span class="line">| ID                                   | Display Name | Status | Size | Attached to                                |</span><br><span class="line">+--------------------------------------+--------------+--------+------+--------------------------------------------+</span><br><span class="line">| 81ffed40-ed71-495d-bfa9-8fb8c72cf222 | volume1      | <span class="keyword">in</span>-use |    1 | Attached to provider-instance on /dev/vdb  |</span><br><span class="line">+--------------------------------------+--------------+--------+------+--------------------------------------------+</span><br><span class="line">    </span><br><span class="line">root@storage:~<span class="comment"># lvdisplay</span></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/ubuntu-vg/root</span><br><span class="line">  LV Name                root</span><br><span class="line">  VG Name                ubuntu-vg</span><br><span class="line">  LV UUID                NA7DgH-V0Sv-cH8E-wvej-aJmP-6EBO-joXO0C</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time ubuntu, 2017-08-23 16:30:36 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 1</span></span><br><span class="line">  LV Size                45.52 GiB</span><br><span class="line">  Current LE             11653</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line"></span><br><span class="line"> - currently <span class="built_in">set</span> to     256</span><br><span class="line"> Block device           252:0</span><br><span class="line"></span><br><span class="line"> --- Logical volume ---</span><br><span class="line"> LV Path                /dev/ubuntu-vg/swap_1</span><br><span class="line"> LV Name                swap_1</span><br><span class="line"> VG Name                ubuntu-vg</span><br><span class="line"> LV UUID                Vtixi8-qKcP-f1LH-bHqM-E73h-NN7z-eSD2zk</span><br><span class="line"> LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line"> LV Creation host, time ubuntu, 2017-08-23 16:30:36 +0800</span><br><span class="line"> LV Status              available</span><br><span class="line"> <span class="comment"># open                 2</span></span><br><span class="line"> LV Size                4.00 GiB</span><br><span class="line"> Current LE             1024</span><br><span class="line"> Segments               1</span><br><span class="line"> Allocation             inherit</span><br><span class="line"> Read ahead sectors     auto</span><br><span class="line"> - currently <span class="built_in">set</span> to     256</span><br><span class="line"> Block device           252:1</span><br><span class="line"></span><br><span class="line"> --- Logical volume ---</span><br><span class="line"> LV Path                /dev/cinder-volumes/volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222</span><br><span class="line"> LV Name                volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222</span><br><span class="line"> VG Name                cinder-volumes</span><br><span class="line"> LV UUID                6jbPGA-i3Eo-O4ng-8Mf3-IoeF-9WF7-g1DGEA</span><br><span class="line"> LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line"> LV Creation host, time storage, 2017-08-24 22:38:28 +0800</span><br><span class="line"> LV Status              available</span><br><span class="line"> <span class="comment"># open                 1</span></span><br><span class="line"> LV Size                1.00 GiB</span><br><span class="line"> Current LE             256</span><br><span class="line"> Segments               1</span><br><span class="line"> Allocation             inherit</span><br><span class="line"> Read ahead sectors     auto</span><br><span class="line"> - currently <span class="built_in">set</span> to     256</span><br><span class="line"> Block device           252:2</span><br></pre></td></tr></table></figure></code></pre><ol start="3">
<li><p>Access your instance using SSH or <code>virsh console</code> and use the <code>fdisk</code> command to verify presence of the volume as the <code>/dev/vdb</code> block storage device:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/vda: 1073 MB, 1073741824 bytes</span><br><span class="line">255 heads, 63 sectors/track, 130 cylinders, total 2097152 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vda1   *       16065     2088449     1036192+  83  Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 1073 MB, 1073741824 bytes</span><br><span class="line">16 heads, 63 sectors/track, 2080 cylinders, total 2097152 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb doesn<span class="string">'t contain a valid partition table</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Check from storage node on iSCSI target point of view, it’s found </p>
<ul>
<li>Initiator: <code>iqn.1993-08.org.debian:01:e7b693dedcab alias: compute</code></li>
<li>LUN 1: <code>Backing store path: /dev/cinder-volumes/volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@storage:~<span class="comment"># tgtadm --lld iscsi --op show --mode target</span></span><br><span class="line">Target 1: iqn.2010-10.org.openstack:volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222</span><br><span class="line">    System information:</span><br><span class="line">        Driver: iscsi</span><br><span class="line">        State: ready</span><br><span class="line">    I_T nexus information:</span><br><span class="line">        I_T nexus: 1</span><br><span class="line">            Initiator: iqn.1993-08.org.debian:01:e7b693dedcab <span class="built_in">alias</span>: compute</span><br><span class="line">            Connection: 0</span><br><span class="line">                IP Address: 192.168.199.20</span><br><span class="line">    LUN information:</span><br><span class="line">        LUN: 0</span><br><span class="line">            Type: controller</span><br><span class="line">            SCSI ID: IET     00010000</span><br><span class="line">            SCSI SN: beaf10</span><br><span class="line">            Size: 0 MB, Block size: 1</span><br><span class="line">            Online: Yes</span><br><span class="line">            Removable media: No</span><br><span class="line">            Prevent removal: No</span><br><span class="line">            Readonly: No</span><br><span class="line">            SWP: No</span><br><span class="line">            Thin-provisioning: No</span><br><span class="line">            Backing store <span class="built_in">type</span>: null</span><br><span class="line">            Backing store path: None</span><br><span class="line">            Backing store flags:</span><br><span class="line">        LUN: 1</span><br><span class="line">            Type: disk</span><br><span class="line">            SCSI ID: IET     00010001</span><br><span class="line">            SCSI SN: beaf11</span><br><span class="line">            Size: 1074 MB, Block size: 512</span><br><span class="line">            Online: Yes</span><br><span class="line">            Removable media: No</span><br><span class="line">            Prevent removal: No</span><br><span class="line">            Readonly: No</span><br><span class="line">            SWP: No</span><br><span class="line">            Thin-provisioning: No</span><br><span class="line">            Backing store <span class="built_in">type</span>: rdwr</span><br><span class="line">            Backing store path: /dev/cinder-volumes/volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222</span><br><span class="line">            Backing store flags:</span><br><span class="line">    Account information:</span><br><span class="line">        7jTnhhxXsVM4BwqxG979</span><br><span class="line">    ACL information:</span><br><span class="line">        ALL</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="5">
<li><p>Checking from compute via <code>virsh dumpxml &lt;instance-id&gt;</code></p>
<p>It’s shown the device from initiator point of view:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;disk <span class="built_in">type</span>=<span class="string">'block'</span> device=<span class="string">'disk'</span>&gt;</span><br><span class="line">  &lt;driver name=<span class="string">'qemu'</span> <span class="built_in">type</span>=<span class="string">'raw'</span> cache=<span class="string">'none'</span> io=<span class="string">'native'</span>/&gt;</span><br><span class="line">  &lt;<span class="built_in">source</span> dev=<span class="string">'/dev/disk/by-path/ip-192.168.199.30:3260-iscsi-iqn.2010-10.org.openstack:volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222-lun-1'</span>/&gt;</span><br><span class="line">  &lt;backingStore/&gt;</span><br><span class="line">  &lt;target dev=<span class="string">'vdb'</span> bus=<span class="string">'virtio'</span>/&gt;</span><br><span class="line">  &lt;serial&gt;81ffed40-ed71-495d-bfa9-8fb8c72cf222&lt;/serial&gt;</span><br><span class="line">  &lt;<span class="built_in">alias</span> name=<span class="string">'virtio-disk1'</span>/&gt;</span><br><span class="line">  &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x05'</span> <span class="keyword">function</span>=<span class="string">'0x0'</span>/&gt;</span><br><span class="line">&lt;/disk&gt;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="Heat"><a href="#Heat" class="headerlink" title="Heat"></a>Heat</h2><h3 id="Install-and-configure-1"><a href="#Install-and-configure-1" class="headerlink" title="Install and configure"></a>Install and configure</h3><p>This section describes how to install and configure the Orchestration service for Ubuntu 14.04 (LTS).</p>
<p>While our Ubuntu 16.04.3 LTS will be ok as well. </p>
<h3 id="Prerequisites-5"><a href="#Prerequisites-5" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><p>Before you install and configure Orchestration, you must create a database, service credentials, and API endpoints. Orchestration also requires additional information in the Identity service.</p>
<ol>
<li><p>To create the database, complete these steps:</p>
<ul>
<li>Use the database access client to connect to the database server as the <code>root</code> user:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysql</span><br></pre></td></tr></table></figure>

<ul>
<li>Create the <code>heat</code> database:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE heat;</span><br></pre></td></tr></table></figure>

<ul>
<li>Grant proper access to the <code>heat</code> database:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​</span><br></pre></td></tr></table></figure>
<p> GRANT ALL PRIVILEGES ON heat.* TO ‘heat’@’localhost’ <br>   IDENTIFIED BY ‘HEAT_DBPASS’;<br> GRANT ALL PRIVILEGES ON heat.* TO ‘heat’@’%’ <br>   IDENTIFIED BY ‘HEAT_DBPASS’;<br> ​```</p>
<p> Replace <code>HEAT_DBPASS</code> with a suitable password.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   - Exit the database access client.</span><br><span class="line"></span><br><span class="line">2. Source the &#96;admin&#96; credentials to gain access to admin-only CLI commands:</span><br><span class="line"></span><br><span class="line">   &#96;&#96;&#96;bash</span><br><span class="line">   $ . admin-openrc</span><br><span class="line">   </span><br><span class="line">   ​&#96;&#96;&#96;bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>To create the service credentials, complete these steps:</p>
<ul>
<li><p>Create the <code>heat</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain default --password-prompt heat</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| Field     | Value                            |</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| domain_id | e0353a670a9e496da891347c589539e9 |</span><br><span class="line">| enabled   | True                             |</span><br><span class="line">| id        | ca2e175b851943349be29a328cc5e360 |</span><br><span class="line">| name      | heat                             |</span><br><span class="line">+-----------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the <code>admin</code> role to the <code>heat</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user heat admin</span><br></pre></td></tr></table></figure>

<p>This command provides no output.</p>
</li>
<li><p>Create the <code>heat</code> and <code>heat-cfn</code> service entities:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name heat \</span><br><span class="line">  --description <span class="string">"Orchestration"</span> orchestration</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Orchestration                    |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 727841c6f5df4773baa4e8a5ae7d72eb |</span><br><span class="line">| name        | heat                             |</span><br><span class="line">| <span class="built_in">type</span>        | orchestration                    |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack service create --name heat-cfn \</span><br><span class="line">  --description <span class="string">"Orchestration"</span>  cloudformation</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Orchestration                    |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | c42cede91a4e47c3b10c8aedc8d890c6 |</span><br><span class="line">| name        | heat-cfn                         |</span><br><span class="line">| <span class="built_in">type</span>        | cloudformation                   |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Create the Orchestration service API endpoints:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  orchestration public http://controller:8004/v1/%\(tenant_id\)s</span><br><span class="line">+--------------+-----------------------------------------+</span><br><span class="line">| Field        | Value                                   |</span><br><span class="line">+--------------+-----------------------------------------+</span><br><span class="line">| enabled      | True                                    |</span><br><span class="line">| id           | 3f4dab34624e4be7b000265f25049609        |</span><br><span class="line">| interface    | public                                  |</span><br><span class="line">| region       | RegionOne                               |</span><br><span class="line">| region_id    | RegionOne                               |</span><br><span class="line">| service_id   | 727841c6f5df4773baa4e8a5ae7d72eb        |</span><br><span class="line">| service_name | heat                                    |</span><br><span class="line">| service_type | orchestration                           |</span><br><span class="line">| url          | http://controller:8004/v1/%(tenant_id)s |</span><br><span class="line">+--------------+-----------------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  orchestration internal http://controller:8004/v1/%\(tenant_id\)s</span><br><span class="line">+--------------+-----------------------------------------+</span><br><span class="line">| Field        | Value                                   |</span><br><span class="line">+--------------+-----------------------------------------+</span><br><span class="line">| enabled      | True                                    |</span><br><span class="line">| id           | 9489f78e958e45cc85570fec7e836d98        |</span><br><span class="line">| interface    | internal                                |</span><br><span class="line">| region       | RegionOne                               |</span><br><span class="line">| region_id    | RegionOne                               |</span><br><span class="line">| service_id   | 727841c6f5df4773baa4e8a5ae7d72eb        |</span><br><span class="line">| service_name | heat                                    |</span><br><span class="line">| service_type | orchestration                           |</span><br><span class="line">| url          | http://controller:8004/v1/%(tenant_id)s |</span><br><span class="line">+--------------+-----------------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  orchestration admin http://controller:8004/v1/%\(tenant_id\)s</span><br><span class="line">+--------------+-----------------------------------------+</span><br><span class="line">| Field        | Value                                   |</span><br><span class="line">+--------------+-----------------------------------------+</span><br><span class="line">| enabled      | True                                    |</span><br><span class="line">| id           | 76091559514b40c6b7b38dde790efe99        |</span><br><span class="line">| interface    | admin                                   |</span><br><span class="line">| region       | RegionOne                               |</span><br><span class="line">| region_id    | RegionOne                               |</span><br><span class="line">| service_id   | 727841c6f5df4773baa4e8a5ae7d72eb        |</span><br><span class="line">| service_name | heat                                    |</span><br><span class="line">| service_type | orchestration                           |</span><br><span class="line">| url          | http://controller:8004/v1/%(tenant_id)s |</span><br><span class="line">+--------------+-----------------------------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  cloudformation public http://controller:8000/v1</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | b3ea082e019c4024842bf0a80555052c |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | c42cede91a4e47c3b10c8aedc8d890c6 |</span><br><span class="line">| service_name | heat-cfn                         |</span><br><span class="line">| service_type | cloudformation                   |</span><br><span class="line">| url          | http://controller:8000/v1        |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  cloudformation internal http://controller:8000/v1</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 169df4368cdc435b8b115a9cb084044e |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | c42cede91a4e47c3b10c8aedc8d890c6 |</span><br><span class="line">| service_name | heat-cfn                         |</span><br><span class="line">| service_type | cloudformation                   |</span><br><span class="line">| url          | http://controller:8000/v1        |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  cloudformation admin http://controller:8000/v1</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 3d3edcd61eb343c1bbd629aa041ff88b |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | c42cede91a4e47c3b10c8aedc8d890c6 |</span><br><span class="line">| service_name | heat-cfn                         |</span><br><span class="line">| service_type | cloudformation                   |</span><br><span class="line">| url          | http://controller:8000/v1        |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Orchestration requires additional information in the Identity service to manage stacks. To add this information, complete these steps:</p>
<ul>
<li><p>Create the <code>heat</code> domain that contains projects and users for stacks:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ openstack domain create --description <span class="string">"Stack projects and users"</span> heat</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Stack projects and users         |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 0f4d1bd326f2454dacc72157ba328a47 |</span><br><span class="line">| name        | heat                             |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the <code>heat_domain_admin</code> user to manage projects and users in the <code>heat</code> domain:</p>
<blockquote>
<p>here i gave password: heat_domain_admin</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain heat --password-prompt heat_domain_admin</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| Field     | Value                            |</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| domain_id | 0f4d1bd326f2454dacc72157ba328a47 |</span><br><span class="line">| enabled   | True                             |</span><br><span class="line">| id        | b7bd1abfbcf64478b47a0f13cd4d970a |</span><br><span class="line">| name      | heat_domain_admin                |</span><br><span class="line">+-----------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the <code>admin</code> role to the <code>heat_domain_admin</code> user in the <code>heat</code> domain to enable administrative stack management privileges by the <code>heat_domain_admin</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --domain heat --user-domain heat --user heat_domain_admin admin</span><br></pre></td></tr></table></figure>

<p>This command provides no output.</p>
</li>
<li><p>Create the <code>heat_stack_owner</code> role:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role create heat_stack_owner</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| Field     | Value                            |</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| domain_id | None                             |</span><br><span class="line">| id        | 15e34f0c4fed4e68b3246275883c8630 |</span><br><span class="line">| name      | heat_stack_owner                 |</span><br><span class="line">+-----------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the <code>heat_stack_owner</code> role to the <code>demo</code> project and user to enable stack management by the <code>demo</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project demo --user demo heat_stack_owner</span><br></pre></td></tr></table></figure>

<p>This command provides no output.</p>
<blockquote>
<p> You must add the <code>heat_stack_owner</code> role to each user that manages stacks.</p>
</blockquote>
</li>
<li><p>Create the <code>heat_stack_user</code> role:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role create heat_stack_user</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| Field     | Value                            |</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| domain_id | None                             |</span><br><span class="line">| id        | 88849d41a55d4d1d91e4f11bffd8fc5c |</span><br><span class="line">| name      | heat_stack_user                  |</span><br><span class="line">+-----------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>The Orchestration service automatically assigns the <code>heat_stack_user</code> role to users that it creates during stack deployment. By default, this role restricts API &lt;Application Programming Interface (API)&gt; operations. To avoid conflicts, do not add this role to users with the <code>heat_stack_owner</code> role.</p>
</li>
</ul>
</li>
</ol>
<h3 id="Install-and-configure-components-5"><a href="#Install-and-configure-components-5" class="headerlink" title="Install and configure components"></a>Install and configure components</h3><p>Install the packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get install heat-api heat-api-cfn heat-engine</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>Edit the <code>/etc/heat/heat.conf</code> file and complete the following actions:</p>
<ul>
<li><p>In the <code>[database]</code> section, configure database access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">...</span><br><span class="line">connection = mysql+pymysql://heat:HEAT_DBPASS@controller/heat</span><br></pre></td></tr></table></figure>

<p>Replace <code>HEAT_DBPASS</code> with the password you chose for the Orchestration database.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br></pre></td></tr></table></figure>

<p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p>
</li>
<li><p>In the <code>[keystone_authtoken]</code>, <code>[trustee]</code> and <code>[clients_keystone]</code> sections, configure Identity service access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[keystone_authtoken]</span><br><span class="line">...</span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = heat</span><br><span class="line">password = HEAT_PASS</span><br><span class="line"></span><br><span class="line">[trustee]</span><br><span class="line">...</span><br><span class="line">auth_type = password</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">username = heat</span><br><span class="line">password = heat</span><br><span class="line">user_domain_name = default</span><br><span class="line"></span><br><span class="line">[clients_keystone]</span><br><span class="line">...</span><br><span class="line">auth_uri = http://controller:5000</span><br></pre></td></tr></table></figure>

<p>Replace <code>password</code> with the password you chose for the <code>heat</code> user in the Identity service.</p>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure the metadata and wait condition URLs:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">heat_metadata_server_url = http://controller:8000</span><br><span class="line">heat_waitcondition_server_url = http://controller:8000/v1/waitcondition</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the <code>[DEFAULT]</code> section, configure the stack domain and administrative credentials:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">stack_domain_admin = heat_domain_admin</span><br><span class="line">stack_domain_admin_password = heat_domain_admin</span><br><span class="line">stack_user_domain_name = heat</span><br></pre></td></tr></table></figure>

<p>Replace <code>heat_domain_admin</code> with the password you chose for the <code>heat_domain_admin</code> user in the Identity service.</p>
</li>
</ul>
</li>
<li><p>Populate the Orchestration database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su -s /bin/sh -c "heat-manage db_sync" heat</span></span><br></pre></td></tr></table></figure>

<p>Ignore any deprecation messages in this output.</p>
</li>
</ol>
<h3 id="Finalize-installation-7"><a href="#Finalize-installation-7" class="headerlink" title="Finalize installation"></a>Finalize installation</h3><ol>
<li><p>Restart the Orchestration services:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service heat-api restart</span></span><br><span class="line"><span class="comment"># service heat-api-cfn restart</span></span><br><span class="line"><span class="comment"># service heat-engine restart</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Verify-operation-5"><a href="#Verify-operation-5" class="headerlink" title="Verify operation"></a>Verify operation</h3><p>Verify operation of the Orchestration service. </p>
<p>Perform these commands on the controller node.</p>
<ol>
<li><p>Source the <code>admin</code> tenant credentials:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>List service components to verify successful launch and registration of each process:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ openstack orchestration service list</span><br><span class="line">+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+</span><br><span class="line">| hostname   | binary      | engine_id                            | host       | topic  | updated_at                 | status |</span><br><span class="line">+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+</span><br><span class="line">| controller | heat-engine | 3e85d1ab-a543-41aa-aa97-378c381fb958 | controller | engine | 2015-10-13T14:16:06.000000 | up     |</span><br><span class="line">| controller | heat-engine | 45dbdcf6-5660-4d5f-973a-c4fc819da678 | controller | engine | 2015-10-13T14:16:06.000000 | up     |</span><br><span class="line">| controller | heat-engine | 51162b63-ecb8-4c6c-98c6-993af899c4f7 | controller | engine | 2015-10-13T14:16:06.000000 | up     |</span><br><span class="line">| controller | heat-engine | 8d7edc6d-77a6-460d-bd2a-984d76954646 | controller | engine | 2015-10-13T14:16:06.000000 | up     |</span><br><span class="line">+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+</span><br></pre></td></tr></table></figure>

<p>This output should indicate four <code>heat-engine</code> components (default to 4 or number of CPUs on the host, whichever is greater) on the controller node.</p>
</li>
</ol>
<h2 id="ISSUE-list-heat-service-failure"><a href="#ISSUE-list-heat-service-failure" class="headerlink" title="[ISSUE] list heat service failure"></a>[ISSUE] list heat service failure</h2><h3 id="error-occurred-during-openstack-orchestration-service-list"><a href="#error-occurred-during-openstack-orchestration-service-list" class="headerlink" title="error occurred during openstack orchestration service list"></a>error occurred during <code>openstack orchestration service list</code></h3><p>the initial output is very nonsense as below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># openstack orchestration service list</span></span><br><span class="line">ERROR: None</span><br></pre></td></tr></table></figure>

<p> give <code>--debug</code> to have detailed information</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">REQ: curl -g -i -X GET http://controller:8004/v1/78c9c849237649a3a8c4526167427589/services -H <span class="string">"User-Agent: python-heatclient"</span> -H <span class="string">"Accept: application/json"</span> -H <span class="string">"X-Auth-Token: &#123;SHA1&#125;d4b406278269babd78368ed572cbe50382938cb6"</span></span><br><span class="line">Starting new HTTP connection (1): controller</span><br><span class="line">http://controller:8004 <span class="string">"GET /v1/78c9c849237649a3a8c4526167427589/services HTTP/1.1"</span> 503 170</span><br><span class="line">RESP: [503] Content-Length: 170 Content-Type: application/json; charset=UTF-8 X-Openstack-Request-Id: req-e38d405a-776d-44fa-bb31-e180d62c42e0 Date: Fri, 25 Aug 2017 06:05:45 GMT Connection: keep-alive</span><br><span class="line">RESP BODY: &#123;<span class="string">"message"</span>: <span class="string">"The server is currently unavailable. Please try again at a later time.&lt;br /&gt;&lt;br /&gt;\n\n\n"</span>, <span class="string">"code"</span>: <span class="string">"503 Service Unavailable"</span>, <span class="string">"title"</span>: <span class="string">"Service Unavailable"</span>&#125;</span><br><span class="line"></span><br><span class="line">GET call to orchestration <span class="keyword">for</span> http://controller:8004/v1/78c9c849237649a3a8c4526167427589/services used request id req-e38d405a-776d-44fa-bb31-e180d62c42e0</span><br><span class="line">ERROR: None</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/cliff/app.py"</span>, line 400, <span class="keyword">in</span> run_subcommand</span><br><span class="line">    result = cmd.run(parsed_args)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/osc_lib/command/command.py"</span>, line 41, <span class="keyword">in</span> run</span><br><span class="line">    <span class="built_in">return</span> super(Command, self).run(parsed_args)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/cliff/display.py"</span>, line 112, <span class="keyword">in</span> run</span><br><span class="line">    column_names, data = self.take_action(parsed_args)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/heatclient/osc/v1/service.py"</span>, line 37, <span class="keyword">in</span> take_action</span><br><span class="line"></span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/heatclient/v1/services.py"</span>, line 33, <span class="keyword">in</span> list</span><br><span class="line">    <span class="built_in">return</span> self._list(url, <span class="string">"services"</span>)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/heatclient/common/base.py"</span>, line 114, <span class="keyword">in</span> _list</span><br><span class="line"></span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/keystoneauth1/adapter.py"</span>, line 217, <span class="keyword">in</span> get</span><br><span class="line">    <span class="built_in">return</span> self.request(url, <span class="string">'GET'</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/heatclient/common/http.py"</span>, line 318, <span class="keyword">in</span> request</span><br><span class="line">    raise exc.from_response(resp)</span><br><span class="line">HTTPServiceUnavailable: ERROR: None</span><br><span class="line">clean_up ListService: ERROR: None</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/osc_lib/shell.py"</span>, line 135, <span class="keyword">in</span> run</span><br><span class="line">    ret_val = super(OpenStackShell, self).run(argv)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/cliff/app.py"</span>, line 279, <span class="keyword">in</span> run</span><br><span class="line">    result = self.run_subcommand(remainder)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/osc_lib/shell.py"</span>, line 180, <span class="keyword">in</span> run_subcommand</span><br><span class="line">    ret_value = super(OpenStackShell, self).run_subcommand(argv)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/cliff/app.py"</span>, line 400, <span class="keyword">in</span> run_subcommand</span><br><span class="line">    result = cmd.run(parsed_args)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/osc_lib/command/command.py"</span>, line 41, <span class="keyword">in</span> run</span><br><span class="line">    <span class="built_in">return</span> super(Command, self).run(parsed_args)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/cliff/display.py"</span>, line 112, <span class="keyword">in</span> run</span><br><span class="line">    column_names, data = self.take_action(parsed_args)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/heatclient/osc/v1/service.py"</span>, line 37, <span class="keyword">in</span> take_action</span><br><span class="line">    services = heat_client.services.list()</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/heatclient/v1/services.py"</span>, line 33, <span class="keyword">in</span> list</span><br><span class="line">    <span class="built_in">return</span> self._list(url, <span class="string">"services"</span>)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/heatclient/common/base.py"</span>, line 114, <span class="keyword">in</span> _list</span><br><span class="line">    body = self.client.get(url).json()</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/keystoneauth1/adapter.py"</span>, line 217, <span class="keyword">in</span> get</span><br><span class="line">    <span class="built_in">return</span> self.request(url, <span class="string">'GET'</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/heatclient/common/http.py"</span>, line 318, <span class="keyword">in</span> request</span><br><span class="line">    raise exc.from_response(resp)</span><br><span class="line">HTTPServiceUnavailable: ERROR: None</span><br><span class="line"></span><br><span class="line">END <span class="built_in">return</span> value: 1</span><br></pre></td></tr></table></figure>

<p>We could see it got <code>503</code> when performing api call in <code>8004</code> port</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REQ: curl -g -i -X GET http://controller:8004/v1/78c9c849237649a3a8c4526167427589/services -H <span class="string">"User-Agent: python-heatclient"</span> -H <span class="string">"Accept: application/json"</span> -H <span class="string">"X-Auth-Token: &#123;SHA1&#125;d4b406278269babd78368ed572cbe50382938cb6"</span></span><br><span class="line">Starting new HTTP connection (1): controller</span><br><span class="line">http://controller:8004 <span class="string">"GET /v1/78c9c849237649a3a8c4526167427589/services HTTP/1.1"</span> 503 170</span><br><span class="line">RESP: [503] Content-Length: 170 Content-Type: application/json; charset=UTF-8 X-Openstack-Request-Id: req-e38d405a-776d-44fa-bb31-e180d62c42e0 Date: Fri, 25 Aug 2017 06:05:45 GMT Connection: keep-alive</span><br><span class="line">RESP BODY: &#123;<span class="string">"message"</span>: <span class="string">"The server is currently unavailable. Please try again at a later time.&lt;br /&gt;&lt;br /&gt;\n\n\n"</span>, <span class="string">"code"</span>: <span class="string">"503 Service Unavailable"</span>, <span class="string">"title"</span>: <span class="string">"Service Unavailable"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>it’s checked to be heat wsgi service</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># openstack endpoint list | grep 8004</span></span><br><span class="line">| 1d6153de2a7a4bfc8f5277b360d5b695 | RegionOne | heat         | orchestration  | True    | internal  | http://controller:8004/v1/%(tenant_id)s   |</span><br><span class="line">| 38dd2f686f5840e6ae9381b6df1076d8 | RegionOne | heat         | orchestration  | True    | admin     | http://controller:8004/v1/%(tenant_id)s   |</span><br><span class="line">| 88b0e0667eb149efa337e6e0428c98ad | RegionOne | heat         | orchestration  | True    | public    | http://controller:8004/v1/%(tenant_id)s   |</span><br></pre></td></tr></table></figure>

<p>Then let’s check <code>503</code> in <code>/var/log/heat/heat-api.log</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2017-08-25 14:24:48.962 2778 WARNING keystonemiddleware.auth_token [-] Identity response: &#123;<span class="string">"error"</span>: &#123;<span class="string">"message"</span>: <span class="string">"The request you have made requires authentication."</span>, <span class="string">"code"</span>: 401, <span class="string">"title"</span>: <span class="string">"Unauthorized"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>it’s keystone <code>401</code> meaning the credential is with issues when requesting token from keystone, let us check keystone logs:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep "Authorization failed" /var/log/apache2/keyston*.log</span></span><br><span class="line"></span><br><span class="line">/var/<span class="built_in">log</span>/apache2/keystone.log:2017-08-25 14:24:48.954127 2017-08-25 14:24:48.953 3388 WARNING keystone.common.wsgi [req-fc1e6351-ab7a-40e3-967d-4e7376ced9d9 - - - - -] Authorization failed. The request you have made requires authentication. from 10.20.0.10</span><br></pre></td></tr></table></figure>

<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>Where the credential for heat keystone call was configured? <code>/etc/heat/heat.conf</code> , it turned out we set wrong password for keystone, the one we set was <code>heat</code> while HEAT_PASS was configured, changed it as below and restart services will solve the issue.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[keystone_authtoken]</span><br><span class="line">...</span><br><span class="line">password = heat</span><br><span class="line"></span><br><span class="line">[trustee]</span><br><span class="line">...</span><br><span class="line">password = heat</span><br></pre></td></tr></table></figure>

<p>restart services to make it work</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service heat-api restart</span></span><br><span class="line"><span class="comment"># service heat-api-cfn restart</span></span><br><span class="line"><span class="comment"># service heat-engine restart</span></span><br></pre></td></tr></table></figure>

<p>and verify it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@controller:/var/<span class="built_in">log</span><span class="comment"># openstack orchestration service list --max-width 85 </span></span><br><span class="line">+------------+------------+------------+------------+--------+-------------+--------+</span><br><span class="line">| Hostname   | Binary     | Engine ID  | Host       | Topic  | Updated At  | Status |</span><br><span class="line">+------------+------------+------------+------------+--------+-------------+--------+</span><br><span class="line">| controller | heat-      | 07ff1da7   | controller | engine | 2017-08-25T | up     |</span><br><span class="line">|            | engine     | -a77b-4d52 |            |        | 06:49:36.00 |        |</span><br><span class="line">|            |            | -95e6-cb53 |            |        | 0000        |        |</span><br><span class="line">|            |            | 89a106dc   |            |        |             |        |</span><br><span class="line">|            | engine     | de8-45eb-9 |            |        | 06:24:52.00 |        |</span><br><span class="line">|            |            | 839-4d038d |            |        | 0000        |        |</span><br><span class="line">|            |            | a4a330     |            |        |             |        |</span><br><span class="line">| controller | heat-      | 279303d6-2 | controller | engine | 2017-08-25T | up     |</span><br><span class="line">|            | engine     | d06-4e55-b |            |        | 06:49:36.00 |        |</span><br><span class="line">|            |            | 931-2c8ad0 |            |        | 0000        |        |</span><br><span class="line">|            |            | eadca7     |            |        |             |        |</span><br><span class="line">| controller | heat-      | 2cd3a832<span class="_">-d</span> | controller | engine | 2017-08-25T | up     |</span><br><span class="line">|            | engine     | c21-4cfa-  |            |        | 06:49:36.00 |        |</span><br><span class="line">|            |            | 8a4b-bddd8 |            |        | 0000        |        |</span><br><span class="line">|            |            | dadba12    |            |        |             |        |</span><br><span class="line">| controller | heat-      | e1b05787   | controller | engine | 2017-08-25T | up     |</span><br><span class="line">|            | engine     | -9eda-46c3 |            |        | 06:49:36.00 |        |</span><br><span class="line">|            |            | -acca-b1f9 |            |        | 0000        |        |</span><br><span class="line">|            |            | bcf7b653   |            |        |             |        |</span><br><span class="line">|            | engine     | 1fa-4844-9 |            |        | 06:24:52.00 |        |</span><br><span class="line">|            |            | f68-688486 |            |        | 0000        |        |</span><br><span class="line">|            |            | f4ccfb     |            |        |             |        |</span><br><span class="line">|            | engine     | 023-4d10   |            |        | 06:24:52.00 |        |</span><br><span class="line">|            |            | -89ea-30af |            |        | 0000        |        |</span><br><span class="line">|            |            | f5430d25   |            |        |             |        |</span><br><span class="line">|            | engine     | b86-41af-  |            |        | 06:24:52.00 |        |</span><br><span class="line">|            |            | 895a-0c43a |            |        | 0000        |        |</span><br><span class="line">|            |            | f016950    |            |        |             |        |</span><br><span class="line">+------------+------------+------------+------------+--------+-------------+--------+</span><br></pre></td></tr></table></figure>



<h2 id="Start-Orchestration-let’s-start-from-a-single-instance-HOT"><a href="#Start-Orchestration-let’s-start-from-a-single-instance-HOT" class="headerlink" title="Start Orchestration! let’s start from a single instance HOT"></a>Start Orchestration! let’s start from a single instance HOT</h2><blockquote>
<p>ref: <a href="https://docs.openstack.org/heat/latest/install/launch-instance.html" target="_blank" rel="noopener">https://docs.openstack.org/heat/latest/install/launch-instance.html</a></p>
</blockquote>
<p>In environments that include the Orchestration service, you can create a stack that launches an instance.</p>
<h3 id="Create-a-template"><a href="#Create-a-template" class="headerlink" title="Create a template"></a>Create a template</h3><p>The Orchestration service uses templates to describe stacks. To learn about the template language, see <a href="http://docs.openstack.org/developer/heat/template_guide/index.html" target="_blank" rel="noopener">the Template Guide</a> in the <a href="http://docs.openstack.org/developer/heat/index.html" target="_blank" rel="noopener">Heat developer documentation</a>.</p>
<ul>
<li><p>Create the <code>HOT-demo.yml</code> file with the following content:</p>
<blockquote>
<p>You could fetch it from here to avoid format error: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># wget https:&#x2F;&#x2F;github.com&#x2F;littlewey&#x2F;workshops&#x2F;raw&#x2F;master&#x2F;00-Openstack-Basic&#x2F;HOT-demo.yml</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">heat_template_version: 2015-10-15</span><br><span class="line">description: Launch a basic instance with CirrOS image using the</span><br><span class="line">             ``m1.nano`` flavor,  and one network.</span><br><span class="line"></span><br><span class="line">parameters:</span><br><span class="line">  NetID:</span><br><span class="line">    <span class="built_in">type</span>: string</span><br><span class="line">    description: Network ID to use <span class="keyword">for</span> the instance.</span><br><span class="line"></span><br><span class="line">resources:</span><br><span class="line">  server:</span><br><span class="line">    <span class="built_in">type</span>: OS::Nova::Server</span><br><span class="line">    properties:</span><br><span class="line">      image: cirros</span><br><span class="line">      flavor: m1.nano</span><br><span class="line">      networks:</span><br><span class="line">      - network: &#123; get_param: NetID &#125;       </span><br><span class="line">outputs:</span><br><span class="line">  instance_name:</span><br><span class="line">    description: Name of the instance.</span><br><span class="line">    value: &#123; get_attr: [ server, name ] &#125;</span><br><span class="line">  instance_ip:</span><br><span class="line">    description: IP address of the instance.</span><br><span class="line">    value: &#123; get_attr: [ server, first_address ] &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Create-a-stack"><a href="#Create-a-stack" class="headerlink" title="Create a stack"></a>Create a stack</h3><p>Create a stack using the <code>demo-template.yml</code> template.</p>
<ol>
<li><p>Source the <code>demo</code> credentials to perform the following steps as a non-administrative project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . demo-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>Determine available networks.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack network list</span></span><br><span class="line">+--------------------------------------+----------+--------------------------------------+</span><br><span class="line">| ID                                   | Name     | Subnets                              |</span><br><span class="line">+--------------------------------------+----------+--------------------------------------+</span><br><span class="line">| 2a33434f-ba29-4645-9b5d-24f1509066f1 | provider | 9b118521-59b5-40ee-a439-9d59c3b392ea |</span><br><span class="line">+--------------------------------------+----------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<p>This output may differ from your environment.</p>
</li>
<li><p>Set the <code>NET_ID</code> environment variable to reflect the ID of a network. For example, using the provider network:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> NET_ID=$(openstack network list | awk <span class="string">'/ provider / &#123; print $2 &#125;'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a stack of one CirrOS instance on the provider network:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ openstack stack create -t HOT-demo.yml --parameter <span class="string">"NetID=<span class="variable">$NET_ID</span>"</span> stack</span><br><span class="line">+--------------------------------------+------------+--------------------+---------------------+--------------+</span><br><span class="line">| ID                                   | Stack Name | Stack Status       | Creation Time       | Updated Time |</span><br><span class="line">+--------------------------------------+------------+--------------------+---------------------+--------------+</span><br><span class="line">| dbf46d1b-0b97-4d45-a0b3-9662a1eb6cf3 | stack      | CREATE_IN_PROGRESS | 2015-10-13T15:27:20 | None         |</span><br><span class="line">+--------------------------------------+------------+--------------------+---------------------+--------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>After a short time, verify successful creation of the stack:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ openstack stack list</span><br><span class="line">+--------------------------------------+------------+-----------------+---------------------+--------------+</span><br><span class="line">| ID                                   | Stack Name | Stack Status    | Creation Time       | Updated Time |</span><br><span class="line">+--------------------------------------+------------+-----------------+---------------------+--------------+</span><br><span class="line">| dbf46d1b-0b97-4d45-a0b3-9662a1eb6cf3 | stack      | CREATE_COMPLETE | 2015-10-13T15:27:20 | None         |</span><br><span class="line">+--------------------------------------+------------+-----------------+---------------------+--------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Show the name and IP address of the instance and compare with the output of the OpenStack client:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack stack output show --all stack</span></span><br><span class="line">+---------------+-------------------------------------------------+</span><br><span class="line">| Field         | Value                                           |</span><br><span class="line">+---------------+-------------------------------------------------+</span><br><span class="line">| instance_name | &#123;                                               |</span><br><span class="line">|               |   <span class="string">"output_value"</span>: <span class="string">"stack-server-bigm7yoguexa"</span>,  |</span><br><span class="line">|               |   <span class="string">"output_key"</span>: <span class="string">"instance_name"</span>,                |</span><br><span class="line">|               |   <span class="string">"description"</span>: <span class="string">"Name of the instance."</span>        |</span><br><span class="line">|               | &#125;                                               |</span><br><span class="line">| instance_ip   | &#123;                                               |</span><br><span class="line">|               |   <span class="string">"output_value"</span>: <span class="string">"146.11.41.233"</span>,              |</span><br><span class="line">|               |   <span class="string">"output_key"</span>: <span class="string">"instance_ip"</span>,                  |</span><br><span class="line">|               |   <span class="string">"description"</span>: <span class="string">"IP address of the instance."</span>  |</span><br><span class="line">|               | &#125;                                               |</span><br><span class="line">+---------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack server list</span></span><br><span class="line">+--------------------------------------+---------------------------+---------+------------------------+------------+</span><br><span class="line">| ID                                   | Name                      | Status  | Networks               | Image Name |</span><br><span class="line">+--------------------------------------+---------------------------+---------+------------------------+------------+</span><br><span class="line">| a81fc7b9-b5c0-4a0f-85d3-3ff739f8e5ce | stack-server-bigm7yoguexa | ACTIVE  | provider=146.11.41.233 | cirros     |</span><br><span class="line">| e73c64ac-3af3-47fd-abfe-e138e40f0a40 | provider-instance         | SHUTOFF | provider=146.11.41.232 | cirros     |</span><br><span class="line">+--------------------------------------+---------------------------+---------+------------------------+------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Delete the stack.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack stack delete --yes stack</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="How-about-Design-a-fake-vAPG-VNF-and-instantiate-it"><a href="#How-about-Design-a-fake-vAPG-VNF-and-instantiate-it" class="headerlink" title="How about Design a fake vAPG VNF and instantiate it?"></a>How about Design a fake vAPG VNF and instantiate it?</h2><blockquote>
<p> ref: <a href="https://docs.openstack.org/heat/latest/template_guide/index.html" target="_blank" rel="noopener">https://docs.openstack.org/heat/latest/template_guide/index.html</a></p>
</blockquote>
<h3 id="HOT"><a href="#HOT" class="headerlink" title="HOT"></a>HOT</h3><blockquote>
<p>fetch it here:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://github.com/littlewey/workshops/raw/master/00-Openstack-Basic/HOT-vAPG.yml</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">heat_template_version:</span> <span class="number">2015</span><span class="number">-10</span><span class="number">-15</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">Fake</span> <span class="string">vAPG</span> <span class="string">with</span> <span class="string">CirrOS</span> <span class="string">image</span> <span class="string">using</span> <span class="string">the</span></span><br><span class="line">             <span class="string">``m1.nano``</span> <span class="string">flavor,</span>  <span class="string">and</span> <span class="string">one</span> <span class="string">network.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">NetID:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Network</span> <span class="string">ID</span> <span class="string">to</span> <span class="string">use</span> <span class="string">for</span> <span class="string">the</span> <span class="string">instance.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">resources:</span></span><br><span class="line">  <span class="attr">nodeA:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">OS::Nova::Server</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">cirros</span></span><br><span class="line">      <span class="attr">flavor:</span> <span class="string">m1.nano</span></span><br><span class="line">      <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">network:</span> <span class="string">&#123;</span> <span class="attr">get_param:</span> <span class="string">NetID</span> <span class="string">&#125;</span></span><br><span class="line">  <span class="attr">nodeB:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">OS::Nova::Server</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">cirros</span></span><br><span class="line">      <span class="attr">flavor:</span> <span class="string">m1.nano</span></span><br><span class="line">      <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">network:</span> <span class="string">&#123;</span> <span class="attr">get_param:</span> <span class="string">NetID</span> <span class="string">&#125;</span></span><br><span class="line">  <span class="attr">diskA:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">OS::Cinder::Volume</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">diskB:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">OS::Cinder::Volume</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">NodeAvolume_attachment:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">OS::Cinder::VolumeAttachment</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">volume_id:</span> <span class="string">&#123;</span> <span class="attr">get_resource:</span> <span class="string">diskA</span> <span class="string">&#125;</span></span><br><span class="line">      <span class="attr">instance_uuid:</span> <span class="string">&#123;</span> <span class="attr">get_resource:</span> <span class="string">nodeA</span> <span class="string">&#125;</span></span><br><span class="line">  <span class="attr">NodeBvolume_attachment:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">OS::Cinder::VolumeAttachment</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">volume_id:</span> <span class="string">&#123;</span> <span class="attr">get_resource:</span> <span class="string">diskB</span> <span class="string">&#125;</span></span><br><span class="line">      <span class="attr">instance_uuid:</span> <span class="string">&#123;</span> <span class="attr">get_resource:</span> <span class="string">nodeB</span> <span class="string">&#125;</span></span><br><span class="line"><span class="attr">outputs:</span></span><br><span class="line">  <span class="attr">nodeA:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Name</span> <span class="string">of</span> <span class="string">the</span> <span class="string">instance.</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#123;</span> <span class="attr">get_attr:</span> <span class="string">[</span> <span class="string">nodeA,</span> <span class="string">name</span> <span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line">  <span class="attr">nodeA_ip:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">IP</span> <span class="string">address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">instance.</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#123;</span> <span class="attr">get_attr:</span> <span class="string">[</span> <span class="string">nodeA,</span> <span class="string">first_address</span> <span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line">  <span class="attr">nodeB:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Name</span> <span class="string">of</span> <span class="string">the</span> <span class="string">instance.</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#123;</span> <span class="attr">get_attr:</span> <span class="string">[</span> <span class="string">nodeB,</span> <span class="string">name</span> <span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line">  <span class="attr">nodeB_ip:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">IP</span> <span class="string">address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">instance.</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#123;</span> <span class="attr">get_attr:</span> <span class="string">[</span> <span class="string">nodeB,</span> <span class="string">first_address</span> <span class="string">]</span> <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="Instantiation-vAPG"><a href="#Instantiation-vAPG" class="headerlink" title="Instantiation vAPG"></a>Instantiation vAPG</h3><p>For simplicity we reused the existed network</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># . demo-openrc</span></span><br><span class="line"><span class="comment"># openstack stack create -t HOT-vAPG.yml --parameter "NetID=$NET_ID" vAPG</span></span><br><span class="line"></span><br><span class="line">// monitoring </span><br><span class="line"></span><br><span class="line"><span class="comment"># openstack stack output show --all vAPG</span></span><br></pre></td></tr></table></figure>

<p>Print outs during/after instantiation</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack stack list</span></span><br><span class="line">+--------------------------------------+------------+--------------------+----------------------+--------------+</span><br><span class="line">| ID                                   | Stack Name | Stack Status       | Creation Time        | Updated Time |</span><br><span class="line">+--------------------------------------+------------+--------------------+----------------------+--------------+</span><br><span class="line">| 7c4f5cda-a943-4d64-be23-72402829c62f | vAPG       | CREATE_IN_PROGRESS | 2017-08-25T07:38:55Z | None         |</span><br><span class="line">+--------------------------------------+------------+--------------------+----------------------+--------------+</span><br><span class="line">root@controller:~<span class="comment">#</span></span><br><span class="line">root@controller:~<span class="comment">#</span></span><br><span class="line">root@controller:~<span class="comment"># openstack stack list</span></span><br><span class="line">+--------------------------------------+------------+-----------------+----------------------+--------------+</span><br><span class="line">| ID                                   | Stack Name | Stack Status    | Creation Time        | Updated Time |</span><br><span class="line">+--------------------------------------+------------+-----------------+----------------------+--------------+</span><br><span class="line">| 7c4f5cda-a943-4d64-be23-72402829c62f | vAPG       | CREATE_COMPLETE | 2017-08-25T07:38:55Z | None         |</span><br><span class="line">+--------------------------------------+------------+-----------------+----------------------+--------------+</span><br><span class="line">root@controller:~<span class="comment"># openstack stack output show --all vAPG</span></span><br><span class="line">+----------+------------------------------------------------+</span><br><span class="line">| Field    | Value                                          |</span><br><span class="line">+----------+------------------------------------------------+</span><br><span class="line">| nodeA    | &#123;                                              |</span><br><span class="line">|          |   <span class="string">"output_value"</span>: <span class="string">"vAPG-nodeA-slvg7ccfel4j"</span>,   |</span><br><span class="line">|          |   <span class="string">"output_key"</span>: <span class="string">"nodeA"</span>,                       |</span><br><span class="line">|          |   <span class="string">"description"</span>: <span class="string">"Name of the instance."</span>       |</span><br><span class="line">|          | &#125;                                              |</span><br><span class="line">| nodeB_ip | &#123;                                              |</span><br><span class="line">|          |   <span class="string">"output_value"</span>: <span class="string">"146.11.41.231"</span>,             |</span><br><span class="line">|          |   <span class="string">"output_key"</span>: <span class="string">"nodeB_ip"</span>,                    |</span><br><span class="line">|          |   <span class="string">"description"</span>: <span class="string">"IP address of the instance."</span> |</span><br><span class="line">|          | &#125;                                              |</span><br><span class="line">| nodeA_ip | &#123;                                              |</span><br><span class="line">|          |   <span class="string">"output_value"</span>: <span class="string">"146.11.41.233"</span>,             |</span><br><span class="line">|          |   <span class="string">"output_key"</span>: <span class="string">"nodeA_ip"</span>,                    |</span><br><span class="line">|          |   <span class="string">"description"</span>: <span class="string">"IP address of the instance."</span> |</span><br><span class="line">|          | &#125;                                              |</span><br><span class="line">| nodeB    | &#123;                                              |</span><br><span class="line">|          |   <span class="string">"output_value"</span>: <span class="string">"vAPG-nodeB-rjame5ftjcrf"</span>,   |</span><br><span class="line">|          |   <span class="string">"output_key"</span>: <span class="string">"nodeB"</span>,                       |</span><br><span class="line">|          |   <span class="string">"description"</span>: <span class="string">"Name of the instance."</span>       |</span><br><span class="line">|          | &#125;                                              |</span><br><span class="line">+----------+------------------------------------------------+</span><br><span class="line">root@controller:~<span class="comment"># openstack server list</span></span><br><span class="line">+--------------------------------------+-------------------------+---------+------------------------+------------+</span><br><span class="line">| ID                                   | Name                    | Status  | Networks               | Image Name |</span><br><span class="line">+--------------------------------------+-------------------------+---------+------------------------+------------+</span><br><span class="line">| 3eef32d9-f885-48ca-a038-365233ed300f | vAPG-nodeB-rjame5ftjcrf | ACTIVE  | provider=146.11.41.231 | cirros     |</span><br><span class="line">| 2a2709f2-9d77-42e1-be36-fd51c33b30de | vAPG-nodeA-slvg7ccfel4j | ACTIVE  | provider=146.11.41.233 | cirros     |</span><br><span class="line">| e73c64ac-3af3-47fd-abfe-e138e40f0a40 | provider-instance       | SHUTOFF | provider=146.11.41.232 | cirros     |</span><br><span class="line">+--------------------------------------+-------------------------+---------+------------------------+------------+</span><br></pre></td></tr></table></figure>

<p>Check resources afterwards</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack volume list</span></span><br><span class="line">+--------------------------------+-------------------------+-----------+------+--------------------------------+</span><br><span class="line">| ID                             | Display Name            | Status    | Size | Attached to                    |</span><br><span class="line">+--------------------------------+-------------------------+-----------+------+--------------------------------+</span><br><span class="line">| 9a93c5aa-56ed-                 | vAPG-diskA-ff253tzmwhuv | <span class="keyword">in</span>-use    |    1 | Attached to vAPG-nodeA-        |</span><br><span class="line">| 42e0-b0a0-e0e617b533e1         |                         |           |      | slvg7ccfel4j on /dev/vdb       |</span><br><span class="line">| 988f5003-2a3f-                 | vAPG-diskB-xpzh5o7pw5po | <span class="keyword">in</span>-use    |    1 | Attached to vAPG-nodeB-        |</span><br><span class="line">| 4eeb-b836-6be6f64b0b32         |                         |           |      | rjame5ftjcrf on /dev/vdb       |</span><br><span class="line">+--------------------------------+-------------------------+-----------+------+--------------------------------+</span><br><span class="line">root@controller:~<span class="comment"># openstack server list</span></span><br><span class="line">+--------------------------------------+-------------------------+---------+------------------------+------------+</span><br><span class="line">| ID                                   | Name                    | Status  | Networks               | Image Name |</span><br><span class="line">+--------------------------------------+-------------------------+---------+------------------------+------------+</span><br><span class="line">| 3eef32d9-f885-48ca-a038-365233ed300f | vAPG-nodeB-rjame5ftjcrf | ACTIVE  | provider=146.11.41.231 | cirros     |</span><br><span class="line">| 2a2709f2-9d77-42e1-be36-fd51c33b30de | vAPG-nodeA-slvg7ccfel4j | ACTIVE  | provider=146.11.41.233 | cirros     |</span><br><span class="line">+--------------------------------------+-------------------------+---------+------------------------+------------+</span><br><span class="line"></span><br><span class="line">root@controller:~<span class="comment"># openstack port list</span></span><br><span class="line">+--------------------------------------+------+-------------------+----------------------------------------+--------+</span><br><span class="line">| ID                                   | Name | MAC Address       | Fixed IP Addresses                     | Status |</span><br><span class="line">+--------------------------------------+------+-------------------+----------------------------------------+--------+</span><br><span class="line">| 0e54bc09-29d2-4774-bd71-413739b7bffe |      | fa:16:3e:0c:8a:66 | ip_address=<span class="string">'146.11.41.233'</span>, subnet_id= | ACTIVE |</span><br><span class="line">|                                      |      |                   | <span class="string">'9b118521-59b5-40ee-a439-9d59c3b392ea'</span> |        |</span><br><span class="line">| 2aa35c9c-2b50-40cd-8971-2056fb4cf04d |      | fa:16:3e:bb:c6:13 | ip_address=<span class="string">'146.11.41.232'</span>, subnet_id= | ACTIVE |</span><br><span class="line">|                                      |      |                   | <span class="string">'9b118521-59b5-40ee-a439-9d59c3b392ea'</span> |        |</span><br><span class="line">+--------------------------------------+------+-------------------+----------------------------------------+--------+</span><br></pre></td></tr></table></figure>



<h2 id="Horizon-dashboard"><a href="#Horizon-dashboard" class="headerlink" title="Horizon dashboard"></a>Horizon dashboard</h2><p>The Dashboard (horizon) is a web interface that enables cloud administrators and users to manage various OpenStack resources and services.</p>
<p>This example deployment uses an Apache web server.</p>
<blockquote>
<p>it’s actually a Django based openstack client front-end</p>
</blockquote>
<h3 id="Install-and-configure-2"><a href="#Install-and-configure-2" class="headerlink" title="Install and configure"></a>Install and configure</h3><p>Install the packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt install openstack-dashboard</span></span><br><span class="line"></span><br><span class="line">​```bash</span><br><span class="line"></span><br><span class="line">1. Edit the `/etc/openstack-dashboard/local_settings.py` file and complete the following actions:</span><br><span class="line"></span><br><span class="line">   - Configure the dashboard to use OpenStack services on the `controller` node:</span><br><span class="line"></span><br><span class="line">​```bash</span><br><span class="line">     OPENSTACK_HOST = <span class="string">"controller"</span></span><br><span class="line"></span><br><span class="line">​```bash</span><br><span class="line"></span><br><span class="line">-    In the Dashboard configuration section, allow your hosts to access Dashboard:</span><br><span class="line"></span><br><span class="line">     ```bash</span><br><span class="line">     ALLOWED_HOSTS = [<span class="string">'*'</span>]</span><br></pre></td></tr></table></figure>

<pre><code>- Do not edit the `ALLOWED_HOSTS` parameter under the Ubuntu configuration section.
- `ALLOWED_HOSTS` can also be `[&apos;*&apos;]` to accept all hosts. This may be useful for development work, but is potentially insecure and should not be used in production. See the [Django documentation](https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts) for further information.</code></pre><ul>
<li><p>Configure the <code>memcached</code> session storage service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.cache'</span></span><br><span class="line"> </span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">         <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">         <span class="string">'LOCATION'</span>: <span class="string">'controller:11211'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>​</code></pre></li>
</ul>
<pre><code>​

Comment out any other session storage configuration.</code></pre><ul>
<li><p>Enable the Identity API version 3:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_KEYSTONE_URL = <span class="string">"http://%s:5000/v3"</span> % OPENSTACK_HOST</span><br></pre></td></tr></table></figure>
</li>
<li><p>Enable support for domains:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line">​</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Configure API versions:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    <span class="string">"identity"</span>: 3,</span><br><span class="line">    <span class="string">"image"</span>: 2,</span><br><span class="line">    <span class="string">"volume"</span>: 2,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Configure <code>Default</code> as the default domain for users that you create via the dashboard:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="string">"Default"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Configure <code>user</code> as the default role for users that you create via the dashboard:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="string">"user"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>If you chose networking option 1, disable support for layer-3 networking services:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_NEUTRON_NETWORK = &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'enable_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_quotas'</span>: False,</span><br><span class="line">    <span class="string">'enable_ipv6'</span>: False,</span><br><span class="line">    <span class="string">'enable_distributed_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_ha_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_lb'</span>: False,</span><br><span class="line">    <span class="string">'enable_firewall'</span>: False,</span><br><span class="line">    <span class="string">'enable_vpn'</span>: False,</span><br><span class="line">    <span class="string">'enable_fip_topology_check'</span>: False,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Optionally, configure the time zone:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TIME_ZONE = <span class="string">"&lt;TIME_ZONE&gt;"</span></span><br></pre></td></tr></table></figure>

<p>Replace <code>TIME_ZONE</code> with an appropriate time zone identifier. For more information, see the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" rel="noopener">list of time zones</a>.</p>
</li>
</ul>
</li>
</ul>
<h3 id="Finalize-installation-8"><a href="#Finalize-installation-8" class="headerlink" title="Finalize installation"></a>Finalize installation</h3><ul>
<li><p>Reload the web server configuration:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service apache2 reloadetc</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Verify-operation-6"><a href="#Verify-operation-6" class="headerlink" title="Verify operation"></a>Verify operation</h3><p>Verify operation of the dashboard.</p>
<p>Access the dashboard using a web browser at <code>http://controller/horizon</code>.</p>
<p>Authenticate using <code>admin</code> or <code>demo</code> user and <code>default</code> domain credentials.</p>
<blockquote>
<p>Monitoring the how process by <code>tail -f /var/log/apache2/*.log</code></p>
</blockquote>
<h2 id="ISSUE-Horizon-500-internal-error"><a href="#ISSUE-Horizon-500-internal-error" class="headerlink" title="[ISSUE] Horizon 500 internal error"></a>[ISSUE] Horizon <code>500</code> internal error</h2><h3 id="Fault-reproduce-in-cli"><a href="#Fault-reproduce-in-cli" class="headerlink" title="Fault reproduce in cli"></a>Fault reproduce in cli</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl http://10.20.0.10/horizon</span></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//IETF//DTD HTML 2.0//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;&lt;head&gt;</span><br><span class="line">&lt;title&gt;500 Internal Server Error&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Internal Server Error&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;The server encountered an internal error or</span><br><span class="line">misconfiguration and was unable to complete</span><br><span class="line">your request.&lt;/p&gt;</span><br><span class="line">&lt;p&gt;Please contact the server administrator at</span><br><span class="line"> webmaster@localhost to inform them of the time this error occurred,</span><br><span class="line"> and the actions you performed just before this error.&lt;/p&gt;</span><br><span class="line">&lt;p&gt;More information about this error may be available</span><br><span class="line"><span class="keyword">in</span> the server error <span class="built_in">log</span>.&lt;/p&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;address&gt;Apache/2.4.18 (Ubuntu) Server at 10.20.0.10 Port 80&lt;/address&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>It’s apache2 based web service, error could be fond in <code>/var/log/apache2/error.log</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[Fri Aug 25 16:22:13.681394 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248] mod_wsgi (pid=9401): Target WSGI script <span class="string">'/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi'</span> cannot be loaded as Python module.</span><br><span class="line">[Fri Aug 25 16:22:13.681453 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248] mod_wsgi (pid=9401): Exception occurred processing WSGI script <span class="string">'/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi'</span>.</span><br><span class="line">[Fri Aug 25 16:22:13.681498 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248] Traceback (most recent call last):</span><br><span class="line">[Fri Aug 25 16:22:13.681531 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi"</span>, line 16, <span class="keyword">in</span> &lt;module&gt;[Fri Aug 25 16:22:13.681621 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     application = get_wsgi_application()</span><br><span class="line">[Fri Aug 25 16:22:13.681635 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/lib/python2.7/dist-packages/django/core/wsgi.py"</span>, line 14, <span class="keyword">in</span> get_wsgi_application</span><br><span class="line">[Fri Aug 25 16:22:13.681672 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     django.setup()</span><br><span class="line">[Fri Aug 25 16:22:13.681682 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/lib/python2.7/dist-packages/django/__init__.py"</span>, line 17, <span class="keyword">in</span> setup</span><br><span class="line">[Fri Aug 25 16:22:13.681713 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)</span><br><span class="line">[Fri Aug 25 16:22:13.681726 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/lib/python2.7/dist-packages/django/conf/__init__.py"</span>, line 48, <span class="keyword">in</span> __getattr__</span><br><span class="line">[Fri Aug 25 16:22:13.681806 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     self._setup(name)</span><br><span class="line">[Fri Aug 25 16:22:13.681886 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/lib/python2.7/dist-packages/django/conf/__init__.py"</span>, line 44, <span class="keyword">in</span> _setup</span><br><span class="line">[Fri Aug 25 16:22:13.681909 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     self._wrapped = Settings(settings_module)</span><br><span class="line">[Fri Aug 25 16:22:13.681916 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/lib/python2.7/dist-packages/django/conf/__init__.py"</span>, line 92, <span class="keyword">in</span> __init__</span><br><span class="line">[Fri Aug 25 16:22:13.681927 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     mod = importlib.import_module(self.SETTINGS_MODULE)</span><br><span class="line">[Fri Aug 25 16:22:13.681934 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/lib/python2.7/importlib/__init__.py"</span>, line 37, <span class="keyword">in</span> import_module</span><br><span class="line">[Fri Aug 25 16:22:13.681974 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     __import__(name)</span><br><span class="line">[Fri Aug 25 16:22:13.681984 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/share/openstack-dashboard/openstack_dashboard/settings.py"</span>, line 335, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">[Fri Aug 25 16:22:13.682112 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     from local.local_settings import *  <span class="comment"># noqa</span></span><br><span class="line">[Fri Aug 25 16:22:13.682123 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/share/openstack-dashboard/openstack_dashboard/local/local_settings.py"</span>, line 131, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">[Fri Aug 25 16:22:13.682586 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     SECRET_KEY = secret_key.generate_or_read_from_file(<span class="string">'/var/lib/openstack-dashboard/secret_key'</span>) [Fri Aug 25 16:22:13.682611 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/share/openstack-dashboard/horizon/utils/secret_key.py"</span>, line 70, <span class="keyword">in</span> generate_or_read_from_file</span><br><span class="line">[Fri Aug 25 16:22:13.682688 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     key = read_from_file(key_file)</span><br><span class="line">[Fri Aug 25 16:22:13.682699 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File <span class="string">"/usr/share/openstack-dashboard/horizon/utils/secret_key.py"</span>, line 52, <span class="keyword">in</span> read_from_file</span><br><span class="line">[Fri Aug 25 16:22:13.682714 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     with open(key_file, <span class="string">'r'</span>) as f:</span><br><span class="line">[Fri Aug 25 16:22:13.682746 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248] IOError: [Errno 13] Permission denied: <span class="string">'/var/lib/openstack-dashboard/secret_key'</span></span><br></pre></td></tr></table></figure>

<p>beautify it as below</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mod_wsgi (pid=9401): Target WSGI script <span class="string">'/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi'</span> cannot be loaded as Python module.</span><br><span class="line">mod_wsgi (pid=9401): Exception occurred processing WSGI script <span class="string">'/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi'</span>.</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi"</span>, line 16, <span class="keyword">in</span> &lt;module&gt;[Fri Aug 25 16:22:13.681621 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote      application = get_wsgi_application()</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/django/core/wsgi.py"</span>, line 14, <span class="keyword">in</span> get_wsgi_application</span><br><span class="line">    django.setup()</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/django/__init__.py"</span>, line 17, <span class="keyword">in</span> setup</span><br><span class="line">    configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/django/conf/__init__.py"</span>, line 48, <span class="keyword">in</span> __getattr__</span><br><span class="line">    self._setup(name)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/django/conf/__init__.py"</span>, line 44, <span class="keyword">in</span> _setup</span><br><span class="line">    self._wrapped = Settings(settings_module)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/dist-packages/django/conf/__init__.py"</span>, line 92, <span class="keyword">in</span> __init__</span><br><span class="line">    mod = importlib.import_module(self.SETTINGS_MODULE)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/importlib/__init__.py"</span>, line 37, <span class="keyword">in</span> import_module</span><br><span class="line">    __import__(name)</span><br><span class="line">  File <span class="string">"/usr/share/openstack-dashboard/openstack_dashboard/settings.py"</span>, line 335, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from local.local_settings import *  <span class="comment"># noqa</span></span><br><span class="line">  File <span class="string">"/usr/share/openstack-dashboard/openstack_dashboard/local/local_settings.py"</span>, line 131, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    SECRET_KEY = secret_key.generate_or_read_from_file(<span class="string">'/var/lib/openstack-dashboard/secret_key'</span>) [Fri Aug 25 16:22:13.682611 2017] [wsgi:error] [pid 9401:tid    File <span class="string">"/usr/share/openstack-dashboard/horizon/utils/secret_key.py"</span>, line 70, <span class="keyword">in</span> generate_or_read_from_file</span><br><span class="line">    key = read_from_file(key_file)</span><br><span class="line">  File <span class="string">"/usr/share/openstack-dashboard/horizon/utils/secret_key.py"</span>, line 52, <span class="keyword">in</span> read_from_file</span><br><span class="line">    with open(key_file, <span class="string">'r'</span>) as f:</span><br><span class="line">IOError: [Errno 13] Permission denied: <span class="string">'/var/lib/openstack-dashboard/secret_key'</span></span><br></pre></td></tr></table></figure>

<p>The log shows that the file cannot be accessed by horizon. Check its ownership and permission</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># ll /var/lib/openstack-dashboard/secret_key</span></span><br><span class="line">-rw------- 1 root root 64 Aug 25 15:49 /var/lib/openstack-dashboard/secret_key</span><br></pre></td></tr></table></figure>

<p>try chown to <code>horizon:horizon</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown -R horizon:horizon /var/lib/openstack-dashboard/secret_key</span></span><br><span class="line"><span class="comment"># ll /var/lib/openstack-dashboard/secret_key</span></span><br><span class="line">-rw------- 1 horizon:horizon 64 Aug 25 15:49 /var/lib/openstack-dashboard/secret_key</span><br><span class="line"><span class="comment"># service apache2 reload</span></span><br></pre></td></tr></table></figure>

<p>retry with <code>curl</code>, still got <code>500</code>,and with same error on apache error log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl http://10.20.0.10/horizon</span></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//IETF//DTD HTML 2.0//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;&lt;head&gt;</span><br><span class="line">&lt;title&gt;500 Internal Server Error&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Internal Server Error&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;The server encountered an internal error or</span><br><span class="line">misconfiguration and was unable to complete</span><br><span class="line">your request.&lt;/p&gt;</span><br><span class="line">&lt;p&gt;Please contact the server administrator at</span><br><span class="line"> webmaster@localhost to inform them of the time this error occurred,</span><br><span class="line"> and the actions you performed just before this error.&lt;/p&gt;</span><br><span class="line">&lt;p&gt;More information about this error may be available</span><br><span class="line"><span class="keyword">in</span> the server error <span class="built_in">log</span>.&lt;/p&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;address&gt;Apache/2.4.18 (Ubuntu) Server at 10.20.0.10 Port 80&lt;/address&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>We should identify the process owner and change to it accordingly.</p>
<p>By checking horizon wsgi process it’s found the user is www-data (the one for apache2 ):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># ps -aux | grep horizon</span></span><br><span class="line">www-data 10299  0.0  0.2 251032  8292 ?        Sl   16:26   0:00 (wsgi:horizon)    -k start</span><br><span class="line">www-data 10300  0.0  0.2 251024  8292 ?        Sl   16:26   0:00 (wsgi:horizon)    -k start</span><br><span class="line">www-data 10301  0.3  4.1 550344 169144 ?       Sl   16:26   0:02 (wsgi:horizon)    -k start</span><br></pre></td></tr></table></figure>

<h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><p>Change owner to <code>www-data</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown www-data /var/lib/openstack-dashboard/secret_key</span></span><br><span class="line"><span class="comment"># service apache2 reload</span></span><br></pre></td></tr></table></figure>

<p>Retry with <code>curl http://10.20.0.10/horizon</code> no error came out :-).</p>
<h2 id="Enable-RabbitMQ-web-admin-for-studying"><a href="#Enable-RabbitMQ-web-admin-for-studying" class="headerlink" title="Enable RabbitMQ web admin for studying"></a>Enable RabbitMQ web admin for studying</h2><blockquote>
<p> ref: <a href="https://www.rabbitmq.com/management.html" target="_blank" rel="noopener">https://www.rabbitmq.com/management.html</a></p>
</blockquote>
<p>Enable the plugins for this feature:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># netstat -plunt | grep 15672</span></span><br><span class="line"></span><br><span class="line">root@controller:~<span class="comment"># rabbitmq-plugins enable rabbitmq_management</span></span><br><span class="line">The following plugins have been enabled:</span><br><span class="line">  mochiweb</span><br><span class="line">  webmachine</span><br><span class="line">  rabbitmq_web_dispatch</span><br><span class="line">  amqp_client</span><br><span class="line">  rabbitmq_management_agent</span><br><span class="line">  rabbitmq_management</span><br><span class="line">  </span><br><span class="line">root@controller:~<span class="comment"># netstat -plunt | grep 15672</span></span><br><span class="line">tcp        0      0 0.0.0.0:15672           0.0.0.0:*               LISTEN      1927/beam</span><br></pre></td></tr></table></figure>

<p>Browse from web browser with URL: <code>http://controller:15672/</code>with:</p>
<ul>
<li>user: openstack</li>
<li>password: RABBIT_PASS</li>
</ul>
<p>Got failure Login failed, check logs</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># less /var/log/rabbitmq/rabbit@controller.log</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">=WARNING REPORT==== 26-Aug-2017::22:34:05 ===</span><br><span class="line">HTTP access denied: user <span class="string">'openstack'</span> - Not management user</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Add new user ad admin grants:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user admin admin</span><br><span class="line">rabbitmqctl set_user_tags admin administrator</span><br><span class="line">rabbitmqctl set_permissions -p / admin <span class="string">".*"</span> <span class="string">".*"</span> <span class="string">".*"</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Accessed !</p>
</blockquote>
<h2 id="Neutron-reconfigure-as-Linux-bridge-with-vlan"><a href="#Neutron-reconfigure-as-Linux-bridge-with-vlan" class="headerlink" title="Neutron reconfigure as Linux bridge with vlan"></a>Neutron reconfigure as Linux bridge with vlan</h2><blockquote>
<p> ref: <a href="https://docs.openstack.org/kilo/networking-guide/deploy_scenario4b.html" target="_blank" rel="noopener">https://docs.openstack.org/kilo/networking-guide/deploy_scenario4b.html</a></p>
</blockquote>
<h3 id="Controller-configuration"><a href="#Controller-configuration" class="headerlink" title="Controller configuration"></a>Controller configuration</h3><ol>
<li><p>Configure the kernel to disable reverse path filtering. Edit the <code>/etc/sysctl.conf</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.conf.default.rp_filter=0</span><br><span class="line">net.ipv4.conf.all.rp_filter=0</span><br></pre></td></tr></table></figure>
</li>
<li><p>Load the new kernel configuration:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl -p</span><br></pre></td></tr></table></figure>
</li>
<li><p>Configure the ML2 plug-in and Linux bridge agent. Edit the <code>/etc/neutron/plugins/ml2/.ini</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan</span><br><span class="line">tenant_network_types =</span><br><span class="line">mechanism_drivers = linuxbridge</span><br><span class="line"></span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = ecn,provider</span><br><span class="line"></span><br><span class="line">[ml2_type_vlan]</span><br><span class="line">network_vlan_ranges = provider:100:200</span><br></pre></td></tr></table></figure>
</li>
<li><p>Edit the<code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = ecn:enp0s10,provider:enp0s8</span><br><span class="line"></span><br><span class="line">[securitygroup]</span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line">enable_security_group = True</span><br><span class="line">enable_ipset = True</span><br></pre></td></tr></table></figure>
</li>
<li><p>Restart the Networking services.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service neutron-server restart</span></span><br><span class="line"><span class="comment"># service neutron-linuxbridge-agent restart</span></span><br><span class="line"><span class="comment"># service neutron-dhcp-agent restart</span></span><br><span class="line"><span class="comment"># service neutron-metadata-agent restart</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Compute-node-configuration"><a href="#Compute-node-configuration" class="headerlink" title="Compute node configuration"></a>Compute node configuration</h3><ol>
<li><p>Configure the kernel to disable reverse path filtering. Edit the <code>/etc/sysctl.conf</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.conf.default.rp_filter=0</span><br><span class="line">net.ipv4.conf.all.rp_filter=0</span><br></pre></td></tr></table></figure>
</li>
<li><p>Load the new kernel configuration:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl -p</span><br></pre></td></tr></table></figure>
</li>
<li><p>Configure the Linux bridge agent. Edit the <code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = ecn:enp0s10,provider:enp0s8</span><br><span class="line"></span><br><span class="line">[securitygroup]</span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line">enable_security_group = True</span><br><span class="line">enable_ipset = True</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h3 id="Verify-operation-7"><a href="#Verify-operation-7" class="headerlink" title="Verify operation"></a>Verify operation</h3><ol>
<li><p>Source the administrative project credentials.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. admin-openrc</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>Verify presence and operation of the agents:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># neutron agent-list</span></span><br><span class="line">neutron CLI is deprecated and will be removed <span class="keyword">in</span> the future. Use openstack CLI instead.</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</span><br><span class="line">| id                                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                    |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</span><br><span class="line">| 143d7731-9227-4baf-9052-292d7aea6992 | Linux bridge agent | compute    |                   | :-)   | True           | neutron-linuxbridge-agent |</span><br><span class="line">| 1d661145-0941-411d-9b18-b3371fe57c4b | Linux bridge agent | controller |                   | :-)   | True           | neutron-linuxbridge-agent |</span><br><span class="line">| 7502e1a3-998d-4aca-91e4-ca17e1b10c82 | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent        |</span><br><span class="line">| 7c47ac70-5de2-4442-8fc1-91fe97ae120f | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent    |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack network agent list</span></span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">| ID                                   | Agent Type         | Host       | Availability Zone | Alive | State | Binary                    |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">| 143d7731-9227-4baf-9052-292d7aea6992 | Linux bridge agent | compute    | None              | True  | UP    | neutron-linuxbridge-agent |</span><br><span class="line">| 1d661145-0941-411d-9b18-b3371fe57c4b | Linux bridge agent | controller | None              | True  | UP    | neutron-linuxbridge-agent |</span><br><span class="line">| 7502e1a3-998d-4aca-91e4-ca17e1b10c82 | DHCP agent         | controller | nova              | True  | UP    | neutron-dhcp-agent        |</span><br><span class="line">| 7c47ac70-5de2-4442-8fc1-91fe97ae120f | Metadata agent     | controller | None              | True  | UP    | neutron-metadata-agent    |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Create-initial-networks"><a href="#Create-initial-networks" class="headerlink" title="Create initial networks"></a>Create initial networks</h3><p>This example creates a VLAN provider network. Change the VLAN ID and IP address range to values suitable for your environment.</p>
<ol>
<li><p>Source the administrative project credentials.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. demo-openrc</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>Create a provider network:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack network create  --share --external   --provider-physical-network provider --provider-network-type vlan --provider-segment 101 provider-vlan-101</span></span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | UP                                   |</span><br><span class="line">| availability_zone_hints   |                                      |</span><br><span class="line">| availability_zones        |                                      |</span><br><span class="line">| created_at                | 2017-08-28T03:25:26Z                 |</span><br><span class="line">| description               |                                      |</span><br><span class="line">| dns_domain                | None                                 |</span><br><span class="line">| id                        | 152a4a85-dc52-4c62-9bbd-742eb4f7b8fa |</span><br><span class="line">| ipv4_address_scope        | None                                 |</span><br><span class="line">| ipv6_address_scope        | None                                 |</span><br><span class="line">| is_default                | None                                 |</span><br><span class="line">| mtu                       | 1500                                 |</span><br><span class="line">| name                      | provider-vlan-101                    |</span><br><span class="line">| port_security_enabled     | True                                 |</span><br><span class="line">| project_id                | 78c9c849237649a3a8c4526167427589     |</span><br><span class="line">| provider:network_type     | vlan                                 |</span><br><span class="line">| provider:physical_network | provider                             |</span><br><span class="line">| provider:segmentation_id  | 101                                  |</span><br><span class="line">| qos_policy_id             | None                                 |</span><br><span class="line">| revision_number           | 4                                    |</span><br><span class="line">| router:external           | External                             |</span><br><span class="line">| segments                  | None                                 |</span><br><span class="line">| shared                    | True                                 |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| updated_at                | 2017-08-28T03:25:26Z                 |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line">// or neutron cli</span><br><span class="line"></span><br><span class="line">$ neutron net-create provider-101 --shared  --external\</span><br><span class="line">  --provider:physical_network provider --provider:network_type vlan \</span><br><span class="line">  --provider:segmentation_id 101</span><br><span class="line">Created a new network:</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | True                                 |</span><br><span class="line">| id                        | 572a3fc9-ad1f-4e54-a63a-4bf5047c1a4a |</span><br><span class="line">| name                      | provider-101                         |</span><br><span class="line">| provider:network_type     | vlan                                 |</span><br><span class="line">| provider:physical_network | provider                             |</span><br><span class="line">| provider:segmentation_id  | 101                                  |</span><br><span class="line">| router:external           | True                                |</span><br><span class="line">| shared                    | True                                 |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| tenant_id                 | e0bddbc9210d409795887175341b7098     |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p> Note: The <code>shared</code> option allows any project to use this network.</p>
</blockquote>
</li>
<li><p>Create a subnet on the provider network:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack subnet create --network provider-vlan-101 --allocation-pool start=172.16.0.100,end=172.16.0.200  --gateway 172.16.0.1   --subnet-range 172.16.0.0/24 provider-vlan-101</span></span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field             | Value                                |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| allocation_pools  | 172.16.0.100-172.16.0.200            |</span><br><span class="line">| cidr              | 172.16.0.0/24                        |</span><br><span class="line">| created_at        | 2017-08-28T03:32:06Z                 |</span><br><span class="line">| description       |                                      |</span><br><span class="line">| dns_nameservers   |                                      |</span><br><span class="line">| enable_dhcp       | True                                 |</span><br><span class="line">| gateway_ip        | 172.16.0.1                           |</span><br><span class="line">| host_routes       |                                      |</span><br><span class="line">| id                | 61693a58-a984-4f7b-9097-dd5e489a88bd |</span><br><span class="line">| ip_version        | 4                                    |</span><br><span class="line">| ipv6_address_mode | None                                 |</span><br><span class="line">| ipv6_ra_mode      | None                                 |</span><br><span class="line">| name              | provider-vlan-101                    |</span><br><span class="line">| network_id        | 2a33434f-ba29-4645-9b5d-24f1509066f1 |</span><br><span class="line">| project_id        | 78c9c849237649a3a8c4526167427589     |</span><br><span class="line">| revision_number   | 2                                    |</span><br><span class="line">| segment_id        | None                                 |</span><br><span class="line">| service_types     |                                      |</span><br><span class="line">| subnetpool_id     | None                                 |</span><br><span class="line">| updated_at        | 2017-08-28T03:32:06Z                 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line">// or via neutron cli</span><br><span class="line">$ neutron subnet-create provider-vlan-101 172.16.0.0/24  \</span><br><span class="line">  --name provider-101-subnet --gateway 172.16.0.1</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Verify-network-operation"><a href="#Verify-network-operation" class="headerlink" title="Verify network operation"></a>Verify network operation</h3><ol>
<li><p>On the controller node, verify creation of the <code>qdhcp</code> namespace:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ip netns</span><br><span class="line">qdhcp-8b868082-e312-4110-8627-298109d4401c</span><br></pre></td></tr></table></figure>

<p>Note: The <code>qdhcp</code> namespace might not exist until launching an instance.</p>
</li>
<li><p>Source the regular project credentials. The following steps use the <code>demo</code> project.</p>
</li>
<li><p>Create the appropriate security group rules to allow ping and SSH access to the instance. </p>
<blockquote>
<p>for OSC command referring to above chapters below is command for nova cli</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">root@controller:~<span class="comment"># openstack network list</span></span><br><span class="line">+--------------------------------------+-------------------+--------------------------------------+</span><br><span class="line">| ID                                   | Name              | Subnets                              |</span><br><span class="line">+--------------------------------------+-------------------+--------------------------------------+</span><br><span class="line">| 152a4a85-dc52-4c62-9bbd-742eb4f7b8fa | provider-vlan-101 | 91d305ac-762a-4062-b1da-8a55d7ebd735 |</span><br><span class="line">+--------------------------------------+-------------------+--------------------------------------+</span><br><span class="line">root@controller:~<span class="comment"># openstack server create --flavor m1.nano --image cirros   --nic net-id=152a4a85-dc52-4c62-9bbd-742eb4f7b8fa --security-group default provider-vlan-instance</span></span><br><span class="line">+-------------------------------------+-----------------------------------------------+</span><br><span class="line">| Field                               | Value                                         |</span><br><span class="line">+-------------------------------------+-----------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig                   | MANUAL                                        |</span><br><span class="line">| OS-EXT-AZ:availability_zone         |                                               |</span><br><span class="line">| OS-EXT-SRV-ATTR:host                | None                                          |</span><br><span class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | None                                          |</span><br><span class="line">| OS-EXT-SRV-ATTR:instance_name       |                                               |</span><br><span class="line">| OS-EXT-STS:power_state              | NOSTATE                                       |</span><br><span class="line">| OS-EXT-STS:task_state               | scheduling                                    |</span><br><span class="line">| OS-EXT-STS:vm_state                 | building                                      |</span><br><span class="line">| OS-SRV-USG:launched_at              | None                                          |</span><br><span class="line">| OS-SRV-USG:terminated_at            | None                                          |</span><br><span class="line">| accessIPv4                          |                                               |</span><br><span class="line">| accessIPv6                          |                                               |</span><br><span class="line">| addresses                           |                                               |</span><br><span class="line">| adminPass                           | e9YKhRWy7XmN                                  |</span><br><span class="line">| config_drive                        |                                               |</span><br><span class="line">| created                             | 2017-08-28T03:44:10Z                          |</span><br><span class="line">| flavor                              | m1.nano (0)                                   |</span><br><span class="line">| hostId                              |                                               |</span><br><span class="line">| id                                  | 2b78d9ee-3476-4e6b-9c4e-09ad2b7f115e          |</span><br><span class="line">| image                               | cirros (c17e391e-93e1-4480-9cf3-bf8623063e61) |</span><br><span class="line">| key_name                            | None                                          |</span><br><span class="line">| name                                | provider-vlan-instance                        |</span><br><span class="line">| progress                            | 0                                             |</span><br><span class="line">| project_id                          | 78c9c849237649a3a8c4526167427589              |</span><br><span class="line">| properties                          |                                               |</span><br><span class="line">| security_groups                     | name=<span class="string">'default'</span>                                |</span><br><span class="line">| status                              | BUILD                                         |</span><br><span class="line">| updated                             | 2017-08-28T03:44:10Z                          |</span><br><span class="line">| user_id                             | d8efd16c30904a7992010abe4bdb9a2b              |</span><br><span class="line">| volumes_attached                    |                                               |</span><br><span class="line">+-------------------------------------+-----------------------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Launch an instance with an interface on the provider network.</p>
<p>Note</p>
<p>This example uses a CirrOS image that was manually uploaded into the Image Service</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ nova boot --flavor m1.tiny --image cirros-0.3.3-x86_64-disk test_server</span><br><span class="line">+--------------------------------------+-----------------------------------------------------------------+</span><br><span class="line">| Property                             | Value                                                           |</span><br><span class="line">+--------------------------------------+-----------------------------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig                    | MANUAL                                                          |</span><br><span class="line">| OS-EXT-AZ:availability_zone          | nova                                                            |</span><br><span class="line">| OS-EXT-SRV-ATTR:host                 | -                                                               |</span><br><span class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                               |</span><br><span class="line">| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                               |</span><br><span class="line">| OS-EXT-STS:power_state               | 0                                                               |</span><br><span class="line">| OS-EXT-STS:task_state                | scheduling                                                      |</span><br><span class="line">| OS-EXT-STS:vm_state                  | building                                                        |</span><br><span class="line">| OS-SRV-USG:launched_at               | -                                                               |</span><br><span class="line">| OS-SRV-USG:terminated_at             | -                                                               |</span><br><span class="line">| accessIPv4                           |                                                                 |</span><br><span class="line">| accessIPv6                           |                                                                 |</span><br><span class="line">| adminPass                            | h7CkMdkRXuuh                                                    |</span><br><span class="line">| config_drive                         |                                                                 |</span><br><span class="line">| created                              | 2015-07-22T20:40:16Z                                            |</span><br><span class="line">| flavor                               | m1.tiny (1)                                                     |</span><br><span class="line">| hostId                               |                                                                 |</span><br><span class="line">| id                                   | dee2a9f4-e24c-444d-8c94-386f11f74af5                            |</span><br><span class="line">| image                                | cirros-0.3.3-x86_64-disk (2b6bb38f-f69f-493c-a1c0-264dfd4188d8) |</span><br><span class="line">| key_name                             | -                                                               |</span><br><span class="line">| metadata                             | &#123;&#125;                                                              |</span><br><span class="line">| name                                 | test_server                                                     |</span><br><span class="line">| os-extended-volumes:volumes_attached | []                                                              |</span><br><span class="line">| progress                             | 0                                                               |</span><br><span class="line">| security_groups                      | default                                                         |</span><br><span class="line">| status                               | BUILD                                                           |</span><br><span class="line">| tenant_id                            | 5f2db133e98e4bc2999ac2850ce2acd1                                |</span><br><span class="line">| updated                              | 2015-07-22T20:40:16Z                                            |</span><br><span class="line">| user_id                              | ea417ebfa86741af86f84a5dbcc97cd2                                |</span><br><span class="line">+--------------------------------------+-----------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Determine the IP address of the instance. The following step uses 203.0.113.3.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ nova list</span><br><span class="line">+--------------------------------------+-------------+--------+------------+-------------+--------------------------+</span><br><span class="line">| ID                                   | Name        | Status | Task State | Power State | Networks                 |</span><br><span class="line">+--------------------------------------+-------------+--------+------------+-------------+--------------------------+</span><br><span class="line">| dee2a9f4-e24c-444d-8c94-386f11f74af5 | test_server | ACTIVE | -          | Running     | provider-101=203.0.113.3 |</span><br><span class="line">+--------------------------------------+-------------+--------+------------+-------------+--------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>On the controller node or any host with access to the provider network, ping the IP address of the instance:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ping -c 4 203.0.113.3</span><br><span class="line">PING 203.0.113.3 (203.0.113.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 203.0.113.3: icmp_req=1 ttl=63 time=3.18 ms</span><br><span class="line">64 bytes from 203.0.113.3: icmp_req=2 ttl=63 time=0.981 ms</span><br><span class="line">64 bytes from 203.0.113.3: icmp_req=3 ttl=63 time=1.06 ms</span><br><span class="line">64 bytes from 203.0.113.3: icmp_req=4 ttl=63 time=0.929 ms</span><br><span class="line"></span><br><span class="line">--- 203.0.113.3 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3002ms</span><br><span class="line">rtt min/avg/max/mdev = 0.929/1.539/3.183/0.951 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>Obtain access to the instance.</p>
</li>
<li><p>Test connectivity to the Internet:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ping -c 4 openstack.org</span><br><span class="line">PING openstack.org (174.143.194.225) 56(84) bytes of data.</span><br><span class="line">64 bytes from 174.143.194.225: icmp_req=1 ttl=53 time=17.4 ms</span><br><span class="line">64 bytes from 174.143.194.225: icmp_req=2 ttl=53 time=17.5 ms</span><br><span class="line">64 bytes from 174.143.194.225: icmp_req=3 ttl=53 time=17.7 ms</span><br><span class="line">64 bytes from 174.143.194.225: icmp_req=4 ttl=53 time=17.5 ms</span><br><span class="line"></span><br><span class="line">--- openstack.org ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3003ms</span><br><span class="line">rtt min/avg/max/mdev = 17.431/17.575/17.734/0.143 ms</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="ISSUE-Troubleshooting-vlan-dhcp"><a href="#ISSUE-Troubleshooting-vlan-dhcp" class="headerlink" title="[ISSUE] Troubleshooting vlan dhcp"></a>[ISSUE] Troubleshooting vlan dhcp</h2><p>   console to vm, it’s blocked on dhcp discover, after dhcp failure, metadata network is not ok as well…</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@compute:~<span class="comment"># virsh console 1</span></span><br><span class="line">Connected to domain instance-00000008</span><br><span class="line">Escape character is ^]</span><br><span class="line"></span><br><span class="line">Sending discover...</span><br><span class="line">Usage: /sbin/cirros-dhcpc &lt;up|down&gt;</span><br><span class="line">No lease, failing</span><br><span class="line">WARN: /etc/rc3.d/S40-network failed</span><br><span class="line">cirros-ds <span class="string">'net'</span> up at 187.22</span><br><span class="line">checking http://169.254.169.254/2009-04-04/instance-id</span><br><span class="line">failed 1/20: up 187.48. request failed</span><br><span class="line">failed 2/20: up 189.90. request failed</span><br><span class="line">failed 3/20: up 192.04. request failed</span><br><span class="line">failed 4/20: up 194.30. request failed</span><br><span class="line">failed 5/20: up 196.44. request failed</span><br><span class="line">failed 6/20: up 198.55. request failed</span><br><span class="line">failed 7/20: up 200.80. request failed</span><br><span class="line">failed 8/20: up 202.97. request failed</span><br><span class="line">failed 9/20: up 205.13. request failed</span><br><span class="line">failed 10/20: up 207.37. request failed</span><br><span class="line">failed 11/20: up 209.54. request failed</span><br><span class="line">failed 12/20: up 211.67. request failed</span><br><span class="line">failed 13/20: up 213.91. request failed</span><br><span class="line">failed 14/20: up 216.05. request failed</span><br><span class="line">failed 15/20: up 218.21. request failed</span><br><span class="line">failed 16/20: up 220.49. request failed</span><br><span class="line">failed 17/20: up 222.61. request failed</span><br><span class="line">failed 18/20: up 224.75. request failed</span><br><span class="line">failed 19/20: up 227.00. request failed</span><br><span class="line">failed 20/20: up 229.12. request failed</span><br><span class="line">failed to <span class="built_in">read</span> iid from metadata. tried 20</span><br></pre></td></tr></table></figure>

<p>from compute nothing received after discover sent out</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@compute:~<span class="comment"># tcpdump -i  brq152a4a85-dc -vv port 67 or port 68 -e -n</span></span><br><span class="line">tcpdump: listening on brq152a4a85-dc, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">11:56:52.659297 fa:16:3e:66:84:cc &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)</span><br><span class="line">    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:66:84:cc, length 290, xid 0xd0ed70a, Flags [none] (0x0000)</span><br><span class="line">          Client-Ethernet-Address fa:16:3e:66:84:cc</span><br><span class="line">          Vendor-rfc1048 Extensions</span><br><span class="line">            Magic Cookie 0x63825363</span><br><span class="line">            DHCP-Message Option 53, length 1: Discover</span><br><span class="line">            Client-ID Option 61, length 7: ether fa:16:3e:66:84:cc</span><br><span class="line">            MSZ Option 57, length 2: 576</span><br><span class="line">            Parameter-Request Option 55, length 9:</span><br><span class="line">              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname</span><br><span class="line">              Domain-Name, MTU, BR, NTP</span><br><span class="line">              Classless-Static-Route</span><br><span class="line">            Vendor-Class Option 60, length 12: <span class="string">"udhcp 1.20.1"</span></span><br><span class="line">            Hostname Option 12, length 6: <span class="string">"cirros"</span></span><br><span class="line">11:57:52.726797 fa:16:3e:66:84:cc &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)</span><br><span class="line">    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:66:84:cc, length 290, xid 0xd0ed70a, secs 60, Flags [none] (0x0000)</span><br><span class="line">          Client-Ethernet-Address fa:16:3e:66:84:cc</span><br><span class="line">          Vendor-rfc1048 Extensions</span><br><span class="line">            Magic Cookie 0x63825363</span><br><span class="line">            DHCP-Message Option 53, length 1: Discover</span><br><span class="line">            Client-ID Option 61, length 7: ether fa:16:3e:66:84:cc</span><br><span class="line">            MSZ Option 57, length 2: 576</span><br><span class="line">            Parameter-Request Option 55, length 9:</span><br><span class="line">              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname</span><br><span class="line">              Domain-Name, MTU, BR, NTP</span><br><span class="line">              Classless-Static-Route</span><br><span class="line">            Vendor-Class Option 60, length 12: <span class="string">"udhcp 1.20.1"</span></span><br><span class="line">            Hostname Option 12, length 6: <span class="string">"cirros"</span></span><br></pre></td></tr></table></figure>

<p>While it had been sent out from dhcp agent “DHCP OFFER”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">tcpdump: listening on brq152a4a85-dc, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">11:56:52.259801 fa:16:3e:66:84:cc &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)</span><br><span class="line">    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:66:84:cc, length 290, xid 0xd0ed70a, Flags [none] (0x0000)</span><br><span class="line">          Client-Ethernet-Address fa:16:3e:66:84:cc</span><br><span class="line">          Vendor-rfc1048 Extensions</span><br><span class="line">            Magic Cookie 0x63825363</span><br><span class="line">            DHCP-Message Option 53, length 1: Discover</span><br><span class="line">            Client-ID Option 61, length 7: ether fa:16:3e:66:84:cc</span><br><span class="line">            MSZ Option 57, length 2: 576</span><br><span class="line">            Parameter-Request Option 55, length 9:</span><br><span class="line">              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname</span><br><span class="line">              Domain-Name, MTU, BR, NTP</span><br><span class="line">              Classless-Static-Route</span><br><span class="line">            Vendor-Class Option 60, length 12: <span class="string">"udhcp 1.20.1"</span></span><br><span class="line">            Hostname Option 12, length 6: <span class="string">"cirros"</span></span><br><span class="line">11:56:52.261241 fa:16:3e:56:9f:61 &gt; fa:16:3e:66:84:cc, ethertype IPv4 (0x0800), length 370: (tos 0xc0, ttl 64, id 11060, offset 0, flags [none], proto UDP (17), length 356)</span><br><span class="line">    172.16.0.100.67 &gt; 172.16.0.105.68: [udp sum ok] BOOTP/DHCP, Reply, length 328, xid 0xd0ed70a, Flags [none] (0x0000)</span><br><span class="line">          Your-IP 172.16.0.105</span><br><span class="line">          Server-IP 172.16.0.100</span><br><span class="line">          Client-Ethernet-Address fa:16:3e:66:84:cc</span><br><span class="line">          Vendor-rfc1048 Extensions</span><br><span class="line">            Magic Cookie 0x63825363</span><br><span class="line">            DHCP-Message Option 53, length 1: Offer</span><br><span class="line">            Server-ID Option 54, length 4: 172.16.0.100</span><br><span class="line">            Lease-Time Option 51, length 4: 86400</span><br><span class="line">            RN Option 58, length 4: 43200</span><br><span class="line">            RB Option 59, length 4: 75600</span><br><span class="line">            Subnet-Mask Option 1, length 4: 255.255.255.0</span><br><span class="line">            BR Option 28, length 4: 172.16.0.255</span><br><span class="line">            Domain-Name-Server Option 6, length 4: 172.16.0.100</span><br><span class="line">            Domain-Name Option 15, length 14: <span class="string">"openstacklocal"</span></span><br><span class="line">            Default-Gateway Option 3, length 4: 172.16.0.1</span><br><span class="line">            Classless-Static-Route Option 121, length 14: (169.254.169.254/32:172.16.0.100),(default:172.16.0.1)</span><br><span class="line">            MTU Option 26, length 2: 1500</span><br></pre></td></tr></table></figure>

<p>The network configured in virtualbox was not in promiscuous mode caus</p>
<p>succeeded:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">udhcpc (v1.20.1) started</span><br><span class="line">Sending discover...</span><br><span class="line">Sending discover...</span><br><span class="line">Sending select <span class="keyword">for</span> 172.16.0.105...</span><br><span class="line">Lease of 172.16.0.105 obtained, lease time 86400</span><br><span class="line">route: SIOCADDRT: File exists</span><br><span class="line">WARN: failed: route add -net <span class="string">"0.0.0.0/0"</span> gw <span class="string">"172.16.0.1"</span></span><br><span class="line">cirros-ds <span class="string">'net'</span> up at 74.67</span><br><span class="line">checking http://169.254.169.254/2009-04-04/instance-id</span><br><span class="line">successful after 1/20 tries: up 75.02. iid=i-00000009</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Wey Gu | 古思为
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://note.siwei.info/deploy-openstack-o-on-self-privisoned-virtualbox-ubuntu-vms-manually/" title="deploy Openstack O on self privisoned virtualbox Ubuntu VMs manually">https://note.siwei.info/deploy-openstack-o-on-self-privisoned-virtualbox-ubuntu-vms-manually/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/openstack/" rel="tag"># openstack</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/upgrade-hexo-theme/" rel="prev" title="upgrade hexo, theme">
      <i class="fa fa-chevron-left"></i> upgrade hexo, theme
    </a></div>
      <div class="post-nav-item">
    <a href="/openstack-basic-for-newbie/" rel="next" title="Openstack Basic for newbie">
      Openstack Basic for newbie <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Installation-Guide"><span class="nav-number">1.</span> <span class="nav-text">Installation Guide</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Host-networking"><span class="nav-number">1.1.</span> <span class="nav-text">Host networking</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#My-network-solution"><span class="nav-number">1.1.1.</span> <span class="nav-text">My network solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Base-Machine"><span class="nav-number">1.2.</span> <span class="nav-text">Base Machine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Controller-node-actions"><span class="nav-number">1.3.</span> <span class="nav-text">Controller node actions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#management-network-eth0-enp0s3"><span class="nav-number">1.3.1.</span> <span class="nav-text">management network eth0 (enp0s3)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hostname-and-hosts"><span class="nav-number">1.3.2.</span> <span class="nav-text">hostname and hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-database"><span class="nav-number">1.3.3.</span> <span class="nav-text">SQL database</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Message-queue"><span class="nav-number">1.3.4.</span> <span class="nav-text">Message queue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memcached"><span class="nav-number">1.3.5.</span> <span class="nav-text">Memcached</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Compute-node-actions"><span class="nav-number">1.4.</span> <span class="nav-text">Compute node actions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#management-network-eth0-enp0s3-1"><span class="nav-number">1.4.1.</span> <span class="nav-text">management network eth0 (enp0s3)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configure-NTP-by-editing-etc-chrony-chrony-conf"><span class="nav-number">1.4.2.</span> <span class="nav-text">configure NTP by editing &#x2F;etc&#x2F;chrony&#x2F;chrony.conf</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Keystone-installation"><span class="nav-number">1.5.</span> <span class="nav-text">Keystone installation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-Apache-HTTP-server"><span class="nav-number">1.5.1.</span> <span class="nav-text">Configure the Apache HTTP server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-the-installation"><span class="nav-number">1.5.2.</span> <span class="nav-text">Finalize the installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-a-domain-projects-users-and-roles"><span class="nav-number">1.5.3.</span> <span class="nav-text">Create a domain, projects, users, and roles</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Verify-operation"><span class="nav-number">1.5.4.</span> <span class="nav-text">Verify operation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-OpenStack-client-environment-scripts"><span class="nav-number">1.5.5.</span> <span class="nav-text">Create OpenStack client environment scripts</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-the-scripts"><span class="nav-number">1.5.5.1.</span> <span class="nav-text">Creating the scripts</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-the-scripts"><span class="nav-number">1.5.5.2.</span> <span class="nav-text">Using the scripts</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Glance-installation"><span class="nav-number">1.6.</span> <span class="nav-text">Glance installation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure"><span class="nav-number">1.6.1.</span> <span class="nav-text">Install and configure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prerequisites"><span class="nav-number">1.6.2.</span> <span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-components"><span class="nav-number">1.6.3.</span> <span class="nav-text">Install and configure components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-installation"><span class="nav-number">1.6.4.</span> <span class="nav-text">Finalize installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Verify-operation-1"><span class="nav-number">1.6.5.</span> <span class="nav-text">Verify operation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nova-installation"><span class="nav-number">1.7.</span> <span class="nav-text">Nova installation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nova-install-and-configure-controller-node"><span class="nav-number">1.8.</span> <span class="nav-text">Nova install and configure controller node</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Prerequisites-1"><span class="nav-number">1.8.1.</span> <span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-components-1"><span class="nav-number">1.8.2.</span> <span class="nav-text">Install and configure components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-installation-1"><span class="nav-number">1.8.3.</span> <span class="nav-text">Finalize installation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nova-Install-and-configure-a-compute-node"><span class="nav-number">1.9.</span> <span class="nav-text">Nova Install and configure a compute node</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-components-2"><span class="nav-number">1.9.1.</span> <span class="nav-text">Install and configure components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-installation-2"><span class="nav-number">1.9.2.</span> <span class="nav-text">Finalize installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Add-the-compute-node-to-the-cell-database"><span class="nav-number">1.9.3.</span> <span class="nav-text">Add the compute node to the cell database</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Neutron-installation"><span class="nav-number">1.10.</span> <span class="nav-text">Neutron installation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tenant-Project-network-configuration"><span class="nav-number">1.11.</span> <span class="nav-text">Tenant&#x2F;Project network configuration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Neutron-Install-and-configure-controller-node"><span class="nav-number">1.12.</span> <span class="nav-text">Neutron Install and configure controller node</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Prerequisites-2"><span class="nav-number">1.12.1.</span> <span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-networking-options"><span class="nav-number">1.12.2.</span> <span class="nav-text">Configure networking options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Networking-Option-1-Provider-networks"><span class="nav-number">1.12.3.</span> <span class="nav-text">Networking Option 1: Provider networks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-the-components"><span class="nav-number">1.12.4.</span> <span class="nav-text">Install the components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-server-component"><span class="nav-number">1.12.5.</span> <span class="nav-text">Configure the server component</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-Modular-Layer-2-ML2-plug-in"><span class="nav-number">1.12.6.</span> <span class="nav-text">Configure the Modular Layer 2 (ML2) plug-in</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-Linux-bridge-agent"><span class="nav-number">1.12.7.</span> <span class="nav-text">Configure the Linux bridge agent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-DHCP-agent"><span class="nav-number">1.12.8.</span> <span class="nav-text">Configure the DHCP agent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-metadata-agent"><span class="nav-number">1.12.9.</span> <span class="nav-text">Configure the metadata agent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-Compute-service-to-use-the-Networking-service"><span class="nav-number">1.12.10.</span> <span class="nav-text">Configure the Compute service to use the Networking service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-installation-3"><span class="nav-number">1.12.11.</span> <span class="nav-text">Finalize installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Verify-operation-2"><span class="nav-number">1.12.12.</span> <span class="nav-text">Verify operation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Neutron-Install-and-configure-compute-node"><span class="nav-number">1.13.</span> <span class="nav-text">Neutron Install and configure compute node</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-the-components-1"><span class="nav-number">1.13.1.</span> <span class="nav-text">Install the components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-common-component"><span class="nav-number">1.13.2.</span> <span class="nav-text">Configure the common component</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-networking-options-1"><span class="nav-number">1.13.3.</span> <span class="nav-text">Configure networking options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-Linux-bridge-agent-1"><span class="nav-number">1.13.4.</span> <span class="nav-text">Configure the Linux bridge agent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-the-Compute-service-to-use-the-Networking-service-1"><span class="nav-number">1.13.5.</span> <span class="nav-text">Configure the Compute service to use the Networking service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-installation-4"><span class="nav-number">1.13.6.</span> <span class="nav-text">Finalize installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Verify-operation-3"><span class="nav-number">1.13.7.</span> <span class="nav-text">Verify operation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Congratulations-Let’s-try-booting-an-instance"><span class="nav-number">1.14.</span> <span class="nav-text">Congratulations! Let’s try booting an instance</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-provider-network-subnetwork"><span class="nav-number">1.14.1.</span> <span class="nav-text">Create provider network&#x2F;subnetwork</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-flavor"><span class="nav-number">1.14.2.</span> <span class="nav-text">Create flavor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Add-security-group-rules"><span class="nav-number">1.14.3.</span> <span class="nav-text">Add security group rules</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Launch-an-instance"><span class="nav-number">1.14.4.</span> <span class="nav-text">Launch an instance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Determine-instance-options"><span class="nav-number">1.14.5.</span> <span class="nav-text">Determine instance options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Launch-the-instance"><span class="nav-number">1.14.6.</span> <span class="nav-text">Launch the instance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-the-instance-using-the-virtual-console"><span class="nav-number">1.14.7.</span> <span class="nav-text">Access the instance using the virtual console</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-the-instance-remotely"><span class="nav-number">1.14.8.</span> <span class="nav-text">Access the instance remotely</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISSUE-DHCP-failure-in-VM-troubleshooting"><span class="nav-number">1.15.</span> <span class="nav-text">[ISSUE] DHCP failure in VM troubleshooting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-it-is-like"><span class="nav-number">1.15.1.</span> <span class="nav-text">what it is like</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conclusion"><span class="nav-number">1.15.2.</span> <span class="nav-text">Conclusion:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cinder"><span class="nav-number">1.16.</span> <span class="nav-text">Cinder</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cinder-on-controller"><span class="nav-number">1.17.</span> <span class="nav-text">Cinder on controller</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-controller-node"><span class="nav-number">1.17.1.</span> <span class="nav-text">Install and configure controller node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prerequisites-3"><span class="nav-number">1.17.2.</span> <span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-components-3"><span class="nav-number">1.17.3.</span> <span class="nav-text">Install and configure components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-Compute-to-use-Block-Storage"><span class="nav-number">1.17.4.</span> <span class="nav-text">Configure Compute to use Block Storage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-installation-5"><span class="nav-number">1.17.5.</span> <span class="nav-text">Finalize installation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cinder-on-block-storage-node"><span class="nav-number">1.18.</span> <span class="nav-text">Cinder on block storage node</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#configure-storage-network-for-compute"><span class="nav-number">1.18.1.</span> <span class="nav-text">configure storage network for compute</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-cinder-machine-storage"><span class="nav-number">1.18.2.</span> <span class="nav-text">Create cinder machine: storage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Storage-node-actions"><span class="nav-number">1.19.</span> <span class="nav-text">Storage node actions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Management-net-eth0-enp0s3-and-storage-net-eth2-enp0s9"><span class="nav-number">1.19.1.</span> <span class="nav-text">Management net eth0 (enp0s3) and storage net eth2 (enp0s9)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configure-NTP-by-editing-etc-chrony-chrony-conf-1"><span class="nav-number">1.19.2.</span> <span class="nav-text">configure NTP by editing &#x2F;etc&#x2F;chrony&#x2F;chrony.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Check-new-disk-was-there-already"><span class="nav-number">1.19.3.</span> <span class="nav-text">Check new disk was there already</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cinder-on-storage-node"><span class="nav-number">1.20.</span> <span class="nav-text">Cinder on storage node</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-a-storage-node"><span class="nav-number">1.20.1.</span> <span class="nav-text">Install and configure a storage node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prerequisites-4"><span class="nav-number">1.20.2.</span> <span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-components-4"><span class="nav-number">1.20.3.</span> <span class="nav-text">Install and configure components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-installation-6"><span class="nav-number">1.20.4.</span> <span class="nav-text">Finalize installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Verify-operation-4"><span class="nav-number">1.20.5.</span> <span class="nav-text">Verify operation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Let’s-try-something-on-block-storage"><span class="nav-number">1.21.</span> <span class="nav-text">Let’s try something on block storage!</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-a-volume"><span class="nav-number">1.21.1.</span> <span class="nav-text">Create a volume</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Heat"><span class="nav-number">1.22.</span> <span class="nav-text">Heat</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-1"><span class="nav-number">1.22.1.</span> <span class="nav-text">Install and configure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prerequisites-5"><span class="nav-number">1.22.2.</span> <span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-components-5"><span class="nav-number">1.22.3.</span> <span class="nav-text">Install and configure components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-installation-7"><span class="nav-number">1.22.4.</span> <span class="nav-text">Finalize installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Verify-operation-5"><span class="nav-number">1.22.5.</span> <span class="nav-text">Verify operation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISSUE-list-heat-service-failure"><span class="nav-number">1.23.</span> <span class="nav-text">[ISSUE] list heat service failure</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#error-occurred-during-openstack-orchestration-service-list"><span class="nav-number">1.23.1.</span> <span class="nav-text">error occurred during openstack orchestration service list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution"><span class="nav-number">1.23.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Start-Orchestration-let’s-start-from-a-single-instance-HOT"><span class="nav-number">1.24.</span> <span class="nav-text">Start Orchestration! let’s start from a single instance HOT</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-a-template"><span class="nav-number">1.24.1.</span> <span class="nav-text">Create a template</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-a-stack"><span class="nav-number">1.24.2.</span> <span class="nav-text">Create a stack</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-about-Design-a-fake-vAPG-VNF-and-instantiate-it"><span class="nav-number">1.25.</span> <span class="nav-text">How about Design a fake vAPG VNF and instantiate it?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HOT"><span class="nav-number">1.25.1.</span> <span class="nav-text">HOT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Instantiation-vAPG"><span class="nav-number">1.25.2.</span> <span class="nav-text">Instantiation vAPG</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Horizon-dashboard"><span class="nav-number">1.26.</span> <span class="nav-text">Horizon dashboard</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-configure-2"><span class="nav-number">1.26.1.</span> <span class="nav-text">Install and configure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finalize-installation-8"><span class="nav-number">1.26.2.</span> <span class="nav-text">Finalize installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Verify-operation-6"><span class="nav-number">1.26.3.</span> <span class="nav-text">Verify operation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISSUE-Horizon-500-internal-error"><span class="nav-number">1.27.</span> <span class="nav-text">[ISSUE] Horizon 500 internal error</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Fault-reproduce-in-cli"><span class="nav-number">1.27.1.</span> <span class="nav-text">Fault reproduce in cli</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-1"><span class="nav-number">1.27.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enable-RabbitMQ-web-admin-for-studying"><span class="nav-number">1.28.</span> <span class="nav-text">Enable RabbitMQ web admin for studying</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Neutron-reconfigure-as-Linux-bridge-with-vlan"><span class="nav-number">1.29.</span> <span class="nav-text">Neutron reconfigure as Linux bridge with vlan</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Controller-configuration"><span class="nav-number">1.29.1.</span> <span class="nav-text">Controller configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Compute-node-configuration"><span class="nav-number">1.29.2.</span> <span class="nav-text">Compute node configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Verify-operation-7"><span class="nav-number">1.29.3.</span> <span class="nav-text">Verify operation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-initial-networks"><span class="nav-number">1.29.4.</span> <span class="nav-text">Create initial networks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Verify-network-operation"><span class="nav-number">1.29.5.</span> <span class="nav-text">Verify network operation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISSUE-Troubleshooting-vlan-dhcp"><span class="nav-number">1.30.</span> <span class="nav-text">[ISSUE] Troubleshooting vlan dhcp</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wey Gu | 古思为"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Wey Gu | 古思为</p>
  <div class="site-description" itemprop="description">Build things.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/littlewey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;littlewey" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:littlewey@gmail.com" title="E-Mail → mailto:littlewey@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/littlewey" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;littlewey" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/littlewey" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;littlewey" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/littlewey" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;littlewey" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/littlewey" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;littlewey" rel="noopener" target="_blank"><i class="fa fa-fw fa-instagram"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wey Gu | 古思为</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.1
  </div>
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e58de1403eb729d" async="async"></script>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '90bb84dab80e142752cb',
      clientSecret: '26f2fb897afc6becceae244ae33738ba8c51a0b7',
      repo        : 'littlewey.github.io',
      owner       : 'littlewey',
      admin       : ['littlewey'],
      id          : '6548ed315c44095bb1cce7751bf27efc',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
